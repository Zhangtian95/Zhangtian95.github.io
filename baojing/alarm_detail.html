<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>报警详情</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #1890ff;
        --bg-color: #f5f7fa;
        --white: #ffffff;
        --text-main: #333333;
        --text-sub: #888888;
        --border-color: #eeeeee;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: transparent;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Arial, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-main);
        padding-top: 108px;
        padding-bottom: 80px;
      }

      .fixed-header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 100;
        background-color: var(--primary-color);
        color: white;
      }
      .status-bar {
        height: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 15px;
        font-size: 12px;
      }
      .top-nav {
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 15px;
      }
      .nav-title {
        font-size: 17px;
        font-weight: 500;
      }

      .page-tabs {
        height: 44px;
        background: var(--white);
        display: flex;
        color: var(--text-main);
        border-bottom: 1px solid var(--border-color);
      }
      .page-tab-item {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        position: relative;
        cursor: pointer;
      }
      .page-tab-item.active {
        color: var(--primary-color);
        font-weight: 600;
      }
      .page-tab-item.active::after {
        content: "";
        position: absolute;
        bottom: 0;
        width: 50%;
        height: 2px;
        background-color: var(--primary-color);
      }

      .content-section {
        display: none;
        padding: 15px;
      }
      .content-section.active {
        display: block;
      }
      .form-group {
        background: var(--white);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
      }
      .group-title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
      }
      .form-row {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        font-size: 14px;
      }
      .form-label {
        width: 80px;
        color: var(--text-main);
        flex-shrink: 0;
      }
      .required {
        color: red;
        margin-left: 2px;
      }
      .form-content {
        flex: 1;
      }

      .toggle-group {
        display: flex;
        gap: 10px;
      }
      .toggle-btn {
        flex: 1;
        text-align: center;
        padding: 8px 0;
        background-color: #f5f5f5;
        border-radius: 4px;
        font-size: 13px;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }
      .toggle-btn.active {
        background-color: #e6f7ff;
        color: var(--primary-color);
      }
      .toggle-btn.active::after {
        content: "";
        position: absolute;
        bottom: 0;
        right: 0;
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 0 0 15px 15px;
        border-color: transparent transparent var(--primary-color) transparent;
      }
      .toggle-btn.disabled {
        pointer-events: none;
        opacity: 0.6;
      }

      .input-box,
      .select-box {
        width: 100%;
        height: 36px;
        border: 1px solid #d9d9d9;
        border-radius: 4px;
        padding: 0 10px;
        font-size: 13px;
        outline: none;
      }
      .textarea-box {
        width: 100%;
        border: 1px solid #d9d9d9;
        border-radius: 4px;
        padding: 10px;
        font-size: 13px;
        min-height: 100px;
        resize: none;
        background: #fcfcfc;
      }
      #work-order-fields {
        display: none;
      }

      .bottom-action {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: var(--white);
        padding: 10px 15px;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        padding-bottom: max(10px, env(safe-area-inset-bottom));
      }
      .confirm-btn {
        width: 100%;
        background: var(--primary-color);
        color: white;
        border: none;
        height: 44px;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 500;
      }
      .confirm-btn:disabled {
        background: #ccc;
      }

      .detail-row {
        display: flex;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
        font-size: 13px;
      }
      .detail-row:last-child {
        border-bottom: none;
      }
      .detail-label {
        color: var(--text-sub);
        width: 100px;
      }
      .detail-val {
        color: var(--text-main);
        flex: 1;
        text-align: right;
      }
    </style>
  </head>
  <body>
    <div class="fixed-header">
      <div class="status-bar">
        <div>14:25</div>
        <div>
          <i class="fas fa-signal"></i> <i class="fas fa-wifi"></i>
          <i class="fas fa-battery-full"></i>
        </div>
      </div>
      <div class="top-nav">
        <div class="nav-left" onclick="window.location.href='alarm_list.html'">
          <i class="fas fa-chevron-left"></i>
        </div>
        <div class="nav-title">报警详情</div>
        <div class="nav-right"><i class="fas fa-ellipsis-h"></i></div>
      </div>
      <div class="page-tabs">
        <div class="page-tab-item active" onclick="switchPageTab(0)">
          确认信息
        </div>
        <div class="page-tab-item" onclick="switchPageTab(1)">报警信息</div>
      </div>
    </div>

    <!-- Tab 1: 确认信息 -->
    <div class="content-section active" id="tab-confirm">
      <div class="form-group">
        <div class="group-title">确认信息</div>
        <div class="form-row">
          <div class="form-label">报警确认<span class="required">*</span></div>
          <div class="form-content toggle-group" id="confirm-type-group">
            <div
              class="toggle-btn active"
              onclick="selectConfirmType(this, 'clear')"
            >
              解除报警
            </div>
            <div class="toggle-btn" onclick="selectConfirmType(this, 'handle')">
              处置报警
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-label">生成工单<span class="required">*</span></div>
          <div class="form-content toggle-group" id="work-order-group">
            <div
              class="toggle-btn active"
              onclick="selectWorkOrder(this, 'no')"
            >
              否
            </div>
            <div class="toggle-btn" onclick="selectWorkOrder(this, 'yes')">
              是
            </div>
          </div>
        </div>

        <div id="work-order-fields">
          <div class="form-row">
            <div class="form-label">报修区域</div>
            <div class="form-content" style="text-align: right; color: #666">
              GB-67水力舱
            </div>
          </div>
          <div class="form-row">
            <div class="form-label">报修设备</div>
            <div class="form-content" style="text-align: right; color: #666">
              温度传感器1
            </div>
          </div>
          <div class="form-row">
            <div class="form-label">
              报修类型<span class="required">*</span>
            </div>
            <div class="form-content">
              <select class="select-box">
                <option>故障维修</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-label">报修人<span class="required">*</span></div>
            <div class="form-content">
              <input type="text" class="input-box" id="repair-man" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-label">
              联系方式<span class="required">*</span>
            </div>
            <div class="form-content">
              <input type="text" class="input-box" id="contact" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-label">
              报修时间<span class="required">*</span>
            </div>
            <div class="form-content">
              <input type="datetime-local" class="input-box" id="repair-time" />
            </div>
          </div>
          <div class="form-row" style="align-items: flex-start">
            <div class="form-label" style="margin-top: 8px">
              报修内容<span class="required">*</span>
            </div>
            <div class="form-content">
              <textarea class="textarea-box" id="repair-content"></textarea>
            </div>
          </div>
        </div>
      </div>

      <div class="form-group">
        <div class="group-title">排查信息<span class="required">*</span></div>
        <textarea
          class="textarea-box"
          id="check-info"
          placeholder="请输入排查信息"
        ></textarea>
      </div>
    </div>

    <!-- Tab 2: 报警信息 (增加了 ID) -->
    <div class="content-section" id="tab-info">
      <div class="form-group">
        <div class="group-title">基础信息</div>
        <div class="detail-row">
          <div class="detail-label">结构物类型</div>
          <div class="detail-val" id="d-stype">--</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">结构物名称</div>
          <div class="detail-val" id="d-sname">--</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">设备类型</div>
          <div class="detail-val" id="d-dtype">--</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">设备名称</div>
          <div class="detail-val" id="d-dname">--</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">测点类型</div>
          <div class="detail-val" id="d-ptype">--</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">测点名称</div>
          <div class="detail-val" id="d-pname">--</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">报警级别</div>
          <div class="detail-val" id="d-level" style="font-weight: bold">
            --
          </div>
        </div>
        <div class="detail-row">
          <div class="detail-label">报警内容</div>
          <div class="detail-val" id="d-title">--</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">报警值</div>
          <div class="detail-val" id="d-val">--</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">正常范围</div>
          <div class="detail-val" id="d-range">--</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">报警开始时间</div>
          <div class="detail-val" id="d-time">--</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">报警结束时间</div>
          <div class="detail-val">--</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">上报人</div>
          <div class="detail-val">系统</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">上报时间</div>
          <div class="detail-val" id="d-report-time">--</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">报警来源</div>
          <div class="detail-val" id="d-source">--</div>
        </div>
      </div>
    </div>

    <div class="bottom-action">
      <button class="confirm-btn" id="main-btn">立即确认</button>
    </div>

    <script>
      let confirmType = "clear";
      let isWorkOrder = "no";

      function switchPageTab(index) {
        document
          .querySelectorAll(".page-tab-item")
          .forEach((t) => t.classList.remove("active"));
        document
          .querySelectorAll(".content-section")
          .forEach((s) => s.classList.remove("active"));
        document
          .querySelectorAll(".page-tab-item")
          [index].classList.add("active");
        document
          .querySelectorAll(".content-section")
          [index].classList.add("active");
      }

      function selectConfirmType(el, type) {
        if (el.classList.contains("disabled")) return;
        el.parentElement
          .querySelectorAll(".toggle-btn")
          .forEach((btn) => btn.classList.remove("active"));
        el.classList.add("active");
        confirmType = type;
        checkShowFields();
      }

      function selectWorkOrder(el, val) {
        if (el.classList.contains("disabled")) return;
        el.parentElement
          .querySelectorAll(".toggle-btn")
          .forEach((btn) => btn.classList.remove("active"));
        el.classList.add("active");
        isWorkOrder = val;
        checkShowFields();
      }

      function checkShowFields() {
        const fields = document.getElementById("work-order-fields");
        if (confirmType === "handle" && isWorkOrder === "yes") {
          fields.style.display = "block";
        } else {
          fields.style.display = "none";
        }
      }

      // --- 初始化数据 ---
      document.addEventListener("DOMContentLoaded", () => {
        // 1. 读取列表页传来的数据
        const dataStr = sessionStorage.getItem("currentAlarm");
        if (dataStr) {
          const data = JSON.parse(dataStr);

          // 填充 Tab 2 数据
          document.getElementById("d-stype").innerText = data.stype;
          document.getElementById("d-sname").innerText = data.sname;
          document.getElementById("d-dtype").innerText = data.dtype;
          document.getElementById("d-dname").innerText = data.dname;
          document.getElementById("d-ptype").innerText = data.ptype;
          document.getElementById("d-pname").innerText = data.pname;

          const levelEl = document.getElementById("d-level");
          levelEl.innerText = data.level;
          levelEl.style.color = data.levelColor || "#333";

          document.getElementById("d-title").innerText = data.title;
          document.getElementById("d-val").innerText = data.val;
          document.getElementById("d-range").innerText = data.range;
          document.getElementById("d-time").innerText = data.time;
          document.getElementById("d-report-time").innerText = data.time; // 模拟上报时间同报警时间
          document.getElementById("d-source").innerText = data.source;

          // 2. 根据状态判断 UI
          if (data.status === "confirmed") {
            // 已确认状态
            document.getElementById("check-info").value =
              "经排查，现场设备运行正常，系传感器误报。";
            document.getElementById("main-btn").innerText = "已完成";
            document.getElementById("main-btn").disabled = true;
            document
              .querySelectorAll(".toggle-btn")
              .forEach((b) => b.classList.add("disabled"));
            document
              .querySelectorAll("input, textarea, select")
              .forEach((i) => (i.disabled = true));
          } else {
            // 待确认状态：初始化时间控件
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document
              .querySelectorAll('input[type="datetime-local"]')
              .forEach((i) => (i.value = now.toISOString().slice(0, 16)));
          }
        } else {
          // 如果没有数据（比如直接打开此页），显示默认
          document.getElementById("d-title").innerText = "无数据";
        }
      });
    </script>
  </body>
</html>
