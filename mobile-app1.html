<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-width=425px"
    />
    <title>移动端巡检上报应用</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
      }

      .max-w-md {
        max-width: 425px;
        margin: 0 auto;
      }

      .hidden {
        display: none !important;
      }

      .flex {
        display: flex;
      }

      .flex-col {
        flex-direction: column;
      }

      .items-center {
        align-items: center;
      }

      .justify-between {
        justify-content: space-between;
      }

      .justify-center {
        justify-content: center;
      }

      .gap-2 {
        gap: 0.5rem;
      }

      .gap-4 {
        gap: 1rem;
      }

      .gap-8 {
        gap: 2rem;
      }

      .p-4 {
        padding: 1rem;
      }

      .px-4 {
        padding-left: 1rem;
        padding-right: 1rem;
      }

      .py-3 {
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
      }

      .py-2 {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
      }

      .pb-24 {
        padding-bottom: 6rem;
      }

      .mb-2 {
        margin-bottom: 0.5rem;
      }

      .mb-3 {
        margin-bottom: 0.75rem;
      }

      .mb-4 {
        margin-bottom: 1rem;
      }

      .mt-2 {
        margin-top: 0.5rem;
      }

      .text-sm {
        font-size: 0.875rem;
      }

      .text-xs {
        font-size: 0.75rem;
      }

      .text-center {
        text-align: center;
      }

      .text-right {
        text-align: right;
      }

      .border {
        border-width: 1px;
        border-style: solid;
      }

      .border-gray-200 {
        border-color: #e5e7eb;
      }

      .border-gray-300 {
        border-color: #d1d5db;
      }

      .border-b {
        border-bottom-width: 1px;
        border-bottom-style: solid;
      }

      .border-t {
        border-top-width: 1px;
        border-top-style: solid;
      }

      .rounded-lg {
        border-radius: 0.5rem;
      }

      .bg-white {
        background-color: white;
      }

      .bg-blue-600 {
        background-color: #2563eb;
      }

      .bg-blue-500 {
        background-color: #3b82f6;
      }

      .bg-green-500 {
        background-color: #10b981;
      }

      .bg-green-100 {
        background-color: #d1fae5;
      }

      .bg-orange-100 {
        background-color: #fed7aa;
      }

      .bg-blue-100 {
        background-color: #dbeafe;
      }

      .bg-gray-50 {
        background-color: #f9fafb;
      }

      .bg-gray-100 {
        background-color: #f3f4f6;
      }

      .bg-red-500 {
        background-color: #ef4444;
      }

      .bg-red-100 {
        background-color: #fee2e2;
      }

      .text-white {
        color: white;
      }

      .text-blue-600 {
        color: #2563eb;
      }

      .text-gray-500 {
        color: #6b7280;
      }

      .text-gray-600 {
        color: #4b5563;
      }

      .text-gray-700 {
        color: #374151;
      }

      .text-green-700 {
        color: #15803d;
      }

      .text-orange-700 {
        color: #c2410c;
      }

      .text-blue-700 {
        color: #1d4ed8;
      }

      .text-red-500 {
        color: #ef4444;
      }

      .text-red-700 {
        color: #b91c1c;
      }

      .hover\:bg-gray-100:hover {
        background-color: #f3f4f6;
      }

      .hover\:bg-blue-700:hover {
        background-color: #1d4ed8;
      }

      .hover\:bg-blue-600:hover {
        background-color: #2563eb;
      }

      .cursor-pointer {
        cursor: pointer;
      }

      .w-full {
        width: 100%;
      }

      .h-6 {
        height: 1.5rem;
      }

      .h-48 {
        height: 12rem;
      }

      .w-16 {
        width: 4rem;
      }

      .h-16 {
        height: 4rem;
      }

      .w-9 {
        width: 2.25rem;
      }

      .h-9 {
        height: 2.25rem;
      }

      .w-4 {
        width: 1rem;
      }

      .h-4 {
        height: 1rem;
      }

      .w-3 {
        width: 0.75rem;
      }

      .h-3 {
        height: 0.75rem;
      }

      .rounded-full {
        border-radius: 9999px;
      }

      .flex-1 {
        flex: 1;
      }

      .flex-shrink-0 {
        flex-shrink: 0;
      }

      .h-screen {
        height: 100vh;
      }

      .min-h-screen {
        min-height: 100vh;
      }

      .overflow-hidden {
        overflow: hidden;
      }

      .overflow-y-auto {
        overflow-y: auto;
      }

      .space-y-3 > * + * {
        margin-top: 0.75rem;
      }

      .space-y-4 > * + * {
        margin-top: 1rem;
      }

      .transition-colors {
        transition-property: color, background-color, border-color;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 150ms;
      }

      input[type="text"],
      textarea {
        width: 100%;
        padding: 0.5rem 0.75rem;
        /* px-3 py-2 */
        border: 1px solid #d1d5db;
        /* border-gray-300 */
        border-radius: 0.375rem;
        /* rounded-md */
        font-size: 0.875rem;
        /* text-sm - 与筛选框字体大小一致 */
      }

      /* 搜索框占位符居中 */
      .search-input::placeholder,
      .search-center::placeholder {
        text-align: center;
      }

      /* 筛选框文本居中 */
      .select-center {
        text-align: center;
        font-size: 0.875rem !important;
        /* 14px，强制覆盖任何其他样式 */
      }

      /* 确保所有select元素都是14px */
      select {
        font-size: 0.875rem !important;
        /* 14px，强制覆盖浏览器默认样式 */
      }

      input[type="date"] {
        width: 100%;
        padding: 0.5rem 0.75rem;
        /* px-3 py-2 */
        border: 1px solid #d1d5db;
        /* border-gray-300 */
        border-radius: 0.375rem;
        /* rounded-md */
        font-size: 0.875rem;
        /* text-sm */
        background-color: white;
      }

      input[type="text"]:focus,
      input[type="date"]:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      input[type="radio"] {
        width: 1rem;
        height: 1rem;
      }

      input[type="checkbox"] {
        width: 1rem;
        height: 1rem;
      }

      button {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary {
        background-color: #3b82f6;
        color: white;
        font-size: 0.875rem;
        /* 14px */
        padding: 0.5rem 1rem;
        /* 8px 16px */
        border-radius: 0.375rem;
        /* 6px */
        cursor: pointer;
        border: none;
      }

      .btn-primary:hover {
        background-color: #2563eb;
      }

      .btn-danger {
        background-color: #ef4444;
        color: white;
      }

      .btn-danger:hover {
        background-color: #dc2626;
      }

      .btn-success {
        background-color: #10b981;
        color: white;
      }

      .btn-success:hover {
        background-color: #059669;
      }

      .btn-outline {
        background-color: transparent;
        border: 1px solid #d1d5db;
        color: #374151;
      }

      .btn-outline:hover {
        background-color: #f9fafb;
      }

      .badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        font-weight: 500;
        border-radius: 0.25rem;
      }

      .badge-green {
        background-color: #d1fae5;
        color: #15803d;
      }

      .badge-orange {
        background-color: #fed7aa;
        color: #c2410c;
      }

      .badge-blue {
        background-color: #dbeafe;
        color: #1d4ed8;
      }

      .badge-red {
        background-color: #fee2e2;
        color: #b91c1c;
      }

      .tab-button {
        flex: 1;
        padding: 0.75rem;
        text-align: center;
        border: none;
        background: none;
        font-size: 0.875rem;
        cursor: pointer;
        border-bottom: 2px solid transparent;
      }

      .tab-button.active {
        color: #2563eb;
        border-bottom-color: #2563eb;
      }

      .tab-button:not(.active) {
        color: #6b7280;
      }

      .status-bar {
        height: 1.5rem;
        background-color: #2563eb;
        color: white;
        font-size: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 1rem;
      }

      .nav-header {
        background-color: #2563eb;
        color: white;
        padding: 0.75rem 1rem;
        display: flex;
        align-items: center;
      }

      .page-nav-header {
        background-color: #2563eb;
        color: white;
        padding: 0.75rem 1rem;
        display: flex;
        align-items: center;
      }

      .page-nav-header h1 {
        flex: 1;
        text-align: center;
        margin: 0;
        font-size: 1rem;
      }

      .nav-header h1 {
        flex: 1;
        text-align: center;
        margin: 0;
        font-size: 1rem;
      }

      .bottom-nav {
        background-color: white;
        border-top: 1px solid #e5e7eb;
        padding: 0.5rem 1rem;
        display: flex;
        justify-content: space-around;
      }

      .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0.5rem 1rem;
        color: #6b7280;
        text-decoration: none;
        font-size: 0.75rem;
      }

      .nav-item.active {
        color: #2563eb;
      }

      .nav-item:hover {
        background-color: #f9fafb;
        border-radius: 0.5rem;
      }

      .card {
        background-color: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 0.75rem;
      }

      .search-box {
        position: relative;
      }

      .search-icon {
        position: absolute;
        left: 0.75rem;
        /* left-3 = 12px = 0.75rem */
        top: 50%;
        transform: translateY(-50%);
        width: 1rem;
        /* w-4 = 16px = 1rem */
        height: 1rem;
        /* h-4 = 16px = 1rem */
        color: #9ca3af;
        /* text-gray-400 */
        z-index: 10;
      }

      .search-input {
        padding-left: 2.5rem;
        /* pl-10 = 40px = 2.5rem */
      }

      .select-wrapper {
        position: relative;
      }

      /* 隐藏浏览器默认的select下拉箭头 */
      select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background-image: none;
      }

      /* 兼容不同浏览器 */
      select::-ms-expand {
        display: none;
      }

      select::-ms-value {
        color: inherit;
      }

      .select-icon {
        position: absolute;
        right: 0.5rem;
        /* right-2 = 8px = 0.5rem */
        top: 50%;
        transform: translateY(-50%);
        width: 1rem;
        /* w-4 = 16px = 1rem */
        height: 1rem;
        /* h-4 = 16px = 1rem */
        color: #9ca3af;
        /* text-gray-400 */
        pointer-events: none;
        z-index: 10;
      }

      /* 优化select样式，与React版本保持一致 */
      select {
        width: 100%;
        padding: 0.5rem 2rem 0.5rem 0.75rem;
        /* px-3 py-2 pr-8 = 12px 32px 12px 12px */
        border: 1px solid #d1d5db;
        /* border-gray-300 */
        border-radius: 0.375rem;
        /* rounded-md */
        font-size: 0.875rem;
        /* text-sm = 14px */
        background-color: white;
        color: #9ca3af;
        /* text-gray-400 */
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }

      select:not([value=""]):not([value="全部"]) {
        color: #000;
      }

      .disease-form {
        background-color: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 0.75rem;
      }

      .photo-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
      }

      .photo-item {
        aspect-ratio: 1;
        border-radius: 0.5rem;
        overflow: hidden;
        background-color: #f3f4f6;
        border: 1px solid #e5e7eb;
      }

      .photo-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .upload-area {
        border-radius: 0.5rem;
        padding: 1rem;
        text-align: center;
        cursor: pointer;
        transition: border-color 0.2s;
      }

      .upload-area:hover {
        border-color: #3b82f6;
      }

      .required {
        color: #ef4444;
      }

      .sticky-header {
        position: sticky;
        top: 0;
        z-index: 10;
        background-color: white;
      }

      @media (max-width: 425px) {
        .max-w-md {
          max-width: 100%;
        }
      }

      /* --- 1. 强制统一所有表单控件高度 --- */
      input[type="text"],
      input[type="date"],
      select,
      .multi-select-trigger {
        height: 38px !important; /* 核心：强制高度一致 */
        padding: 0.5rem 0.75rem; /* 统一内边距 */
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        background-color: white;
        box-sizing: border-box;
        display: flex;
        align-items: center; /* 确保文字垂直居中 */
      }

      /* 修正原生 select 的文字颜色逻辑 */
      select {
        color: #9ca3af; /* 默认灰色 */
      }
      select:not([value=""]):not([value="全部"]) {
        color: #000; /* 选中后黑色 */
      }

      /* --- 2. 多选下拉框组件样式 --- */
      .multi-select-container {
        position: relative;
        width: 100%;
      }
      .multi-select-trigger {
        justify-content: center; /* 文字水平居中 */
        cursor: pointer;
        overflow: hidden;
      }
      .multi-select-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background-color: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.375rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        z-index: 50;
        margin-top: 4px;
        display: none;
        max-height: 200px;
        overflow-y: auto;
      }
      .multi-select-dropdown.show {
        display: block;
      }
      .multi-select-option {
        padding: 0.5rem;
        display: flex;
        align-items: center;
        cursor: pointer;
        font-size: 0.875rem;
        text-align: left;
      }
      .multi-select-option:hover {
        background-color: #f3f4f6;
      }
      .multi-select-option input[type="checkbox"] {
        margin-right: 0.5rem;
        width: 1rem;
        height: 1rem;
      }

      /* 强制移除养护计划名称输入框的边框并设置样式 */
      #maintenance-plan-name,
      #acceptance-record-plan-name {
        border: none !important;
        outline: none !important;
        box-shadow: none !important;
        background-color: #6b7280 !important; /* bg-gray-500 */
        color: #f3f4f6 !important; /* text-gray-100 */
      }

      /* 强制移除养护人和养护上报时间输入框的边框 */
      #acceptance-info-tab
        input[type="text"][disabled]:not(#maintenance-plan-name),
      #acceptance-record-info-tab
        input[type="text"][disabled]:not(#maintenance-plan-name) {
        border: none !important;
        outline: none !important;
        box-shadow: none !important;
        background-color: #f9fafb !important; /* bg-gray-50 */
        color: #4b5563 !important; /* text-gray-600 */
      }

      /* 强制移除养护人和养护上报时间textarea的边框 */
      #acceptance-info-tab textarea[disabled],
      #acceptance-record-info-tab textarea[disabled] {
        border: none !important;
        outline: none !important;
        box-shadow: none !important;
        background-color: #f9fafb !important; /* bg-gray-50 */
        color: #4b5563 !important; /* text-gray-600 */
      }

      /* 照片显示相关样式 */
      .aspect-square {
        aspect-ratio: 1 / 1;
        width: 100%;
        position: relative;
      }

      .object-cover {
        object-fit: cover;
      }

      .absolute {
        position: absolute;
      }

      .top-0 {
        top: 0;
      }

      .right-0 {
        right: 0;
      }

      .bg-red-500 {
        background-color: #ef4444;
      }

      .text-white {
        color: #ffffff;
      }

      .text-xs {
        font-size: 0.75rem;
      }

      .rounded-full {
        border-radius: 50%;
      }

      .w-4 {
        width: 1rem;
      }

      .h-4 {
        height: 1rem;
      }

      .flex-center {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .relative {
        position: relative;
      }

      .border-dashed {
        border-style: dashed;
      }

      .border-gray-300 {
        border-color: #d1d5db;
      }

      .text-2xl {
        font-size: 1.5rem;
      }

      .text-gray-400 {
        color: #9ca3af;
      }

      .hover\:bg-gray-50:hover {
        background-color: #f9fafb;
      }

      .cursor-pointer {
        cursor: pointer;
      }

      .rounded-lg {
        border-radius: 0.5rem;
      }

      .overflow-hidden {
        overflow: hidden;
      }

      .bg-gray-100 {
        background-color: #f3f4f6;
      }

      .bg-blue-500 {
        background-color: #3b82f6;
      }

      .text-blue-500 {
        color: #3b82f6;
      }

      .rounded {
        border-radius: 0.25rem;
      }

      .mb-2 {
        margin-bottom: 0.5rem;
      }

      .grid {
        display: grid;
      }

      .grid-cols-4 {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }

      .gap-1 {
        gap: 0.25rem;
      }

      .shadow-sm {
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      }

      .hover\:opacity-80:hover {
        opacity: 0.8;
      }

      .transition-opacity {
        transition: opacity 0.2s ease-in-out;
      }
    </style>
  </head>

  <body class="bg-gray-50">
    <div
      class="max-w-md h-screen bg-gray-50 flex flex-col overflow-hidden"
      id="app"
    >
      <!-- 状态栏 -->
      <div class="status-bar">
        <span id="current-time">09:00</span>
        <div class="flex items-center gap-1">
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"
            />
          </svg>
          <svg class="w-4 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"
            />
          </svg>
          <span>100%</span>
        </div>
      </div>

      <!-- 顶部导航栏 -->
      <div class="page-nav-header">
        <button id="back-btn" class="hidden mr-3" onclick="goBack()">
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </button>
        <h1 id="page-title">首页</h1>
        <div class="w-6 mr-3"></div>
      </div>

      <!-- 页面内容 -->
      <main class="flex-1 overflow-y-auto" id="main-content">
        <!-- 首页内容 -->
        <div id="home-page" class="page">
          <div class="pt-0 px-0 pb-4">
            <!-- 顶部图片 -->
            <div class="mb-3">
              <div
                class="w-full h-48 bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center"
              >
                <div class="text-white text-center">
                  <svg
                    class="w-16 h-16 mx-auto mb-2"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
                    />
                  </svg>
                  <p class="text-lg font-medium">道路、桥梁、隧道巡检系统</p>
                  <p class="text-sm opacity-90">专业的市政设施管理平台</p>
                </div>
              </div>
            </div>

            <!-- 功能图标区域 -->
            <div class="flex justify-center gap-8 px-4 mb-6">
              <!-- 巡检图标和文字 -->
              <button
                onclick="navigateToInspection()"
                class="flex flex-col items-center gap-3 p-6 hover:bg-gray-100 rounded-lg transition-colors"
              >
                <div
                  class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center"
                >
                  <svg
                    class="w-9 h-9 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                    />
                  </svg>
                </div>
                <span class="text-gray-700">巡检</span>
              </button>

              <!-- 养护图标和文字 -->
              <button
                onclick="navigateToMaintenance()"
                class="flex flex-col items-center gap-3 p-6 hover:bg-gray-100 rounded-lg transition-colors"
              >
                <div
                  class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center"
                >
                  <svg
                    class="w-9 h-9 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                    />
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                    />
                  </svg>
                </div>
                <span class="text-gray-700">养护</span>
              </button>

              <!-- 养护验收图标和文字 -->
              <button
                onclick="viewAcceptancePage()"
                class="flex flex-col items-center gap-3 p-6 hover:bg-gray-100 rounded-lg transition-colors"
              >
                <div
                  class="w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center"
                >
                  <svg
                    class="w-9 h-9 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                </div>
                <span class="text-gray-700">养护验收</span>
              </button>
            </div>

            <!-- 待办统计卡片 -->
            <div class="px-4">
              <div class="grid grid-cols-3 gap-3">
                <!-- 待巡检 -->
                <div
                  class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 text-center"
                >
                  <div class="text-3xl font-bold text-blue-500 mb-1">8</div>
                  <div class="text-xs text-gray-500">待巡检</div>
                </div>

                <!-- 待养护 -->
                <div
                  class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 text-center"
                >
                  <div class="text-3xl font-bold text-green-500 mb-1">5</div>
                  <div class="text-xs text-gray-500">待养护</div>
                </div>

                <!-- 待验收 -->
                <div
                  class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 text-center"
                >
                  <div class="text-3xl font-bold text-orange-500 mb-1">9</div>
                  <div class="text-xs text-gray-500">待验收</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 待办页面内容 -->
        <div id="todo-page" class="page hidden">
          <div class="p-4 space-y-4">
            <!-- 巡检任务模块 -->
            <div class="bg-white border border-gray-200 rounded-lg mb-2 p-4">
              <!-- 标题栏 -->
              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-2">
                  <h2>巡检任务</h2>
                  <span
                    class="bg-red-500 text-white text-xs px-2 py-0.5 rounded-full"
                    >5</span
                  >
                </div>
                <button
                  onclick="viewAllTasks()"
                  class="flex items-center text-blue-500 text-sm"
                >
                  更多
                  <svg
                    class="w-4 h-4 ml-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"
                    />
                  </svg>
                </button>
              </div>

              <!-- 任务列表 -->
              <div class="space-y-3" id="inspection-tasks-list">
                <!-- 动态生成巡检任务 -->
              </div>
            </div>

            <!-- 养护任务模块 -->
            <div class="bg-white border border-gray-200 rounded-lg mb-2 p-4">
              <!-- 标题栏 -->
              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-2">
                  <h2>养护任务</h2>
                  <span
                    class="bg-red-500 text-white text-xs px-2 py-0.5 rounded-full"
                    >8</span
                  >
                </div>
                <button
                  onclick="viewAllMaintenanceTasks()"
                  class="flex items-center text-blue-500 text-sm"
                >
                  更多
                  <svg
                    class="w-4 h-4 ml-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"
                    />
                  </svg>
                </button>
              </div>

              <!-- 任务列表 -->
              <div class="space-y-3" id="maintenance-tasks-list">
                <!-- 动态生成养护任务 -->
              </div>
            </div>
          </div>
        </div>

        <!-- 个人中心页面内容 -->
        <div id="profile-page" class="page hidden">
          <div class="p-4">
            <div class="bg-white rounded-lg p-6">
              <div class="flex items-center mb-6">
                <div
                  class="w-20 h-20 bg-blue-500 rounded-full flex items-center justify-center mr-4"
                >
                  <svg
                    class="w-12 h-12 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                    />
                  </svg>
                </div>
                <div>
                  <h3 class="text-lg font-semibold">张三</h3>
                  <p class="text-gray-600">巡检员</p>
                </div>
              </div>

              <div class="space-y-4">
                <div
                  class="flex items-center justify-between py-3 border-b border-gray-200"
                >
                  <span class="text-gray-600">工号</span>
                  <span>INS001</span>
                </div>
                <div
                  class="flex items-center justify-between py-3 border-b border-gray-200"
                >
                  <span class="text-gray-600">所属单位</span>
                  <span>高新区城管局</span>
                </div>
                <div
                  class="flex items-center justify-between py-3 border-b border-gray-200"
                >
                  <span class="text-gray-600">联系电话</span>
                  <span>13800138000</span>
                </div>
                <div class="flex items-center justify-between py-3">
                  <span class="text-gray-600">入职时间</span>
                  <span>2023-01-01</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 养护验收页面内容 -->
        <div id="acceptance-page" class="page hidden">
          <div class="bg-white min-h-full">
            <!-- Tab页 -->
            <div class="flex border-b border-gray-200">
              <button
                class="tab-button active"
                onclick="switchAcceptanceTab('pending')"
              >
                待验收
              </button>
              <button
                class="tab-button"
                onclick="switchAcceptanceTab('records')"
              >
                已验收
              </button>
            </div>

            <!-- 待验收内容 -->
            <div id="pending-acceptance" class="p-4">
              <!-- 搜索栏 -->
              <div class="flex gap-2 mb-4">
                <div class="flex-1 search-box">
                  <svg
                    class="search-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                    />
                  </svg>
                  <input
                    type="text"
                    placeholder="请输入搜索内容"
                    class="search-input search-center"
                    id="pending-acceptance-search"
                    onkeyup="filterAcceptanceTasks()"
                  />
                </div>
                <button class="btn-primary" onclick="filterAcceptanceTasks()">
                  搜索
                </button>
              </div>

              <!-- 筛选栏 -->
              <div class="flex gap-2 mb-4">
                <div class="flex-1 multi-select-container">
                  <!-- 触发器 -->
                  <div
                    class="multi-select-trigger"
                    onclick="toggleMultiSelect('pending-acceptance-structure-filter')"
                  >
                    <span
                      id="pending-acceptance-structure-filter-text"
                      class="truncate text-gray-400"
                      >全部结构物</span
                    >
                    <svg
                      class="w-4 h-4 ml-1 text-gray-400 flex-shrink-0"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 9l-7 7-7-7"
                      />
                    </svg>
                  </div>
                  <!-- 下拉菜单 -->
                  <div
                    id="pending-acceptance-structure-filter-dropdown"
                    class="multi-select-dropdown"
                  >
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="全部"
                        checked
                        onchange="handleMultiSelectChange('pending-acceptance-structure-filter', '全部', 'filterAcceptanceTasks')"
                      />
                      全部结构物
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="桥梁"
                        onchange="handleMultiSelectChange('pending-acceptance-structure-filter', '桥梁', 'filterAcceptanceTasks')"
                      />
                      桥梁
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="道路"
                        onchange="handleMultiSelectChange('pending-acceptance-structure-filter', '道路', 'filterAcceptanceTasks')"
                      />
                      道路
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="隧道"
                        onchange="handleMultiSelectChange('pending-acceptance-structure-filter', '隧道', 'filterAcceptanceTasks')"
                      />
                      隧道
                    </label>
                  </div>
                </div>
                <div class="flex-1 select-wrapper">
                  <select
                    id="pending-acceptance-type-filter"
                    onchange="filterAcceptanceTasks()"
                    class="select-center"
                  >
                    <option value="全部">全部养护类型</option>
                    <option value="保养小修">保养小修</option>
                    <option value="中修工程">中修工程</option>
                    <option value="大修工程">大修工程</option>
                    <option value="加固工程">加固工程</option>
                    <option value="改扩建工程">改扩建工程</option>
                  </select>
                  <svg
                    class="select-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </div>
              </div>

              <!-- 数据统计 -->
              <div class="text-gray-600 text-sm mb-3">
                共 <span id="pending-acceptance-count">9</span> 条数据
              </div>

              <!-- 任务列表 -->
              <div class="space-y-3" id="pending-acceptance-list">
                <!-- 动态生成养护验收任务 -->
              </div>
            </div>

            <!-- 验收记录内容 -->
            <div id="records-acceptance" class="p-4 hidden">
              <!-- 搜索栏 -->
              <div class="flex gap-2 mb-4">
                <div class="flex-1 search-box">
                  <svg
                    class="search-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                    />
                  </svg>
                  <input
                    type="text"
                    placeholder="请输入搜索内容"
                    class="search-input search-center"
                    id="records-acceptance-search"
                    onkeyup="filterAcceptanceRecords()"
                  />
                </div>
                <button class="btn-primary" onclick="filterAcceptanceRecords()">
                  搜索
                </button>
              </div>

              <!-- 筛选栏 -->
              <div class="grid grid-cols-3 gap-2 mb-4">
                <div class="multi-select-container">
                  <!-- 触发器 -->
                  <div
                    class="multi-select-trigger"
                    onclick="toggleMultiSelect('records-acceptance-structure-filter')"
                  >
                    <span
                      id="records-acceptance-structure-filter-text"
                      class="truncate text-gray-400"
                      >全部结构物</span
                    >
                    <svg
                      class="w-4 h-4 ml-1 text-gray-400 flex-shrink-0"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 9l-7 7-7-7"
                      />
                    </svg>
                  </div>
                  <!-- 下拉菜单 -->
                  <div
                    id="records-acceptance-structure-filter-dropdown"
                    class="multi-select-dropdown"
                  >
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="全部"
                        checked
                        onchange="handleMultiSelectChange('records-acceptance-structure-filter', '全部', 'filterAcceptanceRecords')"
                      />
                      全部结构物
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="桥梁"
                        onchange="handleMultiSelectChange('records-acceptance-structure-filter', '桥梁', 'filterAcceptanceRecords')"
                      />
                      桥梁
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="道路"
                        onchange="handleMultiSelectChange('records-acceptance-structure-filter', '道路', 'filterAcceptanceRecords')"
                      />
                      道路
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="隧道"
                        onchange="handleMultiSelectChange('records-acceptance-structure-filter', '隧道', 'filterAcceptanceRecords')"
                      />
                      隧道
                    </label>
                  </div>
                </div>
                <div class="select-wrapper">
                  <select
                    id="records-acceptance-type-filter"
                    onchange="filterAcceptanceRecords()"
                    class="select-center"
                  >
                    <option value="全部">全部养护类型</option>
                    <option value="保养小修">保养小修</option>
                    <option value="中修工程">中修工程</option>
                    <option value="大修工程">大修工程</option>
                    <option value="加固工程">加固工程</option>
                    <option value="改扩建工程">改扩建工程</option>
                  </select>
                  <svg
                    class="select-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </div>
                <div class="select-wrapper">
                  <select
                    id="records-acceptance-status-filter"
                    onchange="filterAcceptanceRecords()"
                    class="select-center"
                  >
                    <option value="全部">全部验收状态</option>
                    <option value="验收通过">验收通过</option>
                    <option value="验收未通过">验收未通过</option>
                  </select>
                  <svg
                    class="select-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </div>
              </div>

              <!-- 数据统计 -->
              <div class="text-gray-600 text-sm mb-3">
                共 <span id="acceptance-records-count">9</span> 条数据
              </div>

              <!-- 记录列表 -->
              <div class="space-y-3" id="acceptance-records-list">
                <!-- 动态生成养护验收记录 -->
              </div>
            </div>
          </div>
        </div>

        <!-- 巡检页面内容 -->
        <div id="inspection-page" class="page hidden">
          <div class="bg-white min-h-full">
            <!-- Tab页 -->
            <div class="flex border-b border-gray-200">
              <button
                class="tab-button active"
                onclick="switchInspectionTab('pending')"
              >
                待巡检
              </button>
              <button
                class="tab-button"
                onclick="switchInspectionTab('records')"
              >
                已巡检
              </button>
            </div>

            <!-- 待巡检内容 -->
            <div id="pending-inspection" class="p-4">
              <!-- 搜索栏 -->
              <div class="flex gap-2 mb-4">
                <div class="flex-1 search-box">
                  <svg
                    class="search-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                    />
                  </svg>
                  <input
                    type="text"
                    placeholder="请输入搜索内容"
                    class="search-input search-center"
                    id="inspection-search"
                    onkeyup="filterInspectionTasks()"
                  />
                </div>
                <button class="btn-primary" onclick="filterInspectionTasks()">
                  搜索
                </button>
              </div>

              <!-- 筛选栏 -->
              <div class="flex gap-2 mb-4">
                <div class="flex-1 multi-select-container">
                  <!-- 触发器 -->
                  <div
                    class="multi-select-trigger"
                    onclick="toggleMultiSelect('inspection-structure-filter')"
                  >
                    <span
                      id="inspection-structure-filter-text"
                      class="truncate text-gray-400"
                      >全部结构物</span
                    >
                    <svg
                      class="w-4 h-4 ml-1 text-gray-400 flex-shrink-0"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 9l-7 7-7-7"
                      />
                    </svg>
                  </div>
                  <!-- 下拉菜单 -->
                  <div
                    id="inspection-structure-filter-dropdown"
                    class="multi-select-dropdown"
                  >
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="全部"
                        checked
                        onchange="handleMultiSelectChange('inspection-structure-filter', '全部', 'filterInspectionTasks')"
                      />
                      全部结构物
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="桥梁"
                        onchange="handleMultiSelectChange('inspection-structure-filter', '桥梁', 'filterInspectionTasks')"
                      />
                      桥梁
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="道路"
                        onchange="handleMultiSelectChange('inspection-structure-filter', '道路', 'filterInspectionTasks')"
                      />
                      道路
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="隧道"
                        onchange="handleMultiSelectChange('inspection-structure-filter', '隧道', 'filterInspectionTasks')"
                      />
                      隧道
                    </label>
                  </div>
                </div>
                <div class="flex-1 select-wrapper">
                  <select
                    id="inspection-expire-filter"
                    onchange="filterInspectionTasks()"
                    class="select-center"
                  >
                    <option value="全部">全部任务</option>
                    <option value="超期">超期</option>
                    <option value="正常">正常</option>
                  </select>
                  <svg
                    class="select-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </div>
              </div>

              <!-- 数据统计 -->
              <div class="text-gray-600 text-sm mb-3">
                共 <span id="pending-count">8</span> 条数据
              </div>

              <!-- 任务列表 -->
              <div class="space-y-3" id="pending-tasks-list">
                <!-- 动态生成任务 -->
              </div>
            </div>

            <!-- 巡检记录内容 -->
            <div id="records-inspection" class="p-4 hidden">
              <!-- 搜索栏 -->
              <div class="flex gap-2 mb-4">
                <div class="flex-1 search-box">
                  <svg
                    class="search-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                    />
                  </svg>
                  <input
                    type="text"
                    placeholder="请输入搜索内容"
                    class="search-input"
                    id="records-search"
                    onkeyup="filterInspectionRecords()"
                  />
                </div>
                <button class="btn-primary" onclick="filterInspectionRecords()">
                  搜索
                </button>
              </div>

              <!-- 筛选栏 -->
              <div class="grid grid-cols-3 gap-2 mb-2">
                <div class="multi-select-container">
                  <!-- 触发器 -->
                  <div
                    class="multi-select-trigger"
                    onclick="toggleMultiSelect('records-structure-filter')"
                  >
                    <span
                      id="records-structure-filter-text"
                      class="truncate text-gray-400"
                      >全部结构物</span
                    >
                    <svg
                      class="w-4 h-4 ml-1 text-gray-400 flex-shrink-0"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 9l-7 7-7-7"
                      />
                    </svg>
                  </div>
                  <!-- 下拉菜单 -->
                  <div
                    id="records-structure-filter-dropdown"
                    class="multi-select-dropdown"
                  >
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="全部"
                        checked
                        onchange="handleMultiSelectChange('records-structure-filter', '全部', 'filterInspectionRecords')"
                      />
                      全部结构物
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="桥梁"
                        onchange="handleMultiSelectChange('records-structure-filter', '桥梁', 'filterInspectionRecords')"
                      />
                      桥梁
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="道路"
                        onchange="handleMultiSelectChange('records-structure-filter', '道路', 'filterInspectionRecords')"
                      />
                      道路
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="隧道"
                        onchange="handleMultiSelectChange('records-structure-filter', '隧道', 'filterInspectionRecords')"
                      />
                      隧道
                    </label>
                  </div>
                </div>
                <div class="select-wrapper">
                  <select
                    id="records-expire-filter"
                    onchange="filterInspectionRecords()"
                    class="select-center"
                  >
                    <option value="全部">全部任务</option>
                    <option value="超期">超期</option>
                    <option value="正常">正常</option>
                  </select>
                  <svg
                    class="select-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </div>
                <div class="select-wrapper">
                  <select
                    id="records-result-filter"
                    onchange="filterInspectionRecords()"
                    class="select-center"
                  >
                    <option value="全部">全部结果</option>
                    <option value="完好">完好</option>
                    <option value="发现病害">发现病害</option>
                  </select>
                  <svg
                    class="select-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </div>
              </div>

              <!-- 日期筛选 -->
              <div class="mb-4">
                <div class="flex items-center gap-2">
                  <input
                    type="date"
                    id="records-start-date"
                    class="flex-1"
                    onchange="filterInspectionRecords()"
                  />
                  <span class="text-gray-500">~</span>
                  <input
                    type="date"
                    id="records-end-date"
                    class="flex-1"
                    onchange="filterInspectionRecords()"
                  />
                </div>
              </div>

              <!-- 数据统计 -->
              <div class="text-gray-600 text-sm mb-3">
                共 <span id="records-count">15</span> 条数据
              </div>

              <!-- 记录列表 -->
              <div class="space-y-3" id="records-list">
                <!-- 动态生成记录 -->
              </div>
            </div>
          </div>
        </div>

        <!-- 验收页面内容 -->
        <div id="acceptance-detail-page" class="page hidden">
          <div class="bg-white h-full flex flex-col">
            <!-- Tab页 -->
            <div class="flex border-b border-gray-200 flex-shrink-0">
              <button
                class="flex-1 py-3 text-center tab-button active"
                onclick="handleAcceptanceTabClick('acceptance')"
              >
                验收信息
              </button>
              <button
                class="flex-1 py-3 text-center tab-button"
                onclick="handleAcceptanceTabClick('basic')"
              >
                基本信息
              </button>
            </div>

            <!-- 验收信息Tab内容 -->
            <div id="acceptance-info-tab" class="flex-1 overflow-y-auto">
              <div class="p-4 space-y-4 pb-24">
                <!-- 养护计划名称 -->
                <div>
                  <input
                    type="text"
                    id="maintenance-plan-name"
                    value="2025年道路改扩建计划"
                    disabled
                    class="w-full px-3 py-2 border-none outline-none shadow-none rounded-md bg-gray-500 text-gray-100 text-base"
                  />
                </div>

                <!-- 验收状态 -->
                <div>
                  <label class="block text-sm mb-2">
                    <span class="text-red-500">*</span>验收状态
                  </label>
                  <div class="flex gap-4">
                    <label class="flex items-center">
                      <input
                        type="radio"
                        name="acceptanceResult"
                        value="验收通过"
                        class="mr-2"
                      />
                      验收通过
                    </label>
                    <label class="flex items-center">
                      <input
                        type="radio"
                        name="acceptanceResult"
                        value="验收未通过"
                        class="mr-2"
                      />
                      验收未通过
                    </label>
                  </div>
                </div>

                <!-- 验收意见 -->
                <div>
                  <label class="block text-sm mb-2"> 验收意见 </label>
                  <textarea
                    rows="4"
                    placeholder="请输入验收意见"
                    maxlength="100"
                  ></textarea>
                  <div class="text-xs text-gray-500 text-right mt-1">
                    <span id="acceptance-opinion-count">0</span>/100
                  </div>
                </div>
              </div>
            </div>

            <!-- 基本信息Tab内容 -->
            <div
              id="acceptance-basic-tab"
              class="flex-1 overflow-y-auto hidden"
            >
              <div class="p-4 space-y-4">
                <!-- 基本信息 -->
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">养护使用类型：</div>
                  <div class="col-span-2">改扩建工程</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">养护单位：</div>
                  <div class="col-span-2">A单位</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">结构物类型：</div>
                  <div class="col-span-2">道路</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">结构物名称：</div>
                  <div class="col-span-2">海尔立交桥</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">养护开始时间：</div>
                  <div class="col-span-2">2025-10-15</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">养护结束时间：</div>
                  <div class="col-span-2">2025-11-15</div>
                </div>
              </div>
            </div>

            <!-- 底部按钮区域 -->
            <div
              class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 p-4"
            >
              <button
                class="w-full btn-primary py-3 text-base"
                onclick="completeAcceptance()"
              >
                完成验收
              </button>
            </div>
          </div>
        </div>

        <!-- 验收记录详情页面内容 -->
        <div id="acceptance-record-detail-page" class="page hidden">
          <div class="bg-white h-full flex flex-col">
            <!-- Tab页 -->
            <div class="flex border-b border-gray-200 flex-shrink-0">
              <button
                class="flex-1 py-3 text-center tab-button active"
                onclick="handleAcceptanceRecordTabClick('acceptance')"
              >
                验收信息
              </button>
              <button
                class="flex-1 py-3 text-center tab-button"
                onclick="handleAcceptanceRecordTabClick('basic')"
              >
                基本信息
              </button>
            </div>

            <!-- 验收信息Tab内容 -->
            <div id="acceptance-record-info-tab" class="flex-1 overflow-y-auto">
              <div class="p-4 space-y-4">
                <!-- 养护计划名称 -->
                <div>
                  <input
                    type="text"
                    id="acceptance-record-plan-name"
                    value=""
                    disabled
                    class="w-full px-3 py-2 border-none outline-none shadow-none rounded-md bg-gray-500 text-gray-100 text-base"
                  />
                </div>

                <!-- 验收状态 -->
                <div>
                  <label class="block text-sm mb-2"> 验收状态 </label>
                  <div class="flex gap-4">
                    <label class="flex items-center">
                      <input
                        type="radio"
                        name="acceptanceRecordResult"
                        value="验收通过"
                        class="mr-2"
                        checked
                        disabled
                      />
                      验收通过
                    </label>
                    <label class="flex items-center">
                      <input
                        type="radio"
                        name="acceptanceRecordResult"
                        value="验收未通过"
                        class="mr-2"
                        disabled
                      />
                      验收未通过
                    </label>
                  </div>
                </div>

                <!-- 验收意见 -->
                <div>
                  <label class="block text-sm mb-2"> 验收意见 </label>
                  <textarea
                    rows="4"
                    disabled
                    class="w-full px-3 py-2 rounded-md bg-gray-50 text-gray-600 resize-none border-0"
                  >
养护工程符合要求，质量达标，通过验收。</textarea
                  >
                  <div class="text-xs text-gray-500 text-right mt-1">
                    20/100
                  </div>
                </div>

                <!-- 验收人员 -->
                <div>
                  <label class="block text-sm mb-2"> 验收人员 </label>
                  <input
                    type="text"
                    id="acceptance-record-person"
                    value="马丁"
                    disabled
                    class="w-full px-3 py-2 border-0 rounded-md bg-gray-50 text-gray-600"
                  />
                </div>

                <!-- 验收时间 -->
                <div>
                  <label class="block text-sm mb-2"> 验收时间 </label>
                  <input
                    type="text"
                    id="acceptance-record-time"
                    value="2025-11-25 14:20"
                    disabled
                    class="w-full px-3 py-2 border-0 rounded-md bg-gray-50 text-gray-600"
                  />
                </div>

                <!-- 养护内容、资金使用情况、养护完工照片、养护人、养护上报时间等字段将通过JavaScript动态添加 -->
                <!-- 养护历史也将通过JavaScript动态添加 -->
              </div>
            </div>

            <!-- 基本信息Tab内容 -->
            <div
              id="acceptance-record-basic-tab"
              class="flex-1 overflow-y-auto hidden"
            >
              <div class="p-4 space-y-3">
                <!-- 基本信息 -->
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">养护使用类型</div>
                  <div class="col-span-2" id="basic-maintenance-type">
                    改扩建工程
                  </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">养护单位</div>
                  <div class="col-span-2" id="basic-maintenance-unit">
                    A单位
                  </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">结构物类型</div>
                  <div class="col-span-2" id="basic-structure-type">道路</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">结构物名称</div>
                  <div class="col-span-2" id="basic-structure-name">
                    海尔立交桥
                  </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">养护开始时间</div>
                  <div class="col-span-2" id="basic-start-date">2025-10-15</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">养护结束时间</div>
                  <div class="col-span-2" id="basic-end-date">2025-11-15</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">验收人员</div>
                  <div class="col-span-2" id="basic-acceptance-person">
                    王强
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 巡检上报页面内容 -->
        <div id="inspection-report-page" class="page hidden">
          <div class="bg-white h-full flex flex-col">
            <!-- Tab页 -->
            <div class="flex border-b border-gray-200 flex-shrink-0">
              <button
                class="flex-1 py-3 text-center tab-button active"
                onclick="handleReportTabClick('inspection')"
              >
                巡检信息
              </button>
              <button
                class="flex-1 py-3 text-center tab-button"
                onclick="handleReportTabClick('basic')"
              >
                基本信息
              </button>
            </div>

            <!-- 基本信息Tab内容 -->
            <div
              id="report-basic-tab"
              class="p-4 flex-1 overflow-y-auto hidden"
            >
              <div class="space-y-4">
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">巡检单位：</div>
                  <div class="col-span-2">高新区城管局</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">所属结构物：</div>
                  <div class="col-span-2" id="report-structure-name">
                    海尔路立交桥
                  </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">关联巡检计划：</div>
                  <div class="col-span-2">日常保洁巡检</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">本次巡检计划开始时间：</div>
                  <div class="col-span-2" id="report-plan-start">
                    2025-11-10 9:00
                  </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">本次巡检计划结束时间：</div>
                  <div class="col-span-2" id="report-plan-end">
                    2025-11-11 9:00
                  </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">巡检周期开始时间：</div>
                  <div class="col-span-2" id="report-cycle-start">
                    2025-11-10
                  </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">巡检周期结束时间：</div>
                  <div class="col-span-2" id="report-cycle-end">2026-11-10</div>
                </div>
              </div>
            </div>

            <!-- 巡检信息Tab内容 -->
            <div id="report-inspection-tab" class="flex-1 overflow-y-auto">
              <!-- 青岛路任务特殊UI：检查项列表 -->
              <div
                id="qingdao-road-layout"
                class="flex-1 overflow-y-auto p-4 hidden"
              >
                <div class="space-y-3" id="category-list">
                  <!-- 动态生成检查项 -->
                </div>
              </div>

              <!-- 普通任务UI -->
              <div id="normal-task-layout">
                <!-- 固定区域：巡检结果 + 添加/删除病害按钮 -->
                <div
                  class="p-4 space-y-4 border-b border-gray-200 bg-white flex-shrink-0"
                >
                  <!-- 巡检结果 -->
                  <div>
                    <label class="block text-sm mb-2">
                      巡检结果 <span class="text-red-500">*</span>
                    </label>
                    <div class="flex gap-4">
                      <label class="flex items-center">
                        <input
                          type="radio"
                          name="inspectionResult"
                          value="完好"
                          onchange="onInspectionResultChange('完好')"
                          class="mr-2"
                        />
                        正常
                      </label>
                      <label class="flex items-center">
                        <input
                          type="radio"
                          name="inspectionResult"
                          value="发现病害"
                          onchange="onInspectionResultChange('发现病害')"
                          class="mr-2"
                        />
                        异常
                      </label>
                    </div>
                  </div>

                  <!-- 添加/删除病害按钮 -->
                  <div id="disease-buttons" class="flex gap-2 hidden">
                    <button
                      class="btn-primary flex items-center gap-1"
                      onclick="addDisease()"
                    >
                      <svg
                        class="w-4 h-4"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 4v16m8-8H4"
                        />
                      </svg>
                      添加病害
                    </button>
                    <button
                      id="delete-disease-btn"
                      class="btn-danger flex items-center gap-1 hidden"
                      onclick="deleteSelectedDiseases()"
                    >
                      <svg
                        class="w-4 h-4"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M6 18L18 6M6 6l12 12"
                        />
                      </svg>
                      删除病害
                    </button>
                  </div>
                </div>

                <!-- 可滚动区域：病害详情表单 -->
                <div
                  id="disease-list"
                  class="flex-1 overflow-y-auto p-4 pb-24 hidden"
                >
                  <!-- 动态生成病害表单 -->
                </div>
              </div>
            </div>

            <!-- 开发备注 -->
            <div class="fixed bottom-16 left-0 right-0 max-w-md mx-auto p-4">
              <div
                class="bg-pink-50 border border-pink-300 border-dashed rounded-lg p-3 text-sm text-pink-800"
              >
                <strong>开发备注：</strong
                >构件/设备类型-检查项-损坏类型-参数描述（可能没有）是四级级联关系，当桥面系-桥面铺装-网裂开或龟裂依次选择时会出现参数描述（形式不定，可能为下拉，可能文本框）
              </div>
            </div>

            <!-- 底部按钮区域 -->
            <div
              class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 p-4"
            >
              <button
                class="w-full btn-primary py-3 text-base"
                onclick="completeInspectionReport()"
              >
                完成填报
              </button>
            </div>
          </div>
        </div>

        <!-- 养护页面内容 -->
        <div id="maintenance-page" class="page hidden">
          <div class="bg-white min-h-full">
            <!-- Tab页 -->
            <div class="flex border-b border-gray-200">
              <button
                class="tab-button active"
                onclick="switchMaintenanceTab('pending')"
              >
                待养护
              </button>
              <button
                class="tab-button"
                onclick="switchMaintenanceTab('records')"
              >
                已养护
              </button>
            </div>

            <!-- 待养护内容 -->
            <div id="pending-maintenance" class="p-4">
              <!-- 搜索栏 -->
              <div class="flex gap-2 mb-4">
                <div class="flex-1 search-box">
                  <svg
                    class="search-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                    />
                  </svg>
                  <input
                    type="text"
                    placeholder="请输入搜索内容"
                    class="search-input search-center"
                    id="pending-maintenance-search"
                    onkeyup="filterMaintenanceTasks()"
                  />
                </div>
                <button class="btn-primary" onclick="filterMaintenanceTasks()">
                  搜索
                </button>
              </div>

              <!-- 筛选栏 -->
              <div class="flex gap-2 mb-4">
                <div class="flex-1 multi-select-container">
                  <!-- 触发器 -->
                  <div
                    class="multi-select-trigger"
                    onclick="toggleMultiSelect('pending-maintenance-structure-filter')"
                  >
                    <span
                      id="pending-maintenance-structure-filter-text"
                      class="truncate text-gray-400"
                      >全部结构物</span
                    >
                    <svg
                      class="w-4 h-4 ml-1 text-gray-400 flex-shrink-0"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 9l-7 7-7-7"
                      />
                    </svg>
                  </div>
                  <!-- 下拉菜单 -->
                  <div
                    id="pending-maintenance-structure-filter-dropdown"
                    class="multi-select-dropdown"
                  >
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="全部"
                        checked
                        onchange="handleMultiSelectChange('pending-maintenance-structure-filter', '全部', 'filterMaintenanceTasks')"
                      />
                      全部结构物
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="桥梁"
                        onchange="handleMultiSelectChange('pending-maintenance-structure-filter', '桥梁', 'filterMaintenanceTasks')"
                      />
                      桥梁
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="道路"
                        onchange="handleMultiSelectChange('pending-maintenance-structure-filter', '道路', 'filterMaintenanceTasks')"
                      />
                      道路
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="隧道"
                        onchange="handleMultiSelectChange('pending-maintenance-structure-filter', '隧道', 'filterMaintenanceTasks')"
                      />
                      隧道
                    </label>
                  </div>
                </div>
                <div class="flex-1 select-wrapper">
                  <select
                    id="pending-maintenance-type-filter"
                    onchange="filterMaintenanceTasks()"
                    class="select-center"
                  >
                    <option value="全部">全部养护类型</option>
                    <option value="保养小修">保养小修</option>
                    <option value="中修工程">中修工程</option>
                    <option value="大修工程">大修工程</option>
                    <option value="加固工程">加固工程</option>
                    <option value="改扩建工程">改扩建工程</option>
                  </select>
                  <svg
                    class="select-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </div>
              </div>

              <!-- 数据统计 -->
              <div class="text-gray-600 text-sm mb-3">
                共 <span id="pending-maintenance-count">11</span> 条数据
              </div>

              <!-- 任务列表 -->
              <div class="space-y-3" id="pending-maintenance-list">
                <!-- 动态生成养护任务 -->
              </div>
            </div>

            <!-- 养护记录内容 -->
            <div id="records-maintenance" class="p-4 hidden">
              <!-- 搜索栏 -->
              <div class="flex gap-2 mb-4">
                <div class="flex-1 search-box">
                  <svg
                    class="search-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                    />
                  </svg>
                  <input
                    type="text"
                    placeholder="请输入搜索内容"
                    class="search-input search-center"
                    id="records-maintenance-search"
                    onkeyup="filterMaintenanceRecords()"
                  />
                </div>
                <button
                  class="btn-primary"
                  onclick="filterMaintenanceRecords()"
                >
                  搜索
                </button>
              </div>

              <!-- 筛选栏 -->
              <div class="grid grid-cols-3 gap-2 mb-2">
                <div class="multi-select-container">
                  <!-- 触发器 -->
                  <div
                    class="multi-select-trigger"
                    onclick="toggleMultiSelect('records-maintenance-structure-filter')"
                  >
                    <span
                      id="records-maintenance-structure-filter-text"
                      class="truncate text-gray-400"
                      >全部结构物</span
                    >
                    <svg
                      class="w-4 h-4 ml-1 text-gray-400 flex-shrink-0"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 9l-7 7-7-7"
                      />
                    </svg>
                  </div>
                  <!-- 下拉菜单 -->
                  <div
                    id="records-maintenance-structure-filter-dropdown"
                    class="multi-select-dropdown"
                  >
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="全部"
                        checked
                        onchange="handleMultiSelectChange('records-maintenance-structure-filter', '全部', 'filterMaintenanceRecords')"
                      />
                      全部结构物
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="桥梁"
                        onchange="handleMultiSelectChange('records-maintenance-structure-filter', '桥梁', 'filterMaintenanceRecords')"
                      />
                      桥梁
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="道路"
                        onchange="handleMultiSelectChange('records-maintenance-structure-filter', '道路', 'filterMaintenanceRecords')"
                      />
                      道路
                    </label>
                    <label class="multi-select-option">
                      <input
                        type="checkbox"
                        value="隧道"
                        onchange="handleMultiSelectChange('records-maintenance-structure-filter', '隧道', 'filterMaintenanceRecords')"
                      />
                      隧道
                    </label>
                  </div>
                </div>
                <div class="select-wrapper">
                  <select
                    id="records-maintenance-type-filter"
                    onchange="filterMaintenanceRecords()"
                    class="select-center"
                  >
                    <option value="全部">全部养护类型</option>
                    <option value="保养小修">保养小修</option>
                    <option value="中修工程">中修工程</option>
                    <option value="大修工程">大修工程</option>
                    <option value="加固工程">加固工程</option>
                    <option value="改扩建工程">改扩建工程</option>
                  </select>
                  <svg
                    class="select-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </div>
                <div class="select-wrapper">
                  <select
                    id="records-maintenance-status-filter"
                    onchange="filterMaintenanceRecords()"
                    class="select-center"
                  >
                    <option value="全部">全部验收状态</option>
                    <option value="待验收">待验收</option>
                    <option value="验收通过">验收通过</option>
                    <option value="验收未通过">验收未通过</option>
                  </select>
                  <svg
                    class="select-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    />
                  </svg>
                </div>
              </div>

              <!-- 日期筛选 -->
              <div class="mb-4">
                <div class="flex items-center gap-2">
                  <input
                    type="date"
                    id="maintenance-start-date"
                    class="flex-1"
                    onchange="filterMaintenanceRecords()"
                  />
                  <span class="text-gray-500">~</span>
                  <input
                    type="date"
                    id="maintenance-end-date"
                    class="flex-1"
                    onchange="filterMaintenanceRecords()"
                  />
                </div>
              </div>

              <!-- 数据统计 -->
              <div class="text-gray-600 text-sm mb-3">
                共 <span id="maintenance-records-count">12</span> 条数据
              </div>

              <!-- 记录列表 -->
              <div class="space-y-3" id="maintenance-records-list">
                <!-- 动态生成养护记录 -->
              </div>
            </div>
          </div>
        </div>

        <!-- 养护上报页面内容 -->
        <div id="maintenance-report-page" class="page hidden">
          <div class="bg-white h-full flex flex-col">
            <!-- Tab页 -->
            <div class="flex border-b border-gray-200 flex-shrink-0">
              <button
                class="tab-button active"
                onclick="switchMaintenanceReportTab('maintenance')"
              >
                养护信息
              </button>
              <button
                class="tab-button"
                onclick="switchMaintenanceReportTab('basic')"
              >
                基本信息
              </button>
            </div>

            <!-- 养护信息内容 -->
            <div
              id="maintenance-info-tab"
              class="p-4 flex-1 overflow-y-auto space-y-4 pb-20"
            >
              <!-- 养护计划名称 -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  养护计划名称
                </label>
                <div
                  class="p-3 bg-gray-50 rounded-lg text-sm text-gray-900"
                  id="maintenance-info-title"
                >
                  2025年保养小修养护计划
                </div>
              </div>

              <!-- 历史内容 - 仅在养护记录页面进入时显示 -->
              <div
                id="history-section"
                class="border border-gray-200 rounded-lg hidden"
              >
                <!-- 动态生成历史内容 -->
              </div>

              <!-- 养护内容 -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <span class="text-red-500">*</span>养护内容
                </label>
                <div class="relative">
                  <textarea
                    id="maintenance-content"
                    placeholder="请输入养护内容，至多100字"
                    maxlength="100"
                    rows="4"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 pr-12"
                    oninput="updateCharacterCount('maintenance-content'); saveMaintenanceContent()"
                    onchange="saveMaintenanceContent()"
                  ></textarea>
                  <div class="absolute bottom-2 right-2 text-xs text-gray-500">
                    <span id="maintenance-content-count">0</span>/100
                  </div>
                </div>
              </div>

              <!-- 资金使用情况 -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <span class="text-red-500">*</span>资金使用情况
                </label>
                <div class="relative">
                  <textarea
                    id="fund-usage"
                    placeholder="请输入资金使用情况，至多100字"
                    maxlength="100"
                    rows="4"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 pr-12"
                    oninput="updateCharacterCount('fund-usage'); saveMaintenanceContent()"
                    onchange="saveMaintenanceContent()"
                  ></textarea>
                  <div class="absolute bottom-2 right-2 text-xs text-gray-500">
                    <span id="fund-usage-count">0</span>/100
                  </div>
                </div>
              </div>

              <!-- 养护完工照片 -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  养护完工照片（至多3张）
                </label>
                <div class="space-y-2">
                  <!-- 照片预览 -->
                  <div id="maintenance-photo-preview" class="photo-grid hidden">
                    <!-- 动态生成照片预览 -->
                  </div>

                  <!-- 上传按钮 -->
                  <label class="upload-area">
                    <input
                      type="file"
                      accept="image/*"
                      multiple
                      onchange="handleMaintenancePhotoUpload(event)"
                      class="hidden"
                    />
                    <svg
                      class="w-8 h-8 mx-auto text-gray-400 mb-2"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 4v16m8-8H4"
                      />
                    </svg>
                  </label>
                </div>
              </div>
            </div>

            <!-- 底部提交按钮 -->
            <div
              class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 p-4"
            >
              <button
                class="w-full btn-primary py-3 text-base font-medium"
                onclick="submitMaintenanceReport()"
              >
                提交上报
              </button>
            </div>

            <!-- 基本信息内容 -->
            <div
              id="maintenance-basic-tab"
              class="p-4 flex-1 overflow-y-auto pb-20 hidden"
            >
              <div class="space-y-4">
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">养护使用类型：</div>
                  <div class="col-span-2" id="maintenance-basic-type">
                    保养小修
                  </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">养护单位：</div>
                  <div class="col-span-2">A单位</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">结构物类型：</div>
                  <div class="col-span-2" id="maintenance-basic-structure">
                    桥梁
                  </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">结构物名称：</div>
                  <div class="col-span-2">海尔立交桥</div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">养护开始时间：</div>
                  <div class="col-span-2" id="maintenance-basic-start">
                    2025-11-10
                  </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">养护结束时间：</div>
                  <div class="col-span-2" id="maintenance-basic-end">
                    2025-12-10
                  </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-gray-600">养护内容描述：</div>
                  <div class="col-span-2">环氧树脂注浆5kg</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- 历史填报页面 -->
        <div
          id="history-page"
          class="page hidden fixed inset-0 bg-gray-50 max-w-md mx-auto flex flex-col z-50"
        >
          <!-- 状态栏 (保持统一风格) -->
          <div class="status-bar">
            <span>09:00</span>
            <div class="flex items-center gap-1">
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path
                  d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"
                />
              </svg>
              <svg class="w-4 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path
                  d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"
                />
              </svg>
              <span>100%</span>
            </div>
          </div>

          <!-- 顶部导航栏 -->
          <div class="nav-header">
            <button class="mr-3" onclick="goBack()">
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"
                />
              </svg>
            </button>
            <h1 class="flex-1 text-center text-lg font-medium">历史填报</h1>
            <div class="w-6 mr-3"></div>
            <!-- 占位，保持标题居中 -->
          </div>

          <!-- 历史记录列表容器 (可滚动区域) -->
          <div class="flex-1 overflow-y-auto">
            <div id="history-content-list" class="p-4 space-y-4 pb-10">
              <!-- 动态生成的内容将放在这里 -->
            </div>
          </div>
        </div>
      </main>

      <!-- 底部导航栏 - 仅在主页面显示 -->
      <nav class="bottom-nav" id="bottom-nav">
        <a href="#" class="nav-item active" onclick="switchMainTab('home')">
          <svg
            class="w-6 h-6 mb-1"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
            />
          </svg>
          <span class="text-xs">首页</span>
        </a>
        <a href="#" class="nav-item" onclick="switchMainTab('todo')">
          <svg
            class="w-6 h-6 mb-1"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
            />
          </svg>
          <span class="text-xs">待办</span>
        </a>
        <a href="#" class="nav-item" onclick="switchMainTab('profile')">
          <svg
            class="w-6 h-6 mb-1"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
            />
          </svg>
          <span class="text-xs">个人中心</span>
        </a>
      </nav>
    </div>

    <script>
      // 全局状态管理
      const appState = {
        currentMainTab: "home",
        currentPage: "main",
        currentInspectionTab: "pending",
        currentMaintenanceTab: "pending",
        currentAcceptanceTab: "pending",
        previousPage: "",
        selectedTask: null,
        selectedMaintenanceTask: null,
        selectedAcceptanceTask: null,
        selectedAcceptanceRecord: null,
        completedTasks: [],
        savedReports: {}, // 保存的填报数据 - 按任务ID存储
        reportFormState: {
          activeTab: "inspection",
          inspectionResult: "",
          diseases: [],
          nextDiseaseId: 1,
          categoryStates: {
            桥面铺装: { expanded: false, result: "", diseases: [] },
            伸缩缝: { expanded: false, result: "", diseases: [] },
            隔音屏: { expanded: false, result: "", diseases: [] },
            防撞体: { expanded: false, result: "", diseases: [] },
            检查井: { expanded: false, result: "", diseases: [] },
          },
        },
        savedReports: {},
        diseases: [],
        nextDiseaseId: 1,
        maintenancePhotos: [],
      };

      // --- 多选组件逻辑开始 ---

      // 点击外部关闭下拉框
      document.addEventListener("click", function (e) {
        if (!e.target.closest(".multi-select-container")) {
          document
            .querySelectorAll(".multi-select-dropdown")
            .forEach((el) => el.classList.remove("show"));
        }
      });

      // 切换显示状态
      function toggleMultiSelect(id) {
        const dropdown = document.getElementById(id + "-dropdown");
        // 关闭其他所有打开的下拉框
        document.querySelectorAll(".multi-select-dropdown").forEach((d) => {
          if (d.id !== id + "-dropdown") d.classList.remove("show");
        });
        dropdown.classList.toggle("show");
      }

      // 处理选项变更
      function handleMultiSelectChange(containerId, value, filterFuncName) {
        const container = document.getElementById(containerId + "-dropdown");
        const allCheckbox = container.querySelector('input[value="全部"]');
        const otherCheckboxes = container.querySelectorAll(
          'input[type="checkbox"]:not([value="全部"])'
        );
        const targetCheckbox = container.querySelector(
          `input[value="${value}"]`
        );

        if (value === "全部") {
          // 选"全部"时，取消其他所有
          if (targetCheckbox.checked) {
            otherCheckboxes.forEach((cb) => (cb.checked = false));
          } else {
            // 不允许取消"全部"导致为空，强制选回
            const anyOtherChecked = Array.from(otherCheckboxes).some(
              (cb) => cb.checked
            );
            if (!anyOtherChecked) targetCheckbox.checked = true;
          }
        } else {
          // 选具体项时，取消"全部"
          if (targetCheckbox.checked) {
            allCheckbox.checked = false;
          } else {
            // 如果取消所有具体项，自动选回"全部"
            const anyOtherChecked = Array.from(otherCheckboxes).some(
              (cb) => cb.checked
            );
            if (!anyOtherChecked) allCheckbox.checked = true;
          }
        }

        updateMultiSelectDisplay(containerId);

        // 触发筛选函数
        if (typeof window[filterFuncName] === "function") {
          window[filterFuncName]();
        }
      }

      // 更新显示文本
      function updateMultiSelectDisplay(containerId) {
        const container = document.getElementById(containerId + "-dropdown");
        const displaySpan = document.getElementById(containerId + "-text");
        const checkboxes = container.querySelectorAll(
          'input[type="checkbox"]:checked'
        );
        const selectedValues = Array.from(checkboxes).map((cb) => cb.value);

        if (selectedValues.includes("全部") || selectedValues.length === 0) {
          displaySpan.textContent = "全部结构物";
          displaySpan.style.color = "#9ca3af"; // 灰色
        } else {
          displaySpan.textContent = selectedValues.join(", ");
          displaySpan.style.color = "#000"; // 黑色
        }
      }

      // 获取选中值数组 (供筛选函数使用)
      function getMultiSelectValues(containerId) {
        const container = document.getElementById(containerId + "-dropdown");
        if (!container) return ["全部"];
        const checkboxes = container.querySelectorAll(
          'input[type="checkbox"]:checked'
        );
        const values = Array.from(checkboxes).map((cb) => cb.value);
        return values.includes("全部") || values.length === 0
          ? ["全部"]
          : values;
      }
      // --- 多选组件逻辑结束 ---

      // 巡检任务数据
      const inspectionTasksData = [
        {
          id: 1,
          title: "日常定期巡检海尔路立交桥 2025-11-11",
          expired: false,
          planDate: "2025-11-11 9:00 ~ 2025-11-12 9:00",
          structureType: "桥梁",
          cycle: "2025-11-10 ~ 2026-11-10",
        },
        {
          id: 2,
          title: "日常定期巡检青岛路 2025-11-10",
          expired: true,
          planDate: "2025-11-10 8:00 ~ 2025-11-11 8:00",
          structureType: "道路",
          cycle: "2025-10-01 ~ 2026-10-01",
        },
        {
          id: 3,
          title: "日常定期巡检胶州湾隧道 2025-11-12",
          expired: false,
          planDate: "2025-11-12 10:00 ~ 2025-11-13 10:00",
          structureType: "隧道",
          cycle: "2025-11-12 ~ 2026-11-12",
        },
        {
          id: 4,
          title: "日常定期巡检香港路立交桥 2025-11-09",
          expired: true,
          planDate: "2025-11-09 14:00 ~ 2025-11-10 14:00",
          structureType: "桥梁",
          cycle: "2025-10-26 ~ 2026-10-26",
        },
        {
          id: 5,
          title: "日常定期巡检山东路 2025-11-13",
          expired: false,
          planDate: "2025-11-13 9:30 ~ 2025-11-14 9:30",
          structureType: "道路",
          cycle: "2025-11-13 ~ 2026-11-13",
        },
        {
          id: 6,
          title: "日常定期巡检辽阳路立交桥 2025-11-14",
          expired: false,
          planDate: "2025-11-14 11:00 ~ 2025-11-15 11:00",
          structureType: "桥梁",
          cycle: "2025-11-14 ~ 2026-11-14",
        },
        {
          id: 7,
          title: "日常定期巡检胶宁高架路 2025-11-08",
          expired: true,
          planDate: "2025-11-08 15:00 ~ 2025-11-09 15:00",
          structureType: "道路",
          cycle: "2025-11-01 ~ 2026-11-01",
        },
        {
          id: 8,
          title: "日常定期巡检太平角隧道 2025-11-15",
          expired: false,
          planDate: "2025-11-15 8:30 ~ 2025-11-16 8:30",
          structureType: "隧道",
          cycle: "2025-11-15 ~ 2026-11-15",
        },
      ];

      // 巡检记录数据
      const inspectionRecordsData = [
        {
          id: 1,
          title: "日常定期巡检海尔路立交桥 2025-11-11",
          expired: false,
          inspectionTime: "2025-11-11 9:15",
          structureType: "桥梁",
          cycle: "2025-11-11 ~ 2026-11-11",
          result: "完好",
        },
        {
          id: 2,
          title: "日常定期巡检青岛路 2025-11-10",
          expired: true,
          inspectionTime: "2025-11-10 14:30",
          structureType: "道路",
          cycle: "2025-10-03 ~ 2026-10-03",
          result: "发现病害",
        },
        {
          id: 3,
          title: "日常定期巡检胶州湾隧道 2025-11-09",
          expired: false,
          inspectionTime: "2025-11-09 10:20",
          structureType: "隧道",
          cycle: "2025-11-09 ~ 2026-11-09",
          result: "完好",
        },
        {
          id: 4,
          title: "日常定期巡检香港路立交桥 2025-11-08",
          expired: true,
          inspectionTime: "2025-11-08 16:45",
          structureType: "桥梁",
          cycle: "2025-10-25 ~ 2026-10-25",
          result: "发现病害",
        },
        {
          id: 5,
          title: "日常定期巡检山东路 2025-11-07",
          expired: false,
          inspectionTime: "2025-11-07 11:10",
          structureType: "道路",
          cycle: "2025-11-07 ~ 2026-11-07",
          result: "完好",
        },
      ];

      // 待养护数据
      const pendingMaintenanceTasks = [
        {
          id: 9,
          title: "2025年道路改扩建计划",
          maintenanceType: "改扩建工程",
          structureType: "道路",
          startDate: "2025-10-15",
          endDate: "2025-11-15",
        },
        {
          id: 12,
          title: "测试3",
          maintenanceType: "改扩建工程",
          structureType: "道路",
          startDate: "2025-10-15",
          endDate: "2025-11-15",
          status: "验收未通过",
        },
        {
          id: 1,
          title: "2025年保养小修养护计划",
          maintenanceType: "保养小修",
          structureType: "桥梁",
          startDate: "2025-11-10",
          endDate: "2025-12-10",
        },
        {
          id: 3,
          title: "2025年大修工程计划",
          maintenanceType: "大修工程",
          structureType: "道路",
          startDate: "2025-11-20",
          endDate: "2025-12-20",
        },
        {
          id: 10,
          title: "测试1",
          maintenanceType: "大修工程",
          structureType: "道路",
          startDate: "2025-11-20",
          endDate: "2025-12-20",
          status: "验收未通过",
        },
      ];

      // 养护记录数据
      const maintenanceRecordsData = [
        {
          id: 110,
          title: "测试3",
          maintenanceType: "改扩建工程",
          structureType: "道路",
          startDate: "2025-10-15",
          endDate: "2025-11-15",
          status: "验收未通过",
        },
        {
          id: 111,
          title: "2025年桥梁中修计划",
          maintenanceType: "中修工程",
          structureType: "桥梁",
          startDate: "2025-10-20",
          endDate: "2025-11-20",
          status: "验收通过",
        },
        {
          id: 112,
          title: "2025年隧道保养计划",
          maintenanceType: "保养小修",
          structureType: "隧道",
          startDate: "2025-10-25",
          endDate: "2025-11-25",
          status: "验收通过",
        },
        {
          id: 101,
          title: "2025年保养小修养护计划",
          maintenanceType: "保养小修",
          structureType: "桥梁",
          startDate: "2025-11-10",
          endDate: "2025-12-10",
          status: "验收通过",
        },
        {
          id: 102,
          title: "2025年中修工程计划",
          maintenanceType: "中修工程",
          structureType: "隧道",
          startDate: "2025-11-15",
          endDate: "2025-12-15",
          status: "待验收",
        },
      ];

      // 养护验收数据
      const pendingAcceptanceData = [
        {
          id: 201,
          title: "2025年道路改扩建计划",
          maintenanceType: "改扩建工程",
          structureType: "道路",
          startDate: "2025-10-15",
          endDate: "2025-11-15",
        },
        {
          id: 202,
          title: "2025年桥梁中修工程",
          maintenanceType: "中修工程",
          structureType: "桥梁",
          startDate: "2025-09-20",
          endDate: "2025-10-20",
        },
        {
          id: 203,
          title: "2025年隧道加固项目",
          maintenanceType: "加固工程",
          structureType: "隧道",
          startDate: "2025-08-10",
          endDate: "2025-09-10",
        },
        {
          id: 204,
          title: "2025年道路大修工程",
          maintenanceType: "大修工程",
          structureType: "道路",
          startDate: "2025-11-01",
          endDate: "2025-12-01",
        },
        {
          id: 205,
          title: "2025年桥梁保养小修",
          maintenanceType: "保养小修",
          structureType: "桥梁",
          startDate: "2025-10-05",
          endDate: "2025-10-25",
        },
        {
          id: 206,
          title: "2025年隧道改扩建",
          maintenanceType: "改扩建工程",
          structureType: "隧道",
          startDate: "2025-07-15",
          endDate: "2025-08-15",
        },
        {
          id: 207,
          title: "2025年道路保养小修",
          maintenanceType: "保养小修",
          structureType: "道路",
          startDate: "2025-11-10",
          endDate: "2025-11-30",
        },
        {
          id: 208,
          title: "2025年桥梁大修项目",
          maintenanceType: "大修工程",
          structureType: "桥梁",
          startDate: "2025-09-15",
          endDate: "2025-10-15",
        },
        {
          id: 209,
          title: "2025年隧道中修工程",
          maintenanceType: "中修工程",
          structureType: "隧道",
          startDate: "2025-08-20",
          endDate: "2025-09-20",
        },
      ];

      // 养护验收记录数据
      const acceptanceRecordsData = [
        {
          id: 301,
          title: "2025年道路改扩建计划",
          maintenanceType: "改扩建工程",
          structureType: "道路",
          startDate: "2025-10-15",
          endDate: "2025-11-15",
          status: "验收通过",
          acceptancePerson: "张三",
          acceptanceTime: "2025-11-20 14:30",
          acceptanceOpinion: "养护工程符合要求，质量达标，通过验收。",
        },
        {
          id: 302,
          title: "2025年桥梁中修工程",
          maintenanceType: "中修工程",
          structureType: "桥梁",
          startDate: "2025-09-20",
          endDate: "2025-10-20",
          status: "验收未通过",
          acceptancePerson: "李四",
          acceptanceTime: "2025-10-25 16:45",
          acceptanceOpinion:
            "桥梁中修工程存在质量问题，部分工程不符合标准，要求整改。",
        },
        {
          id: 303,
          title: "2025年隧道加固项目",
          maintenanceType: "加固工程",
          structureType: "隧道",
          startDate: "2025-08-10",
          endDate: "2025-09-10",
          status: "验收通过",
          acceptancePerson: "王五",
          acceptanceTime: "2025-09-15 10:20",
          acceptanceOpinion: "隧道加固工程质量良好，结构稳定，通过验收。",
        },
        {
          id: 304,
          title: "2025年道路大修工程",
          maintenanceType: "大修工程",
          structureType: "道路",
          startDate: "2025-11-01",
          endDate: "2025-12-01",
          status: "验收通过",
          acceptancePerson: "赵六",
          acceptanceTime: "2025-12-05 09:30",
          acceptanceOpinion:
            "道路大修工程符合设计要求，路面平整，标识清晰，验收通过。",
        },
        {
          id: 305,
          title: "2025年桥梁保养小修",
          maintenanceType: "保养小修",
          structureType: "桥梁",
          startDate: "2025-10-05",
          endDate: "2025-10-25",
          status: "验收未通过",
          acceptancePerson: "孙七",
          acceptanceTime: "2025-10-28 15:15",
          acceptanceOpinion:
            "保养小修工作不彻底，部分细节处理不到位，要求重新施工。",
        },
        {
          id: 306,
          title: "2025年隧道改扩建",
          maintenanceType: "改扩建工程",
          structureType: "隧道",
          startDate: "2025-07-15",
          endDate: "2025-08-15",
          status: "验收通过",
        },
        {
          id: 307,
          title: "2025年道路保养小修",
          maintenanceType: "保养小修",
          structureType: "道路",
          startDate: "2025-11-10",
          endDate: "2025-11-30",
          status: "验收通过",
        },
        {
          id: 308,
          title: "2025年桥梁大修项目",
          maintenanceType: "大修工程",
          structureType: "桥梁",
          startDate: "2025-09-15",
          endDate: "2025-10-15",
          status: "验收未通过",
        },
        {
          id: 309,
          title: "2025年隧道中修工程",
          maintenanceType: "中修工程",
          structureType: "隧道",
          startDate: "2025-08-20",
          endDate: "2025-09-20",
          status: "验收通过",
        },
      ];

      // 所有养护任务数据
      const allMaintenanceTasksData = [
        {
          id: 9,
          title: "2025年道路改扩建计划",
          maintenanceType: "改扩建工程",
          structureType: "道路",
          startDate: "2025-10-15",
          endDate: "2025-11-15",
        },
        {
          id: 1,
          title: "2025年保养小修养护计划",
          maintenanceType: "保养小修",
          structureType: "桥梁",
          startDate: "2025-11-10",
          endDate: "2025-12-10",
        },
        {
          id: 2,
          title: "2025年中修工程计划",
          maintenanceType: "中修工程",
          structureType: "隧道",
          startDate: "2025-11-15",
          endDate: "2025-12-15",
        },
        {
          id: 3,
          title: "2025年大修工程计划",
          maintenanceType: "大修工程",
          structureType: "道路",
          startDate: "2025-11-20",
          endDate: "2025-12-20",
        },
        {
          id: 4,
          title: "2025年加固工程计划",
          maintenanceType: "加固工程",
          structureType: "桥梁",
          startDate: "2025-11-25",
          endDate: "2025-12-25",
        },
        {
          id: 11,
          title: "2025年桥梁加固工程",
          maintenanceType: "加固工程",
          structureType: "桥梁",
          startDate: "2025-10-20",
          endDate: "2025-11-20",
        },
        {
          id: 12,
          title: "2025年道路大修计划",
          maintenanceType: "大修工程",
          structureType: "道路",
          startDate: "2025-11-01",
          endDate: "2025-12-01",
        },
      ];

      // 损坏类型映射
      const diseaseTypeMap = {
        桥面铺装: ["网裂或龟裂", "波浪及车辙", "坑槽"],
        伸缩缝: ["螺帽松动", "缝内沉积物堵塞", "钢材料破损", "止水带破损"],
        隔音屏: [
          "玻璃破损",
          "吸音板锈蚀变形等",
          "护板脱落或缺失",
          "整体结构晃动结构失稳",
        ],
        防撞体: ["露筋锈蚀", "混凝土破损", "油漆剥落"],
        检查井: [
          "整体结构晃动失稳",
          "检查井周边沥青面层破损",
          "井体出现倾斜或沉陷",
        ],
      };

      // 四级级联关系：构件/设备类型 -> 检查项 -> 损坏类型 -> 参数描述类型
      const componentDiseaseMap = {
        桥面系: {
          桥面铺装: {
            网裂或龟裂: "损坏长度",
            坑槽: "破坏宽度",
          },
          伸缩缝: {
            螺帽松动: "破坏宽度",
            接缝处高差: "损坏长度",
          },
        },
        上部结构: {
          钢结构物: {
            变色起皮: "损坏长度",
            油漆剥落: "破坏宽度",
          },
          横向联系: {
            连接件断裂: "损坏长度",
            横隔板网裂: "破坏宽度",
          },
        },
        下部结构: {
          支座: {
            钢支座损坏: "损坏长度",
            钢垫板锈蚀: "破坏宽度",
          },
          拱脚: {
            拱脚位移: "损坏长度",
            拱脚开裂: "破坏宽度",
          },
        },
      };

      // 青岛路任务的检查项类别列表
      const diseaseCategories = [
        "桥面铺装",
        "伸缩缝",
        "隔音屏",
        "防撞体",
        "检查井",
      ];

      // 检查是否为青岛路特殊任务
      function isQingdaoRoadTask(task) {
        // 不再匹配任何任务，让所有任务都使用普通任务格式
        return false;
      }

      // 获取所属结构物名称
      function getStructureName(task) {
        if (!task?.title) return "";
        const match = task.title.match(/日常定期巡检(.+)\s+\d{4}-\d{2}-\d{2}/);
        return match ? match[1] : "";
      }

      // 获取巡检计划开始时间（前一天9:00）
      function getPlanStartDate(task) {
        if (!task?.planDate) return "";
        const planDate = new Date(task.planDate);
        planDate.setDate(planDate.getDate() - 1);
        const year = planDate.getFullYear();
        const month = String(planDate.getMonth() + 1).padStart(2, "0");
        const day = String(planDate.getDate()).padStart(2, "0");
        return `${year}-${month}-${day} 9:00`;
      }

      // 获取巡检计划结束时间（当天9:00）
      function getPlanEndDate(task) {
        if (!task?.planDate) return "";
        return `${task.planDate} 9:00`;
      }

      // 更新时间
      function updateTime() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, "0");
        const minutes = String(now.getMinutes()).padStart(2, "0");
        document.getElementById(
          "current-time"
        ).textContent = `${hours}:${minutes}`;
      }

      // 切换主页面Tab
      function switchMainTab(tab) {
        appState.currentMainTab = tab;

        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示选中的页面
        document.getElementById(`${tab}-page`).classList.remove("hidden");

        // 更新导航栏状态
        document.querySelectorAll(".nav-item").forEach((item) => {
          item.classList.remove("active");
        });
        event.target.closest(".nav-item").classList.add("active");

        // 更新页面标题
        const titles = {
          home: "首页",
          todo: "待办",
          profile: "个人中心",
        };
        document.getElementById("page-title").textContent = titles[tab];

        // 隐藏返回按钮和底部导航栏
        document.getElementById("back-btn").classList.add("hidden");
        document.getElementById("bottom-nav").classList.remove("hidden");

        appState.currentPage = "main";

        // 加载对应数据
        if (tab === "todo") {
          loadTodoData();
        }
      }

      // 切换巡检Tab
      function switchInspectionTab(tab) {
        appState.currentInspectionTab = tab;

        // 更新Tab按钮状态
        document
          .querySelectorAll("#inspection-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        // 找到对应的tab按钮并添加active类
        if (tab === "pending") {
          document
            .querySelector("#inspection-page .tab-button:first-child")
            .classList.add("active");
        } else {
          document
            .querySelector("#inspection-page .tab-button:last-child")
            .classList.add("active");
        }

        // 显示/隐藏对应内容
        if (tab === "pending") {
          document
            .getElementById("pending-inspection")
            .classList.remove("hidden");
          document.getElementById("records-inspection").classList.add("hidden");
        } else {
          document.getElementById("pending-inspection").classList.add("hidden");
          document
            .getElementById("records-inspection")
            .classList.remove("hidden");
        }
      }

      // 切换养护Tab
      function switchMaintenanceTab(tab) {
        appState.currentMaintenanceTab = tab;

        // 更新Tab按钮状态
        document
          .querySelectorAll("#maintenance-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        // 找到对应的tab按钮并添加active类
        if (tab === "pending") {
          document
            .querySelector("#maintenance-page .tab-button:first-child")
            .classList.add("active");
        } else {
          document
            .querySelector("#maintenance-page .tab-button:last-child")
            .classList.add("active");
        }

        // 显示/隐藏对应内容
        if (tab === "pending") {
          document
            .getElementById("pending-maintenance")
            .classList.remove("hidden");
          document
            .getElementById("records-maintenance")
            .classList.add("hidden");
        } else {
          document
            .getElementById("pending-maintenance")
            .classList.add("hidden");
          document
            .getElementById("records-maintenance")
            .classList.remove("hidden");
        }
      }

      // 切换巡检上报Tab

      // 切换养护上报Tab
      function switchMaintenanceReportTab(tab) {
        // 更新Tab按钮状态
        document
          .querySelectorAll("#maintenance-report-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        event.target.classList.add("active");

        // 显示/隐藏对应内容
        if (tab === "maintenance") {
          document
            .getElementById("maintenance-info-tab")
            .classList.remove("hidden");
          document
            .getElementById("maintenance-basic-tab")
            .classList.add("hidden");
        } else {
          document
            .getElementById("maintenance-info-tab")
            .classList.add("hidden");
          document
            .getElementById("maintenance-basic-tab")
            .classList.remove("hidden");
        }
      }

      // 导航到巡检页面
      function navigateToInspection() {
        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示巡检页面
        document.getElementById("inspection-page").classList.remove("hidden");

        // 更新UI
        document.getElementById("page-title").textContent = "我的巡检";
        document.getElementById("back-btn").classList.remove("hidden");
        document.getElementById("bottom-nav").classList.add("hidden");

        // 保存当前页面状态
        appState.currentPage = "inspection";
        appState.previousPage = "main";
        // 重置tab为待巡检
        appState.currentInspectionTab = "pending";

        // 重置巡检tab状态
        document
          .querySelectorAll("#inspection-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        document
          .querySelector("#inspection-page .tab-button")
          .classList.add("active");
        document
          .getElementById("pending-inspection")
          .classList.remove("hidden");
        document.getElementById("records-inspection").classList.add("hidden");

        // 清理临时巡检数据
        clearTempInspectionData();

        // 加载巡检数据
        loadInspectionData();
      }

      // 导航到巡检记录页面（从详情返回时使用）
      function navigateToInspectionRecords() {
        // 隐藏所有详情页面
        document
          .querySelectorAll("#inspection-detail-page, #maintenance-detail-page")
          .forEach((page) => {
            page.classList.add("hidden");
          });

        // 重新显示主导航栏和主内容区域
        document.querySelector(".page-nav-header").style.display = "flex";
        document.querySelector("#main-content").style.display = "block";

        // 隐藏所有普通页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示巡检页面
        document.getElementById("inspection-page").classList.remove("hidden");

        // 更新UI
        document.getElementById("page-title").textContent = "我的巡检";
        document.getElementById("back-btn").classList.remove("hidden");
        document.getElementById("bottom-nav").classList.add("hidden");

        // 保存当前页面状态
        appState.currentPage = "inspection";

        // 设置tab为巡检记录
        appState.currentInspectionTab = "records";

        // 重置巡检tab状态
        document
          .querySelectorAll("#inspection-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        // 选择第二个tab（巡检记录）
        document
          .querySelectorAll("#inspection-page .tab-button")[1]
          .classList.add("active");
        document.getElementById("pending-inspection").classList.add("hidden");
        document
          .getElementById("records-inspection")
          .classList.remove("hidden");

        // 清理临时巡检数据
        clearTempInspectionData();

        // 加载巡检数据
        loadInspectionData();
      }

      // 导航到养护页面
      function navigateToMaintenance() {
        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示养护页面
        document.getElementById("maintenance-page").classList.remove("hidden");

        // 更新UI
        document.getElementById("page-title").textContent = "我的养护";
        document.getElementById("back-btn").classList.remove("hidden");
        document.getElementById("bottom-nav").classList.add("hidden");

        // 保存当前页面状态
        appState.currentPage = "maintenance";
        appState.previousPage = "main";
        // 重置tab为待养护
        appState.currentMaintenanceTab = "pending";

        // 重置养护tab状态
        document
          .querySelectorAll("#maintenance-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        document
          .querySelector("#maintenance-page .tab-button")
          .classList.add("active");
        document
          .getElementById("pending-maintenance")
          .classList.remove("hidden");
        document.getElementById("records-maintenance").classList.add("hidden");

        // 加载养护数据
        loadMaintenanceData();
      }

      // 导航到养护记录页面（从详情返回时使用）
      function navigateToMaintenanceRecords() {
        // 隐藏所有详情页面
        document
          .querySelectorAll("#inspection-detail-page, #maintenance-detail-page")
          .forEach((page) => {
            page.classList.add("hidden");
          });

        // 重新显示主导航栏和主内容区域
        document.querySelector(".page-nav-header").style.display = "flex";
        document.querySelector("#main-content").style.display = "block";

        // 隐藏所有普通页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示养护页面
        document.getElementById("maintenance-page").classList.remove("hidden");

        // 更新UI
        document.getElementById("page-title").textContent = "我的养护";
        document.getElementById("back-btn").classList.remove("hidden");
        document.getElementById("bottom-nav").classList.add("hidden");

        // 保存当前页面状态
        appState.currentPage = "maintenance";

        // 设置tab为养护记录
        appState.currentMaintenanceTab = "records";

        // 重置养护tab状态
        document
          .querySelectorAll("#maintenance-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        // 选择第二个tab（养护记录）
        document
          .querySelectorAll("#maintenance-page .tab-button")[1]
          .classList.add("active");
        document.getElementById("pending-maintenance").classList.add("hidden");
        document
          .getElementById("records-maintenance")
          .classList.remove("hidden");

        // 加载养护数据
        loadMaintenanceData();
      }

      // 加载待办数据
      function loadTodoData() {
        loadTodoInspectionTasks();
        loadTodoMaintenanceTasks();
      }

      // 加载待办巡检任务
      function loadTodoInspectionTasks() {
        const container = document.getElementById("inspection-tasks-list");
        const tasks = inspectionTasksData
          .slice(0, 3)
          .filter((task) => !appState.completedTasks.includes(task.id));

        container.innerHTML = tasks
          .map(
            (task) => `
                <div class="card">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="flex-1 text-sm">${task.title}</h3>
                        <span class="text-xs ml-2 ${
                          task.expired ? "text-red-500" : "text-green-500"
                        }">
                            ${task.expired ? "超期" : "正常"}
                        </span>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">计划巡检日期：${
                      task.planDate
                    }</div>
                    <div class="mb-2">
                        <span class="badge ${getStructureTypeBadgeColor(
                          task.structureType
                        )}">
                            ${task.structureType}
                        </span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-600">计划巡检周期：${
                          task.cycle
                        }</span>
                        <button class="btn-primary text-xs px-2 py-1 rounded" onclick="startInspection(${
                          task.id
                        })">
                            开始巡检
                        </button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // 加载待办养护任务
      function loadTodoMaintenanceTasks() {
        const container = document.getElementById("maintenance-tasks-list");
        const tasks = pendingMaintenanceTasks.slice(0, 3);

        container.innerHTML = tasks
          .map(
            (task) => `
                <div class="card">
                    <h3 class="flex-1 text-sm mb-2">${task.title}</h3>
                    <div class="text-xs text-gray-600 mb-2">养护使用类型：${
                      task.maintenanceType
                    }</div>
                    <div class="mb-2">
                        <span class="badge ${getStructureTypeBadgeColor(
                          task.structureType
                        )}">
                            ${task.structureType}
                        </span>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">
                        养护时间：${task.startDate} ~ ${task.endDate}
                    </div>
                    <div class="flex justify-end">
                        <button class="btn-primary text-xs px-2 py-1 rounded" onclick="event.stopPropagation(); startMaintenanceFromPending(${
                          task.id
                        })">
                            开始养护
                        </button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // 加载巡检数据
      function loadInspectionData() {
        loadPendingInspectionTasks();
        loadInspectionRecords();
      }

      // 加载待巡检任务
      function loadPendingInspectionTasks() {
        const container = document.getElementById("pending-tasks-list");
        const tasks = inspectionTasksData.filter(
          (task) => !appState.completedTasks.includes(task.id)
        );

        container.innerHTML = tasks
          .map(
            (task) => `
                <div class="card">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="flex-1 text-sm">${task.title}</h3>
                        <span class="text-xs ml-2 ${
                          task.expired ? "text-red-500" : "text-green-500"
                        }">
                            ${task.expired ? "超期" : "正常"}
                        </span>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">计划巡检日期：${
                      task.planDate
                    }</div>
                    <div class="mb-2">
                        <span class="badge ${getStructureTypeBadgeColor(
                          task.structureType
                        )}">
                            ${task.structureType}
                        </span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-600">计划巡检周期：${
                          task.cycle
                        }</span>
                        <button class="btn-primary text-xs px-2 py-1 rounded" onclick="startInspection(${
                          task.id
                        })">
                            开始巡检
                        </button>
                    </div>
                </div>
            `
          )
          .join("");

        document.getElementById("pending-count").textContent = tasks.length;
      }

      // 加载巡检记录
      function loadInspectionRecords() {
        const container = document.getElementById("records-list");

        container.innerHTML = inspectionRecordsData
          .map(
            (record) => `
                <div class="card cursor-pointer hover:shadow-lg transition-shadow relative overflow-hidden" onclick="viewInspectionDetail(${
                  record.id
                })">
                    <!-- 右上角斜角标签 -->
                    <div class="absolute top-0 right-0 w-24 h-24 overflow-hidden">
                        <div class="absolute transform rotate-45 translate-x-9 -translate-y-1 ${
                          record.result === "完好"
                            ? "bg-green-500"
                            : "bg-red-500"
                        } text-white text-xs font-medium px-8 py-1">
                            ${record.result}
                        </div>
                    </div>
                    <div class="mb-2">
                        <h3 class="text-sm pr-16">${record.title}</h3>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">巡检时间：${
                      record.inspectionTime
                    }</div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="badge ${getStructureTypeBadgeColor(
                          record.structureType
                        )}">
                            ${record.structureType}
                        </span>
                        <span class="text-xs ${
                          record.expired ? "text-red-500" : "text-green-500"
                        }">
                            ${record.expired ? "超期" : "正常"}
                        </span>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">计划巡检周期：${
                      record.cycle
                    }</div>
                </div>
            `
          )
          .join("");

        document.getElementById("records-count").textContent =
          inspectionRecordsData.length;
      }

      // 加载养护数据
      function loadMaintenanceData() {
        loadPendingMaintenanceTasks();
        loadMaintenanceRecords();
      }

      // 加载待养护任务
      function loadPendingMaintenanceTasks() {
        const container = document.getElementById("pending-maintenance-list");

        container.innerHTML = pendingMaintenanceTasks
          .map(
            (task) => `
                <!-- 修改：去掉了onclick事件和cursor-pointer样式，现在点击卡片空白处不会跳转了 -->
                <div class="card">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="flex-1 text-sm">${task.title}</h3>
                        ${
                          task.status
                            ? `
                            <div class="px-2 py-1 rounded text-xs font-medium ${getStatusColor(
                              task.status
                            )}">
                                ${task.status}
                            </div>
                        `
                            : ""
                        }
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护使用类型：${
                      task.maintenanceType
                    }</div>
                    <div class="flex items-center justify-between mb-2 gap-2">
                        <div>
                            <span class="badge ${getStructureTypeBadgeColor(
                              task.structureType
                            )}">
                                ${task.structureType}
                            </span>
                        </div>
                        <button class="btn-primary text-xs px-2 py-1 rounded" onclick="event.stopPropagation(); startMaintenanceFromPending(${
                          task.id
                        })">
                            开始养护
                        </button>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护时间：${
                      task.startDate
                    } ~ ${task.endDate}</div>
                    <div class="flex justify-end gap-2 mb-2">
                        ${
                          task.id === 10 || task.id === 11 || task.id === 12
                            ? `
    
                        `
                            : ""
                        }
                    </div>
                </div>
            `
          )
          .join("");

        document.getElementById("pending-maintenance-count").textContent =
          pendingMaintenanceTasks.length;
      }

      // 加载养护记录
      function loadMaintenanceRecords() {
        const container = document.getElementById("maintenance-records-list");

        container.innerHTML = maintenanceRecordsData
          .map(
            (record) => `
                <div class="card cursor-pointer hover:shadow-lg transition-shadow" onclick="viewMaintenanceDetail(${
                  record.id
                })">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="flex-1 text-sm">${record.title}</h3>
                        ${
                          record.status
                            ? `
                            <div class="px-2 py-1 rounded text-xs font-medium ${getStatusColor(
                              record.status
                            )}">
                                ${record.status}
                            </div>
                        `
                            : ""
                        }
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护使用类型：${
                      record.maintenanceType
                    }</div>
                    <div class="flex items-center justify-between mb-2 ${
                      record.id === 103 ||
                      record.id === 108 ||
                      record.id === 110
                        ? "gap-2"
                        : ""
                    }">
                        <div>
                            <span class="badge ${getStructureTypeBadgeColor(
                              record.structureType
                            )}">
                                ${record.structureType}
                            </span>
                        </div>
                        ${
                          record.id === 103 ||
                          record.id === 108 ||
                          record.id === 110
                            ? `
                            <button class="btn-primary text-xs px-2 py-1 rounded" onclick="event.stopPropagation(); startMaintenanceFromRecords(${record.id})">
                                开始养护
                            </button>
                        `
                            : ""
                        }
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护时间：${
                      record.startDate
                    } ~ ${record.endDate}</div>
                    <div class="flex justify-end gap-2 mb-2">

                    </div>
                </div>
            `
          )
          .join("");

        document.getElementById("maintenance-records-count").textContent =
          maintenanceRecordsData.length;
      }

      // 开始巡检
      function startInspection(taskId) {
        const task = inspectionTasksData.find((t) => t.id === taskId);
        if (!task) return;

        appState.selectedTask = task;
        // 根据当前页面设置previousPage
        if (appState.currentPage === "main") {
          // 从待办页面进入的，设置previousPage为'todo'
          appState.previousPage = "todo";
        } else {
          // 从其他页面进入的，保持原有逻辑
          appState.previousPage = "inspection";
        }
        appState.currentPage = "report";

        // 检查是否有已保存的数据
        const taskKey = `${task.id}-${task.title}`;
        if (appState.savedReports[taskKey]) {
          // 加载已保存的数据
          appState.reportFormState = appState.savedReports[taskKey];
          console.log("已加载保存的数据");
        } else {
          // 重置填报状态
          appState.reportFormState = {
            activeTab: "inspection",
            // --- 修改开始：不再使用单一的 inspectionResult，改为巡检点结构 ---
            // inspectionResult: "", // 旧逻辑移除
            // diseases: [], // 旧逻辑移除
            nextDiseaseId: 1,
            // 青岛路专用
            categoryStates: {
              桥面铺装: { expanded: false, result: "", diseases: [] },
              伸缩缝: { expanded: false, result: "", diseases: [] },
              隔音屏: { expanded: false, result: "", diseases: [] },
              防撞体: { expanded: false, result: "", diseases: [] },
              检查井: { expanded: false, result: "", diseases: [] },
            },
            // --- 新增：普通任务专用（4个巡检点，默认完好） ---
            normalPoints: {
              辽阳快速路: {
                expanded: false,
                result: "完好",
                diseases: [],
                location: "青岛市市南区辽阳快速路",
              },
              辽阳快速路桥面系: {
                expanded: false,
                result: "完好",
                diseases: [],
                location: "青岛市市南区辽阳快速路桥面系",
              },
              巡检点3: {
                expanded: false,
                result: "完好",
                diseases: [],
                location: "青岛市市南区香港中路",
              },
              巡检点4: {
                expanded: false,
                result: "完好",
                diseases: [],
                location: "青岛市市北区海尔路",
              },
            },
            weather: "晴天",
            // --- 修改结束 ---
          };
          console.log("已重置表单");
        }

        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示巡检上报页面
        document
          .getElementById("inspection-report-page")
          .classList.remove("hidden");

        // 更新UI
        document.getElementById("page-title").textContent = "巡检上报";
        document.getElementById("back-btn").classList.remove("hidden");
        document.getElementById("bottom-nav").classList.add("hidden");

        // 填充基本信息
        fillReportBasicInfo(task);

        // 渲染表单内容
        renderInspectionReport();
      }

      // 渲染巡检上报表单
      function renderInspectionReport() {
        const formState = appState.reportFormState;
        const isQingdao = isQingdaoRoadTask(appState.selectedTask);

        // 切换布局
        if (isQingdao) {
          document
            .getElementById("qingdao-road-layout")
            .classList.remove("hidden");
          document.getElementById("normal-task-layout").classList.add("hidden");
          renderQingdaoRoadLayout();
        } else {
          document
            .getElementById("qingdao-road-layout")
            .classList.add("hidden");
          document
            .getElementById("normal-task-layout")
            .classList.remove("hidden");
          renderNormalTaskLayout();
        }

        // 恢复Tab状态
        handleReportTabClick(formState.activeTab);

        // 恢复巡检结果
        setTimeout(() => {
          // 先重置所有radio按钮
          const radios = document.querySelectorAll(
            'input[name="inspectionResult"]'
          );
          radios.forEach((radio) => (radio.checked = false));

          if (formState.inspectionResult) {
            const radio = document.querySelector(
              `input[name="inspectionResult"][value="${formState.inspectionResult}"]`
            );
            if (radio) {
              radio.checked = true;
              onInspectionResultChange(formState.inspectionResult);
            }
          }
          // 如果没有保存的inspectionResult，保持radio按钮未选中状态，disease-buttons和disease-list保持隐藏
        }, 100);
      }

      // 渲染青岛路任务布局
      function renderQingdaoRoadLayout() {
        const formState = appState.reportFormState;
        const categoryList = document.getElementById("category-list");

        categoryList.innerHTML = diseaseCategories
          .map((category) => {
            const categoryState = formState.categoryStates[category];
            return `
                    <div>
                        <!-- 检查项标题栏 -->
                        <div onclick="toggleCategory('${category}')" class="bg-white border border-gray-200 rounded-lg p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50">
                            <span>${category}</span>
                            <div class="flex items-center gap-2">

                                <span class="${
                                  categoryState.result === "发现病害"
                                    ? "text-red-500"
                                    : "text-green-500"
                                }">
                                    ${
                                      categoryState.result === "完好"
                                        ? "正常"
                                        : categoryState.result
                                        ? "异常"
                                        : "正常"
                                    } ${categoryState.expanded ? "▲" : "▼"}
                                </span>
                            </div>
                        </div>

                        <!-- 展开的填报区域 -->
                        ${
                          categoryState.expanded
                            ? `
                            <div class="mt-3 bg-gray-50 border border-gray-200 rounded-lg flex flex-col max-h-[600px]">
                                <!-- 固定区域：巡检结果 + 添加/删除病害按钮 -->
                                <div class="p-4 space-y-4 border-b border-gray-200 bg-white sticky top-0 z-10">
                                    <!-- 巡检结果选择 -->
                                    <div>
                                        <label class="block text-sm mb-2">
                                            巡检结果 <span class="text-red-500">*</span>
                                        </label>
                                        <div class="flex gap-4">
                                            <label class="flex items-center">
                                                <input type="radio" name="result-${category}" value="完好"
                                                       ${
                                                         categoryState.result ===
                                                         "完好"
                                                           ? "checked"
                                                           : ""
                                                       }
                                                       onchange="handleCategoryResultChange('${category}', '完好')" class="mr-2"/>
                                                正常
                                            </label>
                                            <label class="flex items-center">
                                                <input type="radio" name="result-${category}" value="发现病害"
                                                       ${
                                                         categoryState.result ===
                                                         "发现病害"
                                                           ? "checked"
                                                           : ""
                                                       }
                                                       onchange="handleCategoryResultChange('${category}', '发现病害')" class="mr-2"/>
                                                异常
                                            </label>
                                        </div>
                                    </div>

                                    <!-- 发现病害时显示添加/删除病害按钮 -->
                                    ${
                                      categoryState.result === "发现病害"
                                        ? `
                                        <div class="flex gap-2">
                                            <button class="btn-primary flex items-center gap-1" onclick="addCategoryDisease('${category}')">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                                </svg>
                                                添加病害
                                            </button>
                                            ${
                                              categoryState.diseases.some(
                                                (d) => d.selected
                                              )
                                                ? `
                                                <button class="btn-danger flex items-center gap-1" onclick="deleteCategoryDisease('${category}')">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                                    </svg>
                                                    删除病害
                                                </button>
                                            `
                                                : ""
                                            }
                                        </div>
                                    `
                                        : ""
                                    }
                                </div>

                                <!-- 可滚动区域：病害列表 -->
                                ${
                                  categoryState.result === "发现病害" &&
                                  categoryState.diseases.length > 0
                                    ? `
                                    <div class="flex-1 overflow-y-auto p-4">
                                        <div class="space-y-6">
                                            ${categoryState.diseases
                                              .map((disease) =>
                                                renderQingdaoDiseaseForm(
                                                  category,
                                                  disease
                                                )
                                              )
                                              .join("")}
                                        </div>
                                    </div>
                                `
                                    : ""
                                }

                                <!-- 保存按钮（完好或发现病害都显示） -->
                                ${
                                  categoryState.result
                                    ? `
                                    <div class="p-4 pt-0 border-t border-gray-200 bg-white">
                                        <div class="flex justify-end">
                                            <button class="btn-primary text-xs px-6 py-3" onclick="saveCategoryResult('${category}')">
                                                保存
                                            </button>
                                        </div>
                                    </div>
                                `
                                    : ""
                                }
                            </div>
                        `
                            : ""
                        }
                    </div>
                `;
          })
          .join("");
      }

      // 渲染青岛路任务的单个病害表单
      function renderQingdaoDiseaseForm(category, disease) {
        return `
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-4">
                        <h3>病害 ${disease.id}</h3>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" ${
                              disease.selected ? "checked" : ""
                            }
                                   onchange="toggleCategoryDiseaseSelection('${category}', ${
          disease.id
        })"
                                   class="w-4 h-4 cursor-pointer"/>
                            <span class="text-sm text-gray-600 ${
                              disease.selected ? "" : "hidden"
                            }">删除病害</span>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <!-- 病害等级 -->
                        <div>
                            <label class="block text-sm mb-2">
                                病害等级 <span class="text-red-500">*</span>
                            </label>
                            <div class="flex gap-4">
                                <label class="flex items-center">
                                    <input type="radio" name="level-${category}-${
          disease.id
        }" value="轻微"
                                           ${
                                             disease.level === "轻微"
                                               ? "checked"
                                               : ""
                                           }
                                           onchange="handleCategoryDiseaseChange('${category}', ${
          disease.id
        }, 'level', '轻微')" class="mr-2"/>
                                    轻微
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="level-${category}-${
          disease.id
        }" value="中等"
                                           ${
                                             disease.level === "中等"
                                               ? "checked"
                                               : ""
                                           }
                                           onchange="handleCategoryDiseaseChange('${category}', ${
          disease.id
        }, 'level', '中等')" class="mr-2"/>
                                    中等
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="level-${category}-${
          disease.id
        }" value="严重"
                                           ${
                                             disease.level === "严重"
                                               ? "checked"
                                               : ""
                                           }
                                           onchange="handleCategoryDiseaseChange('${category}', ${
          disease.id
        }, 'level', '严重')" class="mr-2"/>
                                    严重
                                </label>
                            </div>
                        </div>

                        <!-- 病害位置 -->
                        <div>
                            <label class="block text-sm mb-2">
                                病害位置 <span class="text-red-500">*</span>
                            </label>
                            <input type="text" placeholder="请填写损坏位置"
                                   value="${disease.location}"
                                   onchange="handleCategoryDiseaseChange('${category}', ${
          disease.id
        }, 'location', this.value)"
                                   class="text-sm"/>
                        </div>

                        <!-- 检查项 -->
                        <div class="mb-3">
                            <label class="block text-sm mb-2">
                                检查项 <span class="text-red-500">*</span>
                            </label>
                            <div class="select-wrapper">
                                <select onchange="handleCategoryDiseaseChange('${category}', ${
          disease.id
        }, 'item', this.value)" disabled class="text-sm">
                                    <option value="" disabled ${
                                      !disease.item ? "selected" : ""
                                    }>请选择</option>
                                    ${diseaseCategories
                                      .map(
                                        (cat) => `
                                        <option value="${cat}" ${
                                          disease.item === cat ? "selected" : ""
                                        }>${cat}</option>
                                    `
                                      )
                                      .join("")}
                                </select>
                                <svg class="select-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                </svg>
                            </div>
                        </div>
                        
                        <!-- 损坏类型 -->
                        <div class="mb-3">
                            <label class="block text-sm mb-2">
                                损坏类型 <span class="text-red-500">*</span>
                            </label>
                            <div class="flex gap-2">
                                <div class="flex-1 select-wrapper">
                                    <select onchange="handleCategoryDiseaseChange('${category}', ${
          disease.id
        }, 'type', this.value)"
                                            ${
                                              !disease.item ? "disabled" : ""
                                            } class="text-sm">
                                        <option value="" disabled ${
                                          !disease.type ? "selected" : ""
                                        }>请选择</option>
                                        ${
                                          disease.item &&
                                          diseaseTypeMap[disease.item]
                                            ? diseaseTypeMap[disease.item]
                                                .map(
                                                  (type) =>
                                                    `<option value="${type}" ${
                                                      disease.type === type
                                                        ? "selected"
                                                        : ""
                                                    }>${type}</option>`
                                                )
                                                .join("")
                                            : ""
                                        }
                                    </select>
                                    <svg class="select-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                    </svg>
                                </div>

                            </div>
                        </div>

                        <!-- 病害描述 -->
                        <div>
                            <label class="block text-sm mb-2">
                                病害描述 <span class="text-red-500">*</span>
                            </label>
                            <textarea placeholder="填写详细描述，最多 200 字"
                                      onchange="handleCategoryDiseaseChange('${category}', ${
          disease.id
        }, 'description', this.value)"
                                      maxlength="200" rows="4" class="text-sm">${
                                        disease.description
                                      }</textarea>
                            <div class="text-xs text-gray-500 text-right mt-1">
                                ${disease.description.length}/200
                            </div>
                        </div>

                        <!-- 现场照片 -->
                        <div>
                            <label class="block text-sm mb-2">
                                现场照片 <span class="text-red-500">*</span>
                            </label>
                            <div class="space-y-2">
                                <!-- 照片预览 -->
                                ${
                                  disease.photos.length > 0
                                    ? `
                                    <div class="photo-grid">
                                        ${disease.photos
                                          .map(
                                            (photo, photoIndex) => `
                                            <div class="photo-item relative">
                                                <img src="${photo}" alt="照片 ${
                                              photoIndex + 1
                                            }" class="w-full h-24 object-cover rounded"/>
                                                <button onclick="removeCategoryPhoto('${category}', ${
                                              disease.id
                                            }, ${photoIndex})"
                                                        class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        `
                                          )
                                          .join("")}
                                    </div>
                                `
                                    : ""
                                }
                                <!-- 上传按钮 -->
                                <label class="inline-flex items-center justify-center px-2 py-0 bg-blue-500 text-white rounded cursor-pointer hover:bg-blue-600 text-xs h-6">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                    上传照片
                                    <input type="file" accept="image/*" multiple
                                           onchange="handleCategoryPhotoUpload('${category}', ${
          disease.id
        }, this)"
                                           class="hidden"/>
                                </label>
                            </div>
                        </div>

                        <!-- 保存病害按钮 -->
                        <div class="flex justify-end">
                            <button class="btn-success text-xs px-6 py-3" onclick="submitCategoryDisease('${category}', ${
          disease.id
        })">
                                保存
                            </button>
                        </div>

                        <!-- 保存病害按钮 -->
                        <div class="flex justify-end mt-4">
                            <button class="btn-success text-xs px-6 py-3" onclick="saveNormalPointDisease('${pointName}', ${
          disease.id
        })">
                                保存
                            </button>
                        </div>
                    </div>

                </div>
            `;
      }

      // 渲染普通任务布局
      function renderNormalTaskLayout() {
        const formState = appState.reportFormState;
        const task = appState.selectedTask;
        const container = document.getElementById("normal-task-layout");
        const points = Object.keys(formState.normalPoints);

        let html = `
                <!-- 顶部固定区域 -->
                <div class="p-4 border-b border-gray-200 bg-white mb-3 sticky top-0 z-20 shadow-sm space-y-2">
                    <div class="flex items-start">
                        <span class="text-gray-600 text-sm font-bold w-20 flex-shrink-0">任务名称：</span>
                        <span class="text-sm font-bold text-gray-900 break-all">${
                          task.title
                        }</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-gray-600 text-sm font-bold w-20 flex-shrink-0">天气情况：</span>
                        <input type="text" value="${formState.weather || ""}" 
                            onchange="appState.reportFormState.weather = this.value"
                            class="text-sm border-b border-gray-300 focus:border-blue-500 outline-none px-1 py-0.5 w-32"
                            placeholder="请输入天气"/>
                    </div>
                </div>
                
                <div class="p-4 pb-24">
            `;

        html += points
          .map((point) => {
            const pointState = formState.normalPoints[point];
            const statusColor =
              pointState.result === "发现病害"
                ? "text-red-500"
                : "text-green-500";
            const statusText = pointState.result === "完好" ? "正常" : "异常";

            return `
                    <div>
                        <!-- 巡检点标题栏 -->
                        <div onclick="toggleNormalPoint('${point}')" class="bg-white border border-gray-200 rounded-lg p-4 cursor-pointer hover:bg-gray-50 transition shadow-sm">
                            <div class="flex items-center justify-between">
                                <span class="font-bold text-base text-gray-800">${point}</span>
                                <div class="flex items-center gap-2">
                                    <button 
                                        onclick="event.stopPropagation(); openHistory('${point}')" 
                                        class="px-3 py-1 text-xs text-blue-600 border border-blue-600 rounded-md hover:bg-blue-50 transition-colors"
                                    >
                                        历史填报
                                    </button>

                                    <span class="${statusColor} text-sm font-medium flex items-center">
                                        ${statusText} <span class="ml-2 text-xs text-gray-400">${
              pointState.expanded ? "▲" : "▼"
            }</span>
                                    </span>
                                </div>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">
                                <span class="font-medium">巡检位置：</span>${
                                  pointState.location
                                }
                            </div>
                        </div>

                        <!-- 展开区域 -->
                        ${
                          pointState.expanded
                            ? `
                            <div class="bg-gray-50 border border-gray-200 rounded-lg flex flex-col">
                                <div class="p-3 border-b border-gray-200 bg-white rounded-t-lg flex items-center justify-between">
                                    <div class="flex items-center gap-4">
                                        <label class="block text-sm font-bold text-gray-700 mr-2">
                                            巡检结果 <span class="text-red-500">*</span>
                                        </label>
                                        <label class="flex items-center cursor-pointer">
                                            <input type="radio" name="result-${point}" value="完好"
                                                   ${
                                                     pointState.result ===
                                                     "完好"
                                                       ? "checked"
                                                       : ""
                                                   }
                                                   onchange="handleNormalPointResultChange('${point}', '完好')" class="mr-1 w-4 h-4 text-blue-600"/>
                                            <span class="text-sm">正常</span>
                                        </label>
                                        <label class="flex items-center cursor-pointer">
                                            <input type="radio" name="result-${point}" value="发现病害"
                                                   ${
                                                     pointState.result ===
                                                     "发现病害"
                                                       ? "checked"
                                                       : ""
                                                   }
                                                   onchange="handleNormalPointResultChange('${point}', '发现病害')" class="mr-1 w-4 h-4 text-red-600"/>
                                            <span class="text-sm">异常</span>
                                        </label>
                                    </div>

                                    ${
                                      pointState.result === "发现病害"
                                        ? `
                                        <button class="text-blue-600 text-xs flex items-center gap-1 font-medium px-2 py-1 rounded hover:bg-blue-50 border border-blue-200" onclick="addNormalPointDisease('${point}')">
                                            <span>+</span> 添加病害
                                        </button>
                                    `
                                        : ""
                                    }
                                </div>

                                ${
                                  pointState.result === "发现病害" &&
                                  pointState.diseases.length > 0
                                    ? `
                                    <div class="flex-1 overflow-y-auto p-3 space-y-2 bg-gray-100">
                                        ${pointState.diseases
                                          .map((disease, index) =>
                                            renderNormalPointDiseaseForm(
                                              point,
                                              disease,
                                              index
                                            )
                                          )
                                          .join("")}
                                    </div>
                                `
                                    : ""
                                }


                            </div>
                        `
                            : ""
                        }
                    </div>
                `;
          })
          .join("");

        html += `</div>`; // Close main container
        container.innerHTML = html;
      }

      // 渲染普通任务的病害列表
      function renderNormalDiseaseList() {
        const container = document.getElementById("disease-list");
        const formState = appState.reportFormState;

        // 更新删除按钮显示状态
        const deleteBtn = document.getElementById("delete-disease-btn");
        const hasSelected = formState.diseases.some((d) => d.selected);
        if (hasSelected) {
          deleteBtn.classList.remove("hidden");
        } else {
          deleteBtn.classList.add("hidden");
        }

        container.innerHTML = `
                <div class="space-y-6">
                    ${formState.diseases
                      .map((disease, index) =>
                        renderNormalDiseaseForm(disease, index)
                      )
                      .join("")}
                </div>
            `;
      }

      // 渲染普通任务的单个病害表单
      function renderNormalDiseaseForm(disease, index) {
        return `
                <div class="disease-form">
                    <div class="flex items-center justify-between mb-4">
                        <h3>病害 ${index + 1}</h3>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" ${
                              disease.selected ? "checked" : ""
                            }
                                   onchange="toggleDiseaseSelection(${
                                     disease.id
                                   })"
                                   class="w-4 h-4 cursor-pointer"/>
                            <span class="text-sm text-gray-600 ${
                              disease.selected ? "" : "hidden"
                            }">删除病害</span>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <!-- 病害等级 -->
                        <div>
                            <label class="block text-sm mb-2">
                                病害等级 <span class="text-red-500">*</span>
                            </label>
                            <div class="flex gap-4">
                                <label class="flex items-center text-sm">
                                    <input type="radio" name="level-${
                                      disease.id
                                    }" value="轻微"
                                           ${
                                             disease.level === "轻微"
                                               ? "checked"
                                               : ""
                                           }
                                           onchange="updateDiseaseField(${
                                             disease.id
                                           }, 'level', '轻微')" class="mr-2"/>
                                    轻微
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="radio" name="level-${
                                      disease.id
                                    }" value="中等"
                                           ${
                                             disease.level === "中等"
                                               ? "checked"
                                               : ""
                                           }
                                           onchange="updateDiseaseField(${
                                             disease.id
                                           }, 'level', '中等')" class="mr-2"/>
                                    中等
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="radio" name="level-${
                                      disease.id
                                    }" value="严重"
                                           ${
                                             disease.level === "严重"
                                               ? "checked"
                                               : ""
                                           }
                                           onchange="updateDiseaseField(${
                                             disease.id
                                           }, 'level', '严重')" class="mr-2"/>
                                    严重
                                </label>
                            </div>
                        </div>

                        <!-- 病害位置 -->
                        <div>
                            <label class="block text-sm mb-2">
                                病害位置 <span class="text-red-500">*</span>
                            </label>
                            <input type="text" placeholder="请填写损坏位置"
                                   value="${disease.location}"
                                   onchange="updateDiseaseField(${
                                     disease.id
                                   }, 'location', this.value)"
                                   class="text-sm"/>
                        </div>

                        <!-- 检查项 -->
                        <div>
                            <label class="block text-sm mb-2">
                                检查项 <span class="text-red-500">*</span>
                            </label>
                            <div class="select-wrapper">
                                <select onchange="updateDiseaseField(${
                                  disease.id
                                }, 'item', this.value)" class="text-sm">
                                    <option value="" disabled ${
                                      !disease.item ? "selected" : ""
                                    }>请选择</option>
                                    ${diseaseCategories
                                      .map(
                                        (cat) => `
                                        <option value="${cat}" ${
                                          disease.item === cat ? "selected" : ""
                                        }>${cat}</option>
                                    `
                                      )
                                      .join("")}
                                </select>
                                <svg class="select-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                </svg>
                            </div>
                        </div>

                        <!-- 损坏类型 -->
                        <div class="mb-3">
                            <label class="block text-sm mb-2">
                                损坏类型 <span class="text-red-500">*</span>
                            </label>
                            <div class="flex gap-2">
                                <div class="flex-1 select-wrapper">
                                    <select onchange="updateDiseaseField(${
                                      disease.id
                                    }, 'type', this.value)"
                                            ${
                                              !disease.item ? "disabled" : ""
                                            } class="text-sm">
                                        <option value="" disabled ${
                                          !disease.type ? "selected" : ""
                                        }>请选择</option>
                                        ${
                                          disease.item &&
                                          diseaseTypeMap[disease.item]
                                            ? diseaseTypeMap[disease.item]
                                                .map(
                                                  (type) =>
                                                    `<option value="${type}" ${
                                                      disease.type === type
                                                        ? "selected"
                                                        : ""
                                                    }>${type}</option>`
                                                )
                                                .join("")
                                            : ""
                                        }
                                    </select>
                                    <svg class="select-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                    </svg>
                                </div>

                            </div>
                        </div>

                        <!-- 病害描述 -->
                        <div>
                            <label class="block text-sm mb-2">
                                病害描述 <span class="text-red-500">*</span>
                            </label>
                            <textarea placeholder="填写详细描述，最多 200 字"
                                      onchange="updateDiseaseField(${
                                        disease.id
                                      }, 'description', this.value)"
                                      maxlength="200" rows="4" class="text-sm">${
                                        disease.description
                                      }</textarea>
                            <div class="text-xs text-gray-500 text-right mt-1">
                                ${disease.description.length}/200
                            </div>
                        </div>

                        <!-- 现场照片 -->
                        <div>
                            <label class="block text-sm mb-2">
                                现场照片 <span class="text-red-500">*</span>
                            </label>
                            <div class="space-y-2">
                                <!-- 照片预览 -->
                                ${
                                  disease.photos.length > 0
                                    ? `
                                    <div class="photo-grid">
                                        ${disease.photos
                                          .map(
                                            (photo, photoIndex) => `
                                            <div class="photo-item relative">
                                                <img src="${photo}" alt="照片 ${
                                              photoIndex + 1
                                            }" class="w-full h-24 object-cover rounded"/>
                                                <button onclick="removeDiseasePhoto(${
                                                  disease.id
                                                }, ${photoIndex})"
                                                        class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        `
                                          )
                                          .join("")}
                                    </div>
                                `
                                    : ""
                                }
                                <!-- 上传按钮 -->
                                <label class="inline-flex items-center justify-center px-2 py-0 bg-blue-500 text-white rounded cursor-pointer hover:bg-blue-600 text-xs h-6">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                    上传照片
                                    <input type="file" accept="image/*" multiple
                                           onchange="handleDiseasePhotoUpload(${
                                             disease.id
                                           }, this)"
                                           class="hidden"/>
                                </label>
                            </div>
                        </div>

                        <!-- 保存病害按钮 -->
                        <div class="flex justify-end">
                            <button class="btn-success text-xs px-6 py-3" onclick="saveDisease(${
                              disease.id
                            })">
                                保存
                            </button>
                        </div>

                        <!-- 保存病害按钮 -->
                        <div class="flex justify-end mt-4">
                            <button class="btn-success text-xs px-6 py-3" onclick="saveNormalPointDisease('${pointName}', ${
          disease.id
        })">
                                保存
                            </button>
                        </div>
                    </div>

                </div>
            `;
      }

      // --- 普通任务新逻辑 (4个巡检点) ---

      // 更新天气情况
      function updateWeather(weather) {
        appState.reportFormState.weather = weather;
      }

      // 切换巡检点展开/收起
      function toggleNormalPoint(pointName) {
        const pointState = appState.reportFormState.normalPoints[pointName];
        pointState.expanded = !pointState.expanded;
        renderNormalTaskLayout();
      }

      // 显示历史填报

      // 处理巡检点结果变更 (正常/异常)
      function handleNormalPointResultChange(pointName, result) {
        const pointState = appState.reportFormState.normalPoints[pointName];
        pointState.result = result;

        if (result === "完好") {
          // 切回完好时，可选择是否清空（这里暂不清空，防止误操作丢失数据，但UI会隐藏）
        } else if (result === "发现病害") {
          // 如果切换到异常且当前没有病害记录，自动添加一条空的病害
          if (pointState.diseases.length === 0) {
            addNormalPointDisease(pointName);
          }
        }
        renderNormalTaskLayout();
      }

      // 为特定巡检点添加病害
      function addNormalPointDisease(pointName) {
        const formState = appState.reportFormState;
        const disease = {
          id: formState.nextDiseaseId++,
          level: "",
          location: pointName === "辽阳快速路桥面系" ? "辽阳快速路桥面系" : "", // 默认位置
          component: pointName === "辽阳快速路桥面系" ? "桥面系" : "", // 默认构件/设备类型
          item: "",
          type: "",
          description: "",
          damageLength: "", // 损坏长度（坑槽时使用）
          damageDegree: "", // 损坏程度（网裂或龟裂时使用）
          photos: [],
          selected: false,
        };
        // 插入到该点的病害数组
        formState.normalPoints[pointName].diseases.unshift(disease);
        renderNormalTaskLayout();
      }

      // 删除特定巡检点的病害
      function deleteNormalPointDisease(pointName, diseaseId) {
        const pointState = appState.reportFormState.normalPoints[pointName];
        pointState.diseases = pointState.diseases.filter(
          (d) => d.id !== diseaseId
        );
        renderNormalTaskLayout();
      }

      // 更新病害字段
      function updateNormalPointDiseaseField(
        pointName,
        diseaseId,
        field,
        value
      ) {
        const diseases =
          appState.reportFormState.normalPoints[pointName].diseases;
        const disease = diseases.find((d) => d.id === diseaseId);
        if (disease) {
          disease[field] = value;

          // 级联逻辑
          if (field === "component") {
            // 构件/设备类型变化时，重置检查项、类型和参数
            disease.item = "";
            disease.type = "";
            disease.damageLength = "";
            disease.damageDegree = "";
          } else if (field === "item") {
            // 检查项变化时，重置类型和参数
            disease.type = "";
            disease.damageLength = "";
            disease.damageDegree = "";
          } else if (field === "type") {
            // 损坏类型变化时，重置参数
            disease.damageLength = "";
            disease.damageDegree = "";
          }

          renderNormalTaskLayout();
        }
      }

      // 处理照片上传
      function handleNormalPointPhotoUpload(pointName, diseaseId, input) {
        const files = input.files;
        if (!files || files.length === 0) return;

        const disease = appState.reportFormState.normalPoints[
          pointName
        ].diseases.find((d) => d.id === diseaseId);
        if (!disease) return;

        Array.from(files).forEach((file) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            if (e.target?.result) {
              disease.photos.push(e.target.result);
              renderNormalTaskLayout();
            }
          };
          reader.readAsDataURL(file);
        });
      }

      // 删除照片
      function removeNormalPointPhoto(pointName, diseaseId, photoIndex) {
        const disease = appState.reportFormState.normalPoints[
          pointName
        ].diseases.find((d) => d.id === diseaseId);
        if (disease) {
          disease.photos.splice(photoIndex, 1);
          renderNormalTaskLayout();
        }
      }

      // 保存单个病害
      function saveDisease(pointName, diseaseId) {
        const disease = appState.reportFormState.normalPoints[
          pointName
        ].diseases.find((d) => d.id === diseaseId);

        if (!disease) return;

        // 验证必填字段
        if (!disease.level) {
          alert("请选择病害等级");
          return;
        }
        if (!disease.location) {
          alert("请填写病害位置");
          return;
        }
        if (!disease.item) {
          alert("请选择检查项");
          return;
        }
        if (!disease.type) {
          alert("请选择损坏类型");
          return;
        }
        if (!disease.description) {
          alert("请填写病害描述");
          return;
        }
        if (!disease.photos || disease.photos.length === 0) {
          alert("请上传照片");
          return;
        }

        // 保存到全局缓存
        const taskKey = `${appState.selectedTask.id}-${appState.selectedTask.title}`;
        appState.savedReports[taskKey] = appState.reportFormState;
        saveReportsToStorage();
        alert(`病害 ${diseaseId} 已保存`);
      }

      // 保存普通巡检点的病害
      function saveNormalPointDisease(pointName, diseaseId) {
        const disease = appState.reportFormState.normalPoints[
          pointName
        ].diseases.find((d) => d.id === diseaseId);

        if (!disease) return;

        // 验证必填字段
        if (!disease.level) {
          alert("请选择病害等级");
          return;
        }
        if (!disease.location) {
          alert("请填写病害位置");
          return;
        }
        if (!disease.component) {
          alert("请选择构件/设备类型");
          return;
        }
        if (!disease.item) {
          alert("请选择检查项");
          return;
        }
        if (!disease.type) {
          alert("请选择损坏类型");
          return;
        }
        if (!disease.description) {
          alert("请填写病害描述");
          return;
        }
        if (!disease.photos || disease.photos.length === 0) {
          alert("请上传现场照片");
          return;
        }

        // 保存到全局缓存
        const taskKey = `${appState.selectedTask.id}-${appState.selectedTask.title}`;
        appState.savedReports[taskKey] = appState.reportFormState;
        saveReportsToStorage();
        alert(`病害 ${diseaseId} 已保存`);
      }

      // 保存单个巡检点结果
      function saveNormalPointResult(pointName) {
        const pointState = appState.reportFormState.normalPoints[pointName];

        if (pointState.result === "发现病害") {
          if (pointState.diseases.length === 0) {
            alert(`请为 ${pointName} 添加至少一个病害信息`);
            return;
          }
          // 验证病害完整性（包含新字段）
          const incomplete = pointState.diseases.some(
            (d) =>
              !d.level ||
              !d.location ||
              !d.component ||
              !d.item ||
              !d.type ||
              !d.description
          );
          if (incomplete) {
            alert(`请完整填写 ${pointName} 的所有病害信息`);
            return;
          }
        }

        // 保存到全局缓存
        const taskKey = `${appState.selectedTask.id}-${appState.selectedTask.title}`;
        appState.savedReports[taskKey] = appState.reportFormState;
        saveReportsToStorage();
        alert(`${pointName} 信息已保存`);
        // 收起
        pointState.expanded = false;
        renderNormalTaskLayout();
      }

      // 渲染单个病害表单 (复用样式)
      function renderNormalPointDiseaseForm(pointName, disease, index) {
        return `
                <div class="disease-form border border-gray-300 p-3 rounded bg-white">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-bold text-gray-700">病害 ${
                          index + 1
                        }</h4>
                        <button class="text-red-500 text-xs" onclick="deleteNormalPointDisease('${pointName}', ${
          disease.id
        })">删除</button>
                    </div>
                    
                    <div class="space-y-2">
                        <!-- 等级 -->
                        <div>
                            <label class="block text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>病害等级</label>
                            <div class="flex gap-4">
                                ${["轻微", "中等", "严重"]
                                  .map(
                                    (level) => `
                                    <label class="flex items-center text-sm">
                                        <input type="radio" name="level-${
                                          disease.id
                                        }" value="${level}"
                                            ${
                                              disease.level === level
                                                ? "checked"
                                                : ""
                                            }
                                            onchange="updateNormalPointDiseaseField('${pointName}', ${
                                      disease.id
                                    }, 'level', '${level}')" class="mr-1"/>
                                        ${level}
                                    </label>
                                `
                                  )
                                  .join("")}
                            </div>
                        </div>

                        <!-- 位置 -->
                        <div>
                            <label class="block text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>病害位置</label>
                            <input type="text" value="${disease.location}" 
                                onchange="updateNormalPointDiseaseField('${pointName}', ${
          disease.id
        }, 'location', this.value)"
                                class="text-sm w-full border rounded px-2 py-1" />
                        </div>

                        <!-- 构件/设备类型 -->
                        <div>
                            <label class="block text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>构件/设备类型</label>
                            ${
                              pointName === "辽阳快速路桥面系"
                                ? `
                                <input type="text" value="${
                                  disease.component || "桥面系"
                                }" 
                                    readonly 
                                    class="text-sm w-full border rounded px-2 py-1 bg-gray-100" 
                                    style="cursor: not-allowed;" />
                            `
                                : `
                                <div class="select-wrapper">
                                    <select onchange="updateNormalPointDiseaseField('${pointName}', ${
                                    disease.id
                                  }, 'component', this.value)" class="text-sm w-full border rounded px-2 py-1 h-8">
                                        <option value="" disabled ${
                                          !disease.component ? "selected" : ""
                                        }>请选择</option>
                                        ${["桥面系", "上部结构", "下部结构"]
                                          .map(
                                            (comp) => `
                                            <option value="${comp}" ${
                                              disease.component === comp
                                                ? "selected"
                                                : ""
                                            }>${comp}</option>
                                        `
                                          )
                                          .join("")}
                                    </select>
                                </div>
                            `
                            }
                        </div>

                        <!-- 检查项 -->
                        <div>
                            <label class="block text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>检查项</label>
                            <div class="select-wrapper">
                                <select onchange="updateNormalPointDiseaseField('${pointName}', ${
          disease.id
        }, 'item', this.value)" class="text-sm w-full border rounded px-2 py-1 h-8">
                                    <option value="" disabled ${
                                      !disease.item ? "selected" : ""
                                    }>请选择</option>
                                    ${
                                      disease.component &&
                                      componentDiseaseMap[disease.component]
                                        ? Object.keys(
                                            componentDiseaseMap[
                                              disease.component
                                            ]
                                          )
                                            .map(
                                              (item) => `
                                            <option value="${item}" ${
                                                disease.item === item
                                                  ? "selected"
                                                  : ""
                                              }>${item}</option>
                                        `
                                            )
                                            .join("")
                                        : diseaseCategories
                                            .map(
                                              (cat) => `
                                            <option value="${cat}" ${
                                                disease.item === cat
                                                  ? "selected"
                                                  : ""
                                              }>${cat}</option>
                                        `
                                            )
                                            .join("")
                                    }
                                </select>
                            </div>
                        </div>

                        <!-- 类型 -->
                        <div>
                            <label class="block text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>损坏类型</label>
                            <div class="select-wrapper">
                                <select onchange="updateNormalPointDiseaseField('${pointName}', ${
          disease.id
        }, 'type', this.value)" 
                                        ${
                                          !disease.item ? "disabled" : ""
                                        } class="text-sm w-full border rounded px-2 py-1 h-8">
                                    <option value="" disabled ${
                                      !disease.type ? "selected" : ""
                                    }>请选择</option>
                                    ${
                                      disease.component &&
                                      disease.item &&
                                      componentDiseaseMap[disease.component] &&
                                      componentDiseaseMap[disease.component][
                                        disease.item
                                      ]
                                        ? Object.keys(
                                            componentDiseaseMap[
                                              disease.component
                                            ][disease.item]
                                          )
                                            .map(
                                              (t) => `
                                            <option value="${t}" ${
                                                disease.type === t
                                                  ? "selected"
                                                  : ""
                                              }>${t}</option>
                                        `
                                            )
                                            .join("")
                                        : diseaseTypeMap[disease.item]
                                        ? diseaseTypeMap[disease.item]
                                            .map(
                                              (t) =>
                                                `<option value="${t}" ${
                                                  disease.type === t
                                                    ? "selected"
                                                    : ""
                                                }>${t}</option>`
                                            )
                                            .join("")
                                        : ""
                                    }
                                </select>
                            </div>
                        </div>



                        <!-- 动态参数字段 -->
                        ${
                          disease.type === "坑槽"
                            ? `
                        <div>
                            <label class="block text-sm text-gray-500 mb-1">参数描述：损坏长度</label>
                            <div class="flex items-center gap-2">
                                <input type="text" value="${
                                  disease.damageLength || ""
                                }" 
                                    onchange="updateNormalPointDiseaseField('${pointName}', ${
                                disease.id
                              }, 'damageLength', this.value)"
                                    placeholder="请输入损坏长度" class="text-sm border rounded px-2 py-1 flex-1"/>
                                <span class="text-sm text-gray-500">米</span>
                            </div>
                        </div>
                        `
                            : ""
                        }

                        ${
                          disease.type === "网裂或龟裂"
                            ? `
                        <div>
                            <label class="block text-sm text-gray-500 mb-1">参数描述：损坏程度</label>
                            <select onchange="updateNormalPointDiseaseField('${pointName}', ${
                                disease.id
                              }, 'damageDegree', this.value)" 
                                class="text-sm w-full border rounded px-2 py-1 h-8">
                                <option value="" disabled ${
                                  !disease.damageDegree ? "selected" : ""
                                }>请选择</option>
                                <option value="轻微" ${
                                  disease.damageDegree === "轻微"
                                    ? "selected"
                                    : ""
                                }>轻微</option>
                                <option value="一般" ${
                                  disease.damageDegree === "一般"
                                    ? "selected"
                                    : ""
                                }>一般</option>
                                <option value="严重" ${
                                  disease.damageDegree === "严重"
                                    ? "selected"
                                    : ""
                                }>严重</option>
                            </select>
                        </div>
                        `
                            : ""
                        }

                        <!-- 描述 -->
                        <div>
                            <label class="block text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>病害描述</label>
                            <textarea rows="2" class="w-full border rounded px-2 py-1 text-sm"
                                onchange="updateNormalPointDiseaseField('${pointName}', ${
          disease.id
        }, 'description', this.value)">${disease.description}</textarea>
                        </div>

                        <!-- 照片 -->
                        <div>
                            <label class="block text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>照片</label>
                            <div class="grid grid-cols-4 gap-2 mb-2">
                                ${disease.photos
                                  .map(
                                    (p, i) => `
                                    <div class="relative aspect-square">
                                        <img src="${p}" class="w-full h-full object-cover rounded"/>
                                        <button onclick="removeNormalPointPhoto('${pointName}', ${disease.id}, ${i})" class="absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">×</button>
                                    </div>
                                `
                                  )
                                  .join("")}
                                <label class="border border-dashed border-gray-300 rounded flex items-center justify-center cursor-pointer aspect-square hover:bg-gray-50">
                                    <span class="text-2xl text-gray-400">+</span>
                                    <input type="file" accept="image/*" class="hidden" onchange="handleNormalPointPhotoUpload('${pointName}', ${
          disease.id
        }, this)"/>
                                </label>
                            </div>
                        </div>

                        <!-- 保存病害按钮 -->
                        <div class="flex justify-end mt-4">
                            <button class="btn-success text-xs px-6 py-3" onclick="saveNormalPointDisease('${pointName}', ${
          disease.id
        })">
                                保存
                            </button>
                        </div>
                    </div>

                </div>
            `;
      }

      // 青岛路任务相关函数
      function toggleCategory(category) {
        const formState = appState.reportFormState;
        const categoryState = formState.categoryStates[category];
        categoryState.expanded = !categoryState.expanded;
        renderQingdaoRoadLayout();
      }

      function handleCategoryResultChange(category, result) {
        appState.reportFormState.categoryStates[category].result = result;
        if (result === "完好") {
          appState.reportFormState.categoryStates[category].diseases = [];
        }
        renderQingdaoRoadLayout();
      }

      function addCategoryDisease(category) {
        const formState = appState.reportFormState;
        const task = formState.selectedTask;
        const structureName = getStructureName(task);

        const disease = {
          id: formState.nextDiseaseId++,
          level: "",
          location: `${structureName}${category}`, // 自动显示：所属结构物+检查项
          item: category, // 自动显示：检查项，根据从哪个检查项进入就自动选定
          type: "",
          description: "",
          photos: [],
          selected: false,
        };
        // 插入到数组开头，新添加的病害在上面展示
        formState.categoryStates[category].diseases.unshift(disease);
        renderQingdaoRoadLayout();
      }

      function handleCategoryDiseaseChange(category, diseaseId, field, value) {
        const diseases =
          appState.reportFormState.categoryStates[category].diseases;
        const disease = diseases.find((d) => d.id === diseaseId);
        if (disease) {
          disease[field] = value;
          if (field === "item") {
            disease.type = ""; // 重置损坏类型
          }
          renderQingdaoRoadLayout();
        }
      }

      function toggleCategoryDiseaseSelection(category, diseaseId) {
        const diseases =
          appState.reportFormState.categoryStates[category].diseases;
        const disease = diseases.find((d) => d.id === diseaseId);
        if (disease) {
          disease.selected = !disease.selected;
          renderQingdaoRoadLayout();
        }
      }

      function deleteCategoryDisease(category) {
        const diseases =
          appState.reportFormState.categoryStates[category].diseases;
        appState.reportFormState.categoryStates[category].diseases =
          diseases.filter((d) => !d.selected);
        renderQingdaoRoadLayout();
      }

      function handleCategoryPhotoUpload(category, diseaseId, eventOrInput) {
        // 支持两种调用方式：handleCategoryPhotoUpload(category, id, event) 或 handleCategoryPhotoUpload(category, id, this)
        const files = eventOrInput.target
          ? eventOrInput.target.files
          : eventOrInput.files;
        if (!files || files.length === 0) return;

        const disease = appState.reportFormState.categoryStates[
          category
        ].diseases.find((d) => d.id === diseaseId);
        if (!disease) return;

        Array.from(files).forEach((file) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            if (e.target?.result) {
              disease.photos.push(e.target.result);
              renderQingdaoRoadLayout();
            }
          };
          reader.readAsDataURL(file);
        });
      }

      function removeCategoryPhoto(category, diseaseId, photoIndex) {
        const disease = appState.reportFormState.categoryStates[
          category
        ].diseases.find((d) => d.id === diseaseId);
        if (disease) {
          disease.photos.splice(photoIndex, 1);
          renderQingdaoRoadLayout();
        }
      }

      function submitCategoryDisease(category, diseaseId) {
        const disease = appState.reportFormState.categoryStates[
          category
        ].diseases.find((d) => d.id === diseaseId);
        if (!disease) return;

        if (
          !disease.level ||
          !disease.location ||
          !disease.item ||
          !disease.type ||
          !disease.description
        ) {
          alert("请填写完整病害信息");
          return;
        }

        // 保存当前填报数据到App状态
        const taskKey = `${appState.selectedTask.id}-${appState.selectedTask.title}`;
        appState.savedReports[taskKey] = appState.reportFormState;
        saveReportsToStorage();
        saveReportsToStorage();

        alert("病害信息已保存成功！");
      }

      function saveCategoryResult(category) {
        const categoryState = appState.reportFormState.categoryStates[category];

        if (categoryState.result === "完好") {
          alert(`${category}巡检结果已保存：正常`);
        } else if (categoryState.diseases.length === 0) {
          alert("请添加至少一个病害");
        } else {
          // 验证所有病害的必填项是否都已填写
          const hasIncompleteDisease = categoryState.diseases.some(
            (disease) =>
              !disease.level ||
              !disease.location ||
              !disease.item ||
              !disease.type ||
              !disease.description
          );

          if (hasIncompleteDisease) {
            alert(
              `请完整填写${category}下所有病害的必填项（病害等级、病害位置、检查项、损坏类型、病害描述）`
            );
            return;
          }

          alert(`${category}病害信息已保存`);
        }

        // 保存当前填报数据到App状态
        const taskKey = `${appState.selectedTask.id}-${appState.selectedTask.title}`;
        appState.savedReports[taskKey] = appState.reportFormState;
        saveReportsToStorage();
      }

      // 普通任务相关函数
      function onInspectionResultChange(result) {
        appState.reportFormState.inspectionResult = result;

        if (result === "完好") {
          appState.reportFormState.diseases = [];
          document.getElementById("disease-buttons").classList.add("hidden");
          document.getElementById("disease-list").classList.add("hidden");
        } else {
          document.getElementById("disease-buttons").classList.remove("hidden");
          document.getElementById("disease-list").classList.remove("hidden");
          renderNormalDiseaseList();
        }
      }

      function addDisease() {
        const formState = appState.reportFormState;
        const disease = {
          id: formState.nextDiseaseId++,
          level: "",
          location: "",
          item: "",
          type: "",
          description: "",
          photos: [],
          selected: false,
        };
        formState.diseases.unshift(disease);
        renderNormalDiseaseList();
      }

      function toggleDiseaseSelection(diseaseId) {
        const diseases = appState.reportFormState.diseases;
        const disease = diseases.find((d) => d.id === diseaseId);
        if (disease) {
          disease.selected = !disease.selected;
          renderNormalDiseaseList();
        }
      }

      function deleteSelectedDiseases() {
        appState.reportFormState.diseases =
          appState.reportFormState.diseases.filter((d) => !d.selected);
        renderNormalDiseaseList();
      }

      function updateDiseaseField(diseaseId, field, value) {
        const diseases = appState.reportFormState.diseases;
        const disease = diseases.find((d) => d.id === diseaseId);
        if (disease) {
          disease[field] = value;
          if (field === "item") {
            disease.type = ""; // 重置损坏类型
          }
          renderNormalDiseaseList();
        }
      }

      function handleDiseasePhotoUpload(diseaseId, eventOrInput) {
        // 支持两种调用方式：handleDiseasePhotoUpload(id, event) 或 handleDiseasePhotoUpload(id, this)
        const files = eventOrInput.target
          ? eventOrInput.target.files
          : eventOrInput.files;
        if (!files || files.length === 0) return;

        const disease = appState.reportFormState.diseases.find(
          (d) => d.id === diseaseId
        );
        if (!disease) return;

        Array.from(files).forEach((file) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            if (e.target?.result) {
              disease.photos.push(e.target.result);
              renderNormalDiseaseList();
            }
          };
          reader.readAsDataURL(file);
        });
      }

      function removeDiseasePhoto(diseaseId, photoIndex) {
        const disease = appState.reportFormState.diseases.find(
          (d) => d.id === diseaseId
        );
        if (disease) {
          disease.photos.splice(photoIndex, 1);
          renderNormalDiseaseList();
        }
      }

      function saveDisease(diseaseId) {
        const disease = appState.reportFormState.diseases.find(
          (d) => d.id === diseaseId
        );
        if (!disease) return;

        // 验证当前病害是否填写完整
        if (
          !disease.level ||
          !disease.location ||
          !disease.item ||
          !disease.type ||
          !disease.description
        ) {
          alert("请填写完整病害信息");
          return;
        }

        // 验证巡检结果是否已选择
        const inspectionResult = appState.reportFormState.inspectionResult;
        if (!inspectionResult) {
          alert("请选择巡检结果");
          return;
        }

        // 如果选择的是"发现病害"，验证至少有一个病害填写完整
        const incompleteDiseases = appState.reportFormState.diseases.filter(
          (d) => !d.level || !d.location || !d.item || !d.type || !d.description
        );

        if (incompleteDiseases.length > 0) {
          alert("请确保所有病害信息都已填写完整");
          return;
        }

        // 保存当前填报数据到savedReports
        const taskKey = `${appState.selectedTask.id}-${appState.selectedTask.title}`;
        appState.savedReports[taskKey] = appState.reportFormState;
        saveReportsToStorage();

        alert("病害信息已保存成功！");
      }

      // Tab切换函数（通过event参数）
      function handleReportTabClick(tab) {
        // 更新状态
        appState.reportFormState.activeTab = tab;

        // 更新Tab按钮样式
        document
          .querySelectorAll("#inspection-report-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });

        // 为当前选中的tab添加active类
        if (tab === "inspection") {
          document
            .querySelectorAll("#inspection-report-page .tab-button")[0]
            .classList.add("active");
        } else {
          document
            .querySelectorAll("#inspection-report-page .tab-button")[1]
            .classList.add("active");
        }

        // 显示/隐藏对应内容
        if (tab === "inspection") {
          document
            .getElementById("report-inspection-tab")
            .classList.remove("hidden");
          document.getElementById("report-basic-tab").classList.add("hidden");
        } else {
          document
            .getElementById("report-inspection-tab")
            .classList.add("hidden");
          document
            .getElementById("report-basic-tab")
            .classList.remove("hidden");
        }
      }

      // Tab切换函数
      function switchReportTab(tab) {
        // 更新状态
        appState.reportFormState.activeTab = tab;

        // 更新Tab按钮样式
        document
          .querySelectorAll("#inspection-report-page .tab-button")
          .forEach((button) => {
            button.classList.remove(
              "text-blue-600",
              "border-b-2",
              "border-blue-600"
            );
            button.classList.add("text-gray-500");
          });
        event.target.classList.remove("text-gray-500");
        event.target.classList.add(
          "text-blue-600",
          "border-b-2",
          "border-blue-600"
        );

        // 显示/隐藏对应内容
        if (tab === "inspection") {
          document
            .getElementById("report-inspection-tab")
            .classList.remove("hidden");
          document.getElementById("report-basic-tab").classList.add("hidden");
        } else {
          document
            .getElementById("report-inspection-tab")
            .classList.add("hidden");
          document
            .getElementById("report-basic-tab")
            .classList.remove("hidden");
        }
      }

      // 完成填报函数
      function completeInspectionReport() {
        const formState = appState.reportFormState;
        const isQingdao = isQingdaoRoadTask(appState.selectedTask);

        if (isQingdao) {
          // 青岛路任务的特殊验证逻辑
          for (const category in formState.categoryStates) {
            const categoryState = formState.categoryStates[category];
            if (
              categoryState.result === "发现病害" &&
              categoryState.diseases.length > 0
            ) {
              for (const disease of categoryState.diseases) {
                if (
                  !disease.level ||
                  !disease.location ||
                  !disease.item ||
                  !disease.type ||
                  !disease.description
                ) {
                  alert(`请填写完整${category}的病害信息`);
                  return;
                }
              }
            }
          }
        } else {
          // --- 修改：普通任务的新验证逻辑 ---
          // 验证每一个巡检点
          for (const pointName in formState.normalPoints) {
            const pointState = formState.normalPoints[pointName];
            if (pointState.result === "发现病害") {
              if (pointState.diseases.length === 0) {
                alert(`请为 ${pointName} 添加至少一个病害，或将结果改为正常`);
                return;
              }
              // 验证病害完整性（包含新字段）
              for (const disease of pointState.diseases) {
                if (
                  !disease.level ||
                  !disease.location ||
                  !disease.component ||
                  !disease.item ||
                  !disease.type ||
                  !disease.description
                ) {
                  alert(`请填写完整 ${pointName} 的所有病害信息`);
                  return;
                }
              }
            }
          }
          // --- 修改结束 ---
        }

        // 完成填报后清除保存的数据并添加到completedTasks
        const taskKey = `${appState.selectedTask.id}-${appState.selectedTask.title}`;

        // 清除savedReports中的数据
        delete appState.savedReports[taskKey];
        saveReportsToStorage();

        // 添加到completedTasks
        if (!appState.completedTasks.includes(appState.selectedTask.id)) {
          appState.completedTasks.push(appState.selectedTask.id);
        }

        // 添加确认对话框
        if (confirm("您确定要提交数据？")) {
          alert("填报完成！");
          saveReportsToStorage(); // 确保删除操作保存到localStorage
          goBack();
        }
      }

      // 开始养护
      function startMaintenance(taskId) {
        const task = pendingMaintenanceTasks.find((t) => t.id === taskId);
        if (!task) return;

        appState.selectedMaintenanceTask = task;
        appState.previousPage = "maintenance"; // 记录上一页是养护页面
        appState.currentPage = "maintenance-report";

        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示养护上报页面
        document
          .getElementById("maintenance-report-page")
          .classList.remove("hidden");

        // 更新UI
        document.getElementById("page-title").textContent = "养护上报";
        document.getElementById("back-btn").classList.remove("hidden");
        document.getElementById("bottom-nav").classList.add("hidden");

        // 填充基本信息
        fillMaintenanceBasicInfo(task);

        // 显示历史内容（仅针对测试数据）
        showMaintenanceHistoryContent(task);

        // 生成默认养护内容
        generateDefaultMaintenanceContent(task);

        // 重置表单
        resetMaintenanceForm();

        // 重置Tab状态到默认的养护信息页面
        document
          .querySelectorAll("#maintenance-report-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        document
          .querySelector("#maintenance-report-page .tab-button:first-child")
          .classList.add("active");
        document
          .getElementById("maintenance-info-tab")
          .classList.remove("hidden");
        document
          .getElementById("maintenance-basic-tab")
          .classList.add("hidden");

        // 重置Tab状态到默认的养护信息页面
        document
          .querySelectorAll("#maintenance-report-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        document
          .querySelector("#maintenance-report-page .tab-button:first-child")
          .classList.add("active");
        document
          .getElementById("maintenance-info-tab")
          .classList.remove("hidden");
        document
          .getElementById("maintenance-basic-tab")
          .classList.add("hidden");
      }

      // 从待办页面开始养护
      function startMaintenanceFromTodo(taskId) {
        const task = pendingMaintenanceTasks.find((t) => t.id === taskId);
        if (!task) return;

        appState.selectedMaintenanceTask = task;
        appState.previousPage = "todo"; // 记录上一页是待办页面
        appState.currentPage = "maintenance-report";

        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示养护上报页面
        document
          .getElementById("maintenance-report-page")
          .classList.remove("hidden");

        // 更新UI
        document.getElementById("page-title").textContent = "养护上报";
        document.getElementById("back-btn").classList.remove("hidden");
        document.getElementById("bottom-nav").classList.add("hidden");

        // 填充基本信息
        fillMaintenanceBasicInfo(task);

        // 显示历史内容（仅针对测试数据）
        showMaintenanceHistoryContent(task);

        // 生成默认养护内容
        generateDefaultMaintenanceContent(task);

        // 重置表单
        resetMaintenanceForm();

        // 重置Tab状态到默认的养护信息页面
        document
          .querySelectorAll("#maintenance-report-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        document
          .querySelector("#maintenance-report-page .tab-button:first-child")
          .classList.add("active");
        document
          .getElementById("maintenance-info-tab")
          .classList.remove("hidden");
        document
          .getElementById("maintenance-basic-tab")
          .classList.add("hidden");
      }

      // 从我的养护-待养护页面开始养护
      function startMaintenanceFromPending(taskId) {
        const task = pendingMaintenanceTasks.find((t) => t.id === taskId);
        if (!task) return;

        appState.selectedMaintenanceTask = task;
        // 根据当前主Tab判断上一页
        if (appState.currentMainTab === "todo") {
          appState.previousPage = "todo";
        } else {
          appState.previousPage = "maintenance-pending"; // 记录上一页是我的养护-待养护页面
        }
        appState.currentPage = "maintenance-report";

        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示养护上报页面
        document
          .getElementById("maintenance-report-page")
          .classList.remove("hidden");

        // 更新UI
        document.getElementById("page-title").textContent = "养护上报";
        document.getElementById("back-btn").classList.remove("hidden");
        document.getElementById("bottom-nav").classList.add("hidden");

        // 填充基本信息
        fillMaintenanceBasicInfo(task);

        // 显示历史内容（仅针对测试数据）
        showMaintenanceHistoryContent(task);

        // 生成默认养护内容
        generateDefaultMaintenanceContent(task);

        // 重置表单
        resetMaintenanceForm();

        // 重置Tab状态到默认的养护信息页面
        document
          .querySelectorAll("#maintenance-report-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        document
          .querySelector("#maintenance-report-page .tab-button:first-child")
          .classList.add("active");
        document
          .getElementById("maintenance-info-tab")
          .classList.remove("hidden");
        document
          .getElementById("maintenance-basic-tab")
          .classList.add("hidden");
      }

      // 开始验收
      function startAcceptance(taskId) {
        const task = pendingAcceptanceData.find((t) => t.id === taskId);
        if (!task) return;

        appState.selectedAcceptanceTask = task;
        appState.previousPage = "acceptance";
        appState.currentPage = "acceptance-detail";

        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示验收页面
        document
          .getElementById("acceptance-detail-page")
          .classList.remove("hidden");

        // 更新UI
        document.getElementById("page-title").textContent = "验收";
        document.getElementById("back-btn").classList.remove("hidden");
        document.getElementById("bottom-nav").classList.add("hidden");

        // 重置表单
        resetAcceptanceForm();

        // 设置养护计划名称（动态）
        const planNameInput = document.querySelector(
          '#acceptance-info-tab input[type="text"][disabled]'
        );
        if (planNameInput && task.title) {
          planNameInput.value = task.title;
        }

        // 设置字符计数
        setupAcceptanceOpinionCounter();

        // 重置Tab状态到默认的验收信息页面
        document
          .querySelectorAll("#acceptance-detail-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        document
          .querySelector("#acceptance-detail-page .tab-button:first-child")
          .classList.add("active");
        document
          .getElementById("acceptance-info-tab")
          .classList.remove("hidden");
        document.getElementById("acceptance-basic-tab").classList.add("hidden");

        // 检查是否为"2025年道路改扩建计划"，如果是则显示养护历史
        if (task.title === "2025年道路改扩建计划") {
          setTimeout(() => {
            showAcceptanceMaintenanceHistory();
          }, 100);
        }
      }
      function resetAcceptanceForm() {
        document
          .querySelectorAll('input[name="acceptanceResult"]')
          .forEach((radio) => {
            radio.checked = false;
          });
        // 清空验收意见
        const opinionTextarea = document.querySelector(
          'textarea[placeholder="请输入验收意见"]'
        );
        if (opinionTextarea) {
          opinionTextarea.value = "";
        }
        // 重置字符计数
        const countElement = document.getElementById(
          "acceptance-opinion-count"
        );
        if (countElement) {
          countElement.textContent = "0";
        }
      }

      // 验收Tab切换
      function handleAcceptanceTabClick(tab) {
        // 切换Tab按钮状态
        document
          .querySelectorAll("#acceptance-detail-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });

        if (tab === "acceptance") {
          document
            .querySelector("#acceptance-detail-page .tab-button:first-child")
            .classList.add("active");
          document
            .getElementById("acceptance-info-tab")
            .classList.remove("hidden");
          document
            .getElementById("acceptance-basic-tab")
            .classList.add("hidden");
        } else {
          document
            .querySelector("#acceptance-detail-page .tab-button:last-child")
            .classList.add("active");
          document
            .getElementById("acceptance-info-tab")
            .classList.add("hidden");
          document
            .getElementById("acceptance-basic-tab")
            .classList.remove("hidden");
        }
      }

      // 处理验收照片上传
      function handleAcceptancePhotos(event) {
        const files = event.target.files;
        const photosContainer = document.getElementById("acceptance-photos");

        Array.from(files).forEach((file) => {
          const reader = new FileReader();
          reader.onload = function (e) {
            const photoDiv = document.createElement("div");
            photoDiv.className = "photo-item";
            photoDiv.innerHTML = `<img src="${e.target.result}" alt="验收照片"/>`;
            photosContainer.appendChild(photoDiv);
          };
          reader.readAsDataURL(file);
        });
      }

      // 验收意见字符计数
      function setupAcceptanceOpinionCounter() {
        const acceptanceOpinionTextarea = document.querySelector(
          'textarea[placeholder="请输入验收意见"]'
        );
        if (acceptanceOpinionTextarea) {
          acceptanceOpinionTextarea.addEventListener("input", function () {
            const count = this.value.length;
            const countElement = document.getElementById(
              "acceptance-opinion-count"
            );
            if (countElement) {
              countElement.textContent = count;
            }
            if (count > 100) {
              this.value = this.value.substring(0, 100);
              if (countElement) {
                countElement.textContent = "100";
              }
            }
          });
        }
      }

      // 完成验收
      function completeAcceptance() {
        const result = document.querySelector(
          'input[name="acceptanceResult"]:checked'
        );
        if (!result) {
          alert("请选择验收状态");
          return;
        }

        const acceptanceData = {
          id: appState.selectedAcceptanceTask.id + 100, // 转为记录ID
          title: appState.selectedAcceptanceTask.title,
          maintenanceType: appState.selectedAcceptanceTask.maintenanceType,
          structureType: appState.selectedAcceptanceTask.structureType,
          startDate: appState.selectedAcceptanceTask.startDate,
          endDate: appState.selectedAcceptanceTask.endDate,
          status: result.value,
          acceptanceDate: new Date().toISOString().split("T")[0],
        };

        // 从待验收数据中移除
        const index = pendingAcceptanceData.findIndex(
          (t) => t.id === appState.selectedAcceptanceTask.id
        );
        if (index > -1) {
          pendingAcceptanceData.splice(index, 1);
        }

        // 添加到验收记录
        acceptanceRecordsData.push(acceptanceData);

        // 刷新页面数据
        loadAcceptanceTasks();
        loadAcceptanceRecords();

        // 返回上一页
        goBack();
      }

      // 填充验收记录详情数据
      function fillAcceptanceRecordDetail(record) {
        // 设置验收状态
        const resultRadios = document.querySelectorAll(
          'input[name="acceptanceRecordResult"]'
        );
        resultRadios.forEach((radio) => {
          radio.checked = radio.value === record.status;
        });

        // 设置验收意见
        const opinionTextarea = document.querySelector(
          '#acceptance-record-info-tab textarea:not([name="acceptanceRecordResult"])'
        );
        if (opinionTextarea && record.acceptanceOpinion) {
          opinionTextarea.value = record.acceptanceOpinion;
        }

        // 设置验收人员
        const acceptancePersonInput = document.getElementById(
          "acceptance-record-person"
        );
        if (acceptancePersonInput && record.acceptancePerson) {
          acceptancePersonInput.value = record.acceptancePerson;
        }

        // 设置验收时间
        const acceptanceTimeInput = document.getElementById(
          "acceptance-record-time"
        );
        if (acceptanceTimeInput && record.acceptanceTime) {
          acceptanceTimeInput.value = record.acceptanceTime;
        }

        // 动态添加养护相关字段
        addAcceptanceRecordMaintenanceFields(record);

        // 设置养护计划名称
        const planNameInput = document.getElementById(
          "acceptance-record-plan-name"
        );
        if (planNameInput) planNameInput.value = record.title; // 养护计划名称

        // 设置基本信息
        const basicTitle = document.getElementById("basic-title");
        if (basicTitle) basicTitle.textContent = record.title; // 养护计划名称

        const basicMaintenanceType = document.getElementById(
          "basic-maintenance-type"
        );
        if (basicMaintenanceType)
          basicMaintenanceType.textContent = record.maintenanceType; // 养护使用类型

        const basicMaintenanceUnit = document.getElementById(
          "basic-maintenance-unit"
        );
        if (basicMaintenanceUnit) basicMaintenanceUnit.textContent = "A单位"; // 养护单位（固定值）

        const basicStructureType = document.getElementById(
          "basic-structure-type"
        );
        if (basicStructureType)
          basicStructureType.textContent = record.structureType; // 结构物类型

        const basicStructureName = document.getElementById(
          "basic-structure-name"
        );
        if (basicStructureName)
          basicStructureName.textContent = record.title.includes("桥")
            ? "海尔立交桥"
            : record.title.includes("道路")
            ? "XX道路"
            : "XX隧道"; // 结构物名称

        const basicStartDate = document.getElementById("basic-start-date");
        if (basicStartDate) basicStartDate.textContent = record.startDate; // 养护开始时间

        const basicEndDate = document.getElementById("basic-end-date");
        if (basicEndDate) basicEndDate.textContent = record.endDate; // 养护结束时间

        const basicAcceptancePerson = document.getElementById(
          "basic-acceptance-person"
        );
        if (basicAcceptancePerson)
          basicAcceptancePerson.textContent = record.acceptancePerson || "王强"; // 验收人员

        // 为所有已验收记录显示养护历史
        setTimeout(() => {
          showAcceptanceRecordMaintenanceHistory();
        }, 100);
      }

      // 动态添加已验收记录的养护相关字段
      function addAcceptanceRecordMaintenanceFields(record) {
        // --- 新增代码：清理可能残留的养护历史容器 ---
        const existingHistory = document.getElementById(
          "acceptance-record-maintenance-history"
        );
        if (existingHistory) {
          existingHistory.remove();
        }
        // ---------------------------------------

        // 查找验收意见字段
        const opinionTextarea = document.querySelector(
          '#acceptance-record-info-tab textarea:not([name="acceptanceRecordResult"])'
        );
        if (!opinionTextarea) return;

        // 检查是否已经添加过养护字段容器
        let fieldsContainer = document.getElementById(
          "acceptance-record-maintenance-fields"
        );
        if (fieldsContainer) {
          fieldsContainer.remove();
        }

        // 创建养护字段容器
        fieldsContainer = document.createElement("div");
        fieldsContainer.id = "acceptance-record-maintenance-fields";
        fieldsContainer.className = "space-y-4";

        // 生成HTML内容
        fieldsContainer.innerHTML = `
                <!-- 养护内容 -->
                <div>
                    <label class="block text-sm mb-2">
                        养护内容
                    </label>
                    <textarea rows="4" disabled
                        class="w-full px-3 py-2 rounded-md bg-gray-50 text-gray-600 resize-none border-0">${
                          record.maintenanceContent ||
                          `对${record.structureType}进行${record.maintenanceType}，养护工作已完成。包括设施维修、设备更换、清洁维护等内容。`
                        }</textarea>
                    <div class="text-xs text-gray-500 text-right mt-1">
                        ${
                          record.maintenanceContent
                            ? record.maintenanceContent.length
                            : 50
                        }/100
                    </div>
                </div>

                <!-- 资金使用情况 -->
                <div>
                    <label class="block text-sm mb-2">
                        资金使用情况
                    </label>
                    <textarea rows="4" disabled
                        class="w-full px-3 py-2 rounded-md bg-gray-50 text-gray-600 resize-none border-0">${
                          record.fundUsage ||
                          `本次${record.maintenanceType}共使用资金80万元，主要用于材料采购40万元、人工费用25万元、设备租赁15万元。`
                        }</textarea>
                    <div class="text-xs text-gray-500 text-right mt-1">
                        ${record.fundUsage ? record.fundUsage.length : 45}/100
                    </div>
                </div>

                <!-- 养护完工照片 -->
                <div>
                    <label class="block text-sm mb-2">
                        养护完工照片
                    </label>
                    <div class="grid grid-cols-3 gap-2">
                        <div class="w-full h-20 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                            <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                <rect width="200" height="200" fill="#e5e7eb"/>
                                <rect x="30" y="40" width="140" height="60" fill="#9ca3af" rx="4"/>
                                <rect x="40" y="55" width="120" height="30" fill="#6b7280" rx="2"/>
                                <circle cx="70" cy="70" r="8" fill="#10b981"/>
                                <circle cx="130" cy="70" r="8" fill="#10b981"/>
                                <text x="85" y="75" font-size="14" fill="#6b7280" font-family="Arial">养护完成</text>
                            </svg>
                        </div>
                        <div class="w-full h-20 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                            <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                <rect width="200" height="200" fill="#e5e7eb"/>
                                <polygon points="100,30 150,50 150,120 100,140 50,120 50,50" fill="#9ca3af"/>
                                <rect x="85" y="70" width="30" height="25" fill="#6b7280"/>
                                <circle cx="100" cy="60" r="6" fill="#10b981"/>
                                <text x="90" y="130" font-size="10" fill="#6b7280" font-family="Arial">验收合格</text>
                            </svg>
                        </div>
                        <div class="w-full h-20 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                            <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                <rect width="200" height="200" fill="#e5e7eb"/>
                                <rect x="35" y="60" width="130" height="50" fill="#9ca3af" rx="3"/>
                                <rect x="45" y="75" width="110" height="20" fill="#6b7280" rx="2"/>
                                <circle cx="60" cy="85" r="5" fill="#10b981"/>
                                <circle cx="140" cy="85" r="5" fill="#10b981"/>
                                <text x="85" y="90" font-size="12" fill="#6b7280" font-family="Arial">质量达标</text>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- 养护人 -->
                <div>
                    <label class="block text-sm mb-2">
                        养护人
                    </label>
                    <input type="text" value="${
                      record.maintenancePerson || "李四"
                    }" disabled
                        class="w-full px-3 py-2 rounded-md bg-gray-50 text-gray-600 border-0" />
                </div>

                <!-- 养护上报时间 -->
                <div>
                    <label class="block text-sm mb-2">
                        养护上报时间
                    </label>
                    <input type="text" value="${
                      record.maintenanceTime || "2025-11-18 16:45"
                    }" disabled
                        class="w-full px-3 py-2 rounded-md bg-gray-50 text-gray-600 border-0" />
                </div>


            `;

        // 将容器插入到验收意见字段后面
        const opinionDiv = opinionTextarea.closest(".space-y-4 > div");
        if (opinionDiv && opinionDiv.nextSibling) {
          opinionDiv.parentElement.insertBefore(
            fieldsContainer,
            opinionDiv.nextSibling
          );
        } else if (opinionDiv) {
          opinionDiv.parentElement.appendChild(fieldsContainer);
        }
      }

      // 切换验收记录详情Tab
      function handleAcceptanceRecordTabClick(tab) {
        // 隐藏所有Tab内容
        document
          .getElementById("acceptance-record-info-tab")
          .classList.add("hidden");
        document
          .getElementById("acceptance-record-basic-tab")
          .classList.add("hidden");

        // 更新Tab按钮状态
        document
          .querySelectorAll("#acceptance-record-detail-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });

        // 显示选中的Tab并设置按钮状态
        if (tab === "acceptance") {
          document
            .getElementById("acceptance-record-info-tab")
            .classList.remove("hidden");
          document
            .querySelector(
              "#acceptance-record-detail-page .tab-button:first-child"
            )
            .classList.add("active");
        } else {
          document
            .getElementById("acceptance-record-basic-tab")
            .classList.remove("hidden");
          document
            .querySelector(
              "#acceptance-record-detail-page .tab-button:last-child"
            )
            .classList.add("active");
        }
      }

      // 填充巡检上报基本信息 (移除任务名称填充逻辑)
      function fillReportBasicInfo(task) {
        // 检查是否有保存的数据
        const taskKey = `${task.id}-${task.title}`;
        const savedData = appState.savedReports[taskKey];

        if (savedData) {
          // 加载保存的数据
          appState.reportFormState = savedData;
          console.log("加载保存的数据:", savedData);
        } else {
          // 没有保存数据，初始化新的表单状态
          initializeReportFormState(task);
          console.log("初始化新的表单状态");
        }

        const structureName = task.title.replace(
          /日常定期巡检(.+)\s+\d{4}-\d{2}-\d{2}/,
          "$1"
        );
        const planDate = new Date(task.planDate);
        const prevDate = new Date(planDate);
        prevDate.setDate(prevDate.getDate() - 1);

        // 移除了 report-task-title 的填充代码
        // document.getElementById('report-task-title').textContent = task.title;

        document.getElementById("report-structure-name").textContent =
          structureName;
        document.getElementById(
          "report-plan-start"
        ).textContent = `${formatDate(prevDate)} 9:00`;
        document.getElementById("report-plan-end").textContent = `${formatDate(
          planDate
        )} 9:00`;

        const cycleDates = task.cycle.split(" ~ ");
        document.getElementById("report-cycle-start").textContent =
          cycleDates[0];
        document.getElementById("report-cycle-end").textContent = cycleDates[1];
      }

      // 初始化表单状态
      function initializeReportFormState(task) {
        // 重置填报状态
        appState.reportFormState = {
          activeTab: "inspection",
          // --- 修改开始：不再使用单一的 inspectionResult，改为巡检点结构 ---
          // inspectionResult: "", // 旧逻辑移除
          // diseases: [], // 旧逻辑移除
          nextDiseaseId: 1,
          // 青岛路专用
          categoryStates: {
            桥面铺装: { expanded: false, result: "", diseases: [] },
            伸缩缝: { expanded: false, result: "", diseases: [] },
            隔音屏: { expanded: false, result: "", diseases: [] },
            防撞体: { expanded: false, result: "", diseases: [] },
            检查井: { expanded: false, result: "", diseases: [] },
          },
          // --- 新增：普通任务专用（4个巡检点，默认完好） ---
          normalPoints: {
            辽阳快速路: {
              expanded: false,
              result: "完好",
              diseases: [],
              location: "青岛市市南区辽阳快速路",
            },
            辽阳快速路桥面系: {
              expanded: false,
              result: "完好",
              diseases: [],
              location: "青岛市市南区辽阳快速路桥面系",
            },
            巡检点3: {
              expanded: false,
              result: "完好",
              diseases: [],
              location: "青岛市市南区香港中路",
            },
            巡检点4: {
              expanded: false,
              result: "完好",
              diseases: [],
              location: "青岛市市北区海尔路",
            },
          },
          weather: "晴天",
          // --- 修改结束 ---
        };
        console.log("已初始化表单状态");
      }

      // 填充养护上报基本信息
      function fillMaintenanceBasicInfo(task) {
        // 检查是否有保存的数据
        const taskKey = `maintenance-${task.id}-${task.title}`;
        const savedData = localStorage.getItem(taskKey);

        if (savedData) {
          // 加载保存的养护内容
          const maintenanceData = JSON.parse(savedData);
          document.getElementById("maintenance-content").value =
            maintenanceData.content || "";
          document.getElementById("fund-usage").value =
            maintenanceData.fundUsage || "";
          updateCharacterCount("maintenance-content");
          updateCharacterCount("fund-usage");
          console.log("加载保存的养护数据:", maintenanceData);
        } else {
          // 没有保存数据，初始化为空
          generateDefaultMaintenanceContent(task);
          console.log("初始化养护内容为空");
        }

        document.getElementById("maintenance-info-title").textContent =
          task.title;
        document.getElementById("maintenance-basic-type").textContent =
          task.maintenanceType;
        document.getElementById("maintenance-basic-structure").textContent =
          task.structureType;
        document.getElementById("maintenance-basic-start").textContent =
          task.startDate;
        document.getElementById("maintenance-basic-end").textContent =
          task.endDate;
      }

      // 生成默认养护内容
      function generateDefaultMaintenanceContent(task) {
        // 养护内容默认为空
        document.getElementById("maintenance-content").value = "";
        document.getElementById("fund-usage").value = "";
        updateCharacterCount("maintenance-content");
        updateCharacterCount("fund-usage");
      }

      // 显示养护历史内容
      function showMaintenanceHistoryContent(task) {
        const historySection = document.getElementById("history-section");

        if (task.title === "测试1") {
          const historyContent = `
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <!-- 第二次养护 -->
                        <div class="p-3 bg-green-50 border-b border-green-200">
                            <div class="flex items-center justify-between">
                                <div class="text-sm font-medium text-green-700">第二次养护</div>
                                <button onclick="toggleHistoryView()" class="flex items-center text-gray-600 hover:text-gray-800 transition-colors">
                                    <span class="text-xs mr-1">展开</span>
                                    <svg id="toggle-icon" class="w-4 h-4 transform transition-transform" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <!-- 收起状态的内容（默认显示） -->
                        <div id="history-collapsed-view" class="p-4 space-y-3">
                            <div>
                                <div class="text-sm text-gray-600 mb-1">验收状态</div>
                                <div class="font-medium text-red-600">验收未通过</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-1">验收意见</div>
                                <div class="text-sm text-gray-800">第二次养护仍存在问题，桥面铺装裂缝修复不彻底，伸缩缝清洁度不达标，需要进一步整改。</div>
                            </div>
                        </div>
                        
                        <!-- 展开状态的内容（默认隐藏） -->
                        <div id="history-expanded-view" class="hidden border-t border-gray-200">
                            <div class="p-4 space-y-4">
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">验收状态</div>
                                    <div class="font-medium text-red-600">验收未通过</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">验收意见</div>
                                    <div class="text-sm text-gray-800">第二次养护仍存在问题，桥面铺装裂缝修复不彻底，伸缩缝清洁度不达标，需要进一步整改。</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">验收人员</div>
                                    <div class="text-sm text-gray-800">陈强</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">验收时间</div>
                                    <div class="text-sm text-gray-800">2025-11-12 15:30</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">养护内容</div>
                                    <div class="text-sm text-gray-800">对第一次养护中发现的问题进行重点修复，包括桥面裂缝深度修补、伸缩缝彻底清理、隔音屏加固处理等。</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">资金使用情况</div>
                                    <div class="text-sm text-gray-800">第二次养护共使用资金30万元，主要用于裂缝修补材料15万元、专业清洁设备10万元、人工费用5万元。</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-2">养护完工照片</div>
                                    <div class="photo-grid">
                                        <div class="photo-item">
                                            <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                                <rect width="200" height="200" fill="#fef3c7"/>
                                                <rect x="25" y="50" width="100" height="40" fill="#f59e0b" rx="3"/>
                                                <rect x="35" y="60" width="80" height="20" fill="#d97706" rx="2"/>
                                                <circle cx="55" cy="70" r="4" fill="#dc2626"/>
                                                <circle cx="95" cy="70" r="4" fill="#dc2626"/>
                                                <text x="60" y="75" font-size="10" fill="#92400e" font-family="Arial">第二次养护</text>
                                            </svg>
                                        </div>
                                        <div class="photo-item">
                                            <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                                <rect width="200" height="200" fill="#fef3c7"/>
                                                <polygon points="100,40 140,55 140,105 100,120 60,105 60,55" fill="#f59e0b"/>
                                                <rect x="85" y="70" width="30" height="20" fill="#d97706"/>
                                                <circle cx="100" cy="60" r="5" fill="#dc2626"/>
                                                <text x="85" y="110" font-size="8" fill="#92400e" font-family="Arial">需重修</text>
                                            </svg>
                                        </div>
                                        <div class="photo-item">
                                            <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                                <rect width="200" height="200" fill="#fef3c7"/>
                                                <rect x="30" y="45" width="140" height="50" fill="#f59e0b" rx="3"/>
                                                <rect x="40" y="55" width="120" height="30" fill="#d97706" rx="2"/>
                                                <circle cx="70" cy="70" r="4" fill="#dc2626"/>
                                                <circle cx="130" cy="70" r="4" fill="#dc2626"/>
                                                <text x="75" y="75" font-size="10" fill="#92400e" font-family="Arial">质量问题</text>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">养护人</div>
                                    <div class="text-sm text-gray-800">张无忌</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">养护上报时间</div>
                                    <div class="text-sm text-gray-800">2025-11-15 14:20</div>
                                </div>
                            </div>
                        </div>

                        <!-- 第一次养护 -->
                        <div id="first-maintenance-container" class="hidden border-t border-gray-200">
                            <div class="p-3 bg-blue-50 border-b border-blue-200">
                                <div class="text-sm font-medium text-blue-700">第一次养护</div>
                            </div>
                            <!-- 展开状态的内容 -->
                            <div class="border-t border-gray-200">
                                <div class="p-4 space-y-4">
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收状态</div>
                                        <div class="font-medium text-red-600">验收未通过</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收意见</div>
                                        <div class="text-sm text-gray-800">养护工程存在质量问题，桥面铺装出现裂缝，伸缩缝清理不彻底，需要重新整改。请施工单位按照要求进行修复后重新申请验收。</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收人员</div>
                                        <div class="text-sm text-gray-800">陈强</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收时间</div>
                                        <div class="text-sm text-gray-800">2025-11-05 16:30</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">养护内容</div>
                                        <div class="text-sm text-gray-800">对主体结构进行全面检查和维护，包括桥面铺装修补、伸缩缝清理、隔音屏检查等工作。养护过程中严格按照施工规范执行，确保工程质量。</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">资金使用情况</div>
                                        <div class="text-sm text-gray-800">本次养护共使用资金50万元，主要用于材料采购30万元、人工费用15万元、设备租赁5万元。</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-2">养护完工照片</div>
                                        <div class="photo-grid">
                                            <div class="photo-item">
                                                <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                                    <rect width="200" height="200" fill="#e5e7eb"/>
                                                    <rect x="20" y="30" width="80" height="40" fill="#9ca3af" rx="2"/>
                                                    <rect x="25" y="35" width="70" height="30" fill="#6b7280" rx="1"/>
                                                    <circle cx="40" cy="50" r="4" fill="#10b981"/>
                                                    <circle cx="80" cy="50" r="4" fill="#10b981"/>
                                                    <text x="35" y="55" font-size="10" fill="#6b7280" font-family="Arial">养护</text>
                                                </svg>
                                            </div>
                                            <div class="photo-item">
                                                <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                                    <rect width="200" height="200" fill="#e5e7eb"/>
                                                    <polygon points="100,25 140,40 140,110 100,125 60,110 60,40" fill="#9ca3af"/>
                                                    <rect x="85" y="60" width="30" height="25" fill="#6b7280"/>
                                                    <circle cx="100" cy="50" r="5" fill="#10b981"/>
                                                    <text x="90" y="115" font-size="8" fill="#6b7280" font-family="Arial">完成</text>
                                                </svg>
                                            </div>
                                            <div class="photo-item">
                                                <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                                    <rect width="200" height="200" fill="#e5e7eb"/>
                                                    <rect x="30" y="50" width="140" height="40" fill="#9ca3af" rx="2"/>
                                                    <rect x="40" y="60" width="120" height="20" fill="#6b7280" rx="1"/>
                                                    <circle cx="70" cy="70" r="4" fill="#10b981"/>
                                                    <circle cx="130" cy="70" r="4" fill="#10b981"/>
                                                    <text x="85" y="75" font-size="10" fill="#6b7280" font-family="Arial">工程</text>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">养护人</div>
                                        <div class="text-sm text-gray-800">张无忌</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">养护上报时间</div>
                                        <div class="text-sm text-gray-800">2025-11-10 12:30</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                `;
          historySection.innerHTML = historyContent;
          historySection.classList.remove("hidden");
        } else if (task.title === "测试3") {
          const historyContent = `
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <!-- 第二次养护 -->
                        <div class="p-3 bg-green-50 border-b border-green-200">
                            <div class="flex items-center justify-between">
                                <div class="text-sm font-medium text-green-700">第二次养护</div>
                                <button onclick="toggleHistoryView()" class="flex items-center text-gray-600 hover:text-gray-800 transition-colors">
                                    <span class="text-xs mr-1">展开</span>
                                    <svg id="toggle-icon" class="w-4 h-4 transform transition-transform" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <!-- 收起状态的内容（默认显示） -->
                        <div id="history-collapsed-view" class="p-4 space-y-3">
                            <div>
                                <div class="text-sm text-gray-600 mb-1">验收状态</div>
                                <div class="font-medium text-red-600">验收未通过</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-1">验收意见</div>
                                <div class="text-sm text-gray-800">第二次改扩建工程仍有问题，道路接缝处理工艺不当，排水系统施工质量不达标，需要重新施工。</div>
                            </div>
                        </div>
                        
                        <!-- 展开状态的内容（默认隐藏） -->
                        <div id="history-expanded-view" class="hidden border-t border-gray-200">
                            <div class="p-4 space-y-4">
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">验收状态</div>
                                    <div class="font-medium text-red-600">验收未通过</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">验收意见</div>
                                    <div class="text-sm text-gray-800">第二次改扩建工程仍有问题，道路接缝处理工艺不当，排水系统施工质量不达标，需要重新施工。</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">验收人员</div>
                                    <div class="text-sm text-gray-800">王强</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">验收时间</div>
                                    <div class="text-sm text-gray-800">2025-11-17 10:45</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">养护内容</div>
                                    <div class="text-sm text-gray-800">对第一次改扩建中发现的问题进行重点整改，包括道路接缝重新处理、排水系统重新设计施工、交通标识重新施划等。</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">资金使用情况</div>
                                    <div class="text-sm text-gray-800">第二次整改共使用资金80万元，主要用于道路接缝处理35万元、排水系统改造30万元、人工费用15万元。</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-2">养护完工照片</div>
                                    <div class="photo-grid">
                                        <div class="photo-item">
                                            <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                                <rect width="200" height="200" fill="#fef3c7"/>
                                                <rect x="25" y="50" width="100" height="40" fill="#f59e0b" rx="3"/>
                                                <rect x="35" y="60" width="80" height="20" fill="#d97706" rx="2"/>
                                                <circle cx="55" cy="70" r="4" fill="#dc2626"/>
                                                <circle cx="95" cy="70" r="4" fill="#dc2626"/>
                                                <text x="60" y="75" font-size="10" fill="#92400e" font-family="Arial">第二次</text>
                                            </svg>
                                        </div>
                                        <div class="photo-item">
                                            <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                                <rect width="200" height="200" fill="#fef3c7"/>
                                                <polygon points="100,40 140,55 140,105 100,120 60,105 60,55" fill="#f59e0b"/>
                                                <rect x="85" y="70" width="30" height="20" fill="#d97706"/>
                                                <circle cx="100" cy="60" r="5" fill="#dc2626"/>
                                                <text x="90" y="110" font-size="8" fill="#92400e" font-family="Arial">不合格</text>
                                            </svg>
                                        </div>
                                        <div class="photo-item">
                                            <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                                <rect width="200" height="200" fill="#fef3c7"/>
                                                <rect x="30" y="45" width="140" height="50" fill="#f59e0b" rx="3"/>
                                                <rect x="40" y="55" width="120" height="30" fill="#d97706" rx="2"/>
                                                <circle cx="70" cy="70" r="4" fill="#dc2626"/>
                                                <circle cx="130" cy="70" r="4" fill="#dc2626"/>
                                                <text x="75" y="75" font-size="10" fill="#92400e" font-family="Arial">需重修</text>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">养护人</div>
                                    <div class="text-sm text-gray-800">张无忌</div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600 mb-1">养护上报时间</div>
                                    <div class="text-sm text-gray-800">2025-11-16 09:15</div>
                                </div>
                            </div>
                        </div>

                        <!-- 第一次养护 -->
                        <div id="first-maintenance-container" class="hidden border-t border-gray-200">
                            <div class="p-3 bg-blue-50 border-b border-blue-200">
                                <div class="text-sm font-medium text-blue-700">第一次养护</div>
                            </div>
                            <!-- 展开状态的内容 -->
                            <div class="border-t border-gray-200">
                                <div class="p-4 space-y-4">
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收状态</div>
                                        <div class="font-medium text-red-600">验收未通过</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收意见</div>
                                        <div class="text-sm text-gray-800">改扩建工程存在质量问题，新增车道与原有道路接缝处理不当，排水系统设计不合理，需要重新设计施工。</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收人员</div>
                                        <div class="text-sm text-gray-800">王强</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收时间</div>
                                        <div class="text-sm text-gray-800">2025-11-10 11:20</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">养护内容</div>
                                        <div class="text-sm text-gray-800">对道路进行改扩建施工，包括新增车道建设、桥梁加固改造、交通设施更新等工程内容。</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">资金使用情况</div>
                                        <div class="text-sm text-gray-800">本次改扩建工程共使用资金120万元，主要用于新增车道建设80万元、桥梁加固改造25万元、交通设施更新15万元。</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-2">养护完工照片</div>
                                        <div class="photo-grid">
                                            <div class="photo-item">
                                                <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                                    <rect width="200" height="200" fill="#e5e7eb"/>
                                                    <rect x="25" y="40" width="80" height="50" fill="#9ca3af" rx="3"/>
                                                    <rect x="35" y="50" width="60" height="30" fill="#6b7280" rx="2"/>
                                                    <circle cx="55" cy="65" r="5" fill="#10b981"/>
                                                    <circle cx="75" cy="65" r="5" fill="#10b981"/>
                                                    <text x="45" y="70" font-size="8" fill="#6b7280" font-family="Arial">改扩</text>
                                                </svg>
                                            </div>
                                            <div class="photo-item">
                                                <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                                    <rect width="200" height="200" fill="#e5e7eb"/>
                                                    <polygon points="100,30 150,45 150,110 100,125 50,110 50,45" fill="#9ca3af"/>
                                                    <rect x="85" y="65" width="30" height="25" fill="#6b7280"/>
                                                    <circle cx="100" cy="55" r="5" fill="#10b981"/>
                                                    <text x="90" y="115" font-size="8" fill="#6b7280" font-family="Arial">工程</text>
                                                </svg>
                                            </div>
                                            <div class="photo-item">
                                                <svg width="100%" height="100%" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                                    <rect width="200" height="200" fill="#e5e7eb"/>
                                                    <rect x="35" y="55" width="130" height="45" fill="#9ca3af" rx="3"/>
                                                    <rect x="45" y="65" width="110" height="25" fill="#6b7280" rx="2"/>
                                                    <circle cx="70" cy="75" r="4" fill="#10b981"/>
                                                    <circle cx="130" cy="75" r="4" fill="#10b981"/>
                                                    <text x="85" y="80" font-size="10" fill="#6b7280" font-family="Arial">完成</text>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">养护人</div>
                                        <div class="text-sm text-gray-800">张无忌</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">养护上报时间</div>
                                        <div class="text-sm text-gray-800">2025-11-10 12:30</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                `;
          historySection.innerHTML = historyContent;
          historySection.classList.remove("hidden");
        } else {
          historySection.classList.add("hidden");
        }
      }

      // 切换测试1和测试3的历史内容展开/收起状态
      function toggleHistoryView() {
        const collapsedView = document.getElementById("history-collapsed-view");
        const expandedView = document.getElementById("history-expanded-view");
        const firstMaintenanceContainer = document.getElementById(
          "first-maintenance-container"
        );
        const toggleText = document
          .querySelector("#toggle-icon")
          .parentElement.querySelector("span");
        const toggleIcon = document.getElementById("toggle-icon");

        if (expandedView.classList.contains("hidden")) {
          // 展开内容
          collapsedView.classList.add("hidden");
          expandedView.classList.remove("hidden");
          if (firstMaintenanceContainer) {
            firstMaintenanceContainer.classList.remove("hidden");
          }
          toggleText.textContent = "收起";
          toggleIcon.style.transform = "rotate(180deg)";
        } else {
          // 收起内容
          collapsedView.classList.remove("hidden");
          expandedView.classList.add("hidden");
          if (firstMaintenanceContainer) {
            firstMaintenanceContainer.classList.add("hidden");
          }
          toggleText.textContent = "展开";
          toggleIcon.style.transform = "rotate(0deg)";
        }
      }

      // 切换历史内容展开/收起状态
      function toggleHistoryContent() {
        const collapsedView = document.getElementById("history-collapsed-view");
        const expandedView = document.getElementById("history-expanded-view");
        const firstMaintenanceExpandedView = document.getElementById(
          "first-maintenance-expanded-view"
        );
        const toggleText = document.getElementById("toggle-text");
        const toggleIcon = document.getElementById("toggle-icon");

        if (expandedView.classList.contains("hidden")) {
          // 展开内容
          collapsedView.classList.add("hidden");
          expandedView.classList.remove("hidden");
          firstMaintenanceExpandedView.classList.remove("hidden");
          toggleText.textContent = "收起";
          toggleIcon.style.transform = "rotate(180deg)";
        } else {
          // 收起内容
          collapsedView.classList.remove("hidden");
          expandedView.classList.add("hidden");
          firstMaintenanceExpandedView.classList.add("hidden");
          toggleText.textContent = "展开";
          toggleIcon.style.transform = "rotate(0deg)";
        }
      }

      // 切换特殊桥梁记录的展开/收起状态
      function toggleSpecialBridgeRecord(sectionId) {
        const collapsedView = document.getElementById(
          "maintenance-history-collapsed"
        );
        const expandedView = document.getElementById(
          "maintenance-history-expanded"
        );
        const icon = document.getElementById("maintenance-history-icon");

        if (expandedView.classList.contains("hidden")) {
          // 展开内容 - 显示完整的三次养护信息
          collapsedView.classList.add("hidden");
          expandedView.classList.remove("hidden");
          icon.style.transform = "rotate(180deg)";
        } else {
          // 收起内容 - 只显示第三次养护的基本信息
          collapsedView.classList.remove("hidden");
          expandedView.classList.add("hidden");
          icon.style.transform = "rotate(0deg)";
        }
      }

      // 重置养护表单
      function resetMaintenanceForm() {
        document.getElementById("fund-usage").value = "";
        appState.maintenancePhotos = [];
        updateCharacterCount("fund-usage");
        updateMaintenancePhotoPreview();
      }

      // 保存病害

      // 完成巡检上报

      // 处理养护照片上传
      function handleMaintenancePhotoUpload(event) {
        const files = event.target.files;
        if (!files || files.length === 0) return;

        // 限制最多3张照片
        const remainingSlots = 3 - appState.maintenancePhotos.length;
        const filesToProcess = Array.from(files).slice(0, remainingSlots);

        filesToProcess.forEach((file) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            if (e.target?.result) {
              appState.maintenancePhotos.push({
                name: file.name,
                url: e.target.result,
              });
              updateMaintenancePhotoPreview();
            }
          };
          reader.readAsDataURL(file);
        });
      }

      // 更新养护照片预览
      function updateMaintenancePhotoPreview() {
        const container = document.getElementById("maintenance-photo-preview");

        if (appState.maintenancePhotos.length === 0) {
          container.classList.add("hidden");
          return;
        }

        container.classList.remove("hidden");
        container.innerHTML = appState.maintenancePhotos
          .map(
            (photo, index) => `
                <div class="photo-item relative">
                    <img src="${photo.url}" alt="${photo.name}"/>
                    <button class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1"
                            onclick="removeMaintenancePhoto(${index})">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                    <div class="text-xs text-gray-600 mt-1 truncate">${photo.name}</div>
                </div>
            `
          )
          .join("");
      }

      // 删除养护照片
      function removeMaintenancePhoto(index) {
        appState.maintenancePhotos.splice(index, 1);
        updateMaintenancePhotoPreview();
      }

      // 提交养护上报
      function submitMaintenanceReport() {
        const maintenanceContent = document
          .getElementById("maintenance-content")
          .value.trim();
        const fundUsage = document.getElementById("fund-usage").value.trim();

        if (!maintenanceContent) {
          alert("养护内容为必填项");
          return;
        }
        if (!fundUsage) {
          alert("资金使用情况为必填项");
          return;
        }

        // 添加确认对话框
        if (confirm("您确定要提交数据？")) {
          alert("养护上报成功！");
          // 清除保存的数据
          const taskKey = `maintenance-${appState.selectedTask.id}-${appState.selectedTask.title}`;
          localStorage.removeItem(taskKey);
          goBack();
        }
      }

      // 保存养护内容到localStorage
      function saveMaintenanceContent() {
        const task = appState.selectedTask;
        const taskKey = `maintenance-${task.id}-${task.title}`;
        const maintenanceData = {
          content: document.getElementById("maintenance-content").value,
          fundUsage: document.getElementById("fund-usage").value,
          timestamp: new Date().toISOString(),
        };
        localStorage.setItem(taskKey, JSON.stringify(maintenanceData));
        console.log("保存养护内容到localStorage:", maintenanceData);
      }

      // 更新字符计数
      function updateCharacterCount(textareaId) {
        const textarea = document.getElementById(textareaId);
        const countSpan = document.getElementById(textareaId + "-count");
        if (textarea && countSpan) {
          countSpan.textContent = textarea.value.length;
        }
      }

      // 返回上一页
      function goBack() {
        // 新增：处理历史页面返回逻辑
        if (appState.currentPage === "history") {
          // 1. 隐藏历史页面
          document.getElementById("history-page").classList.add("hidden");

          // 2. 恢复上报页面显示 (假设上一页一定是上报页 report)
          // 注意：这里我们不重新渲染，仅仅是显示，这样页面上的input值会被浏览器保留（在SPA中DOM节点只是被hidden了）
          const reportPage = document.getElementById("inspection-report-page");
          reportPage.classList.remove("hidden");

          // 3. 恢复页面标题和导航状态
          document.getElementById("page-title").textContent = "巡检上报";
          document.getElementById("back-btn").classList.remove("hidden");
          document.getElementById("bottom-nav").classList.add("hidden");

          // 4. 恢复状态变量
          appState.currentPage = "report";
          // 设置previousPage为'inspection'，确保下次返回时正确回到"我的巡检"页面
          appState.previousPage = "inspection";
          return;
        }

        // 隐藏所有详情页面
        document
          .querySelectorAll("#inspection-detail-page, #maintenance-detail-page")
          .forEach((page) => {
            page.classList.add("hidden");
          });

        if (appState.currentPage === "acceptance-detail") {
          // 从验收详情页面返回到养护验收页面
          document.querySelectorAll(".page").forEach((page) => {
            page.classList.add("hidden");
          });

          document.getElementById("acceptance-page").classList.remove("hidden");
          document.getElementById("page-title").textContent = "养护验收";
          document.getElementById("back-btn").classList.remove("hidden");
          document.getElementById("bottom-nav").classList.add("hidden");

          appState.currentPage = "acceptance";
          appState.previousPage = "main";
          return;
        }

        if (appState.currentPage === "acceptance-record-detail") {
          // 从验收记录详情页面返回到养护验收页面
          document.querySelectorAll(".page").forEach((page) => {
            page.classList.add("hidden");
          });

          document.getElementById("acceptance-page").classList.remove("hidden");
          document.getElementById("page-title").textContent = "养护验收";
          document.getElementById("back-btn").classList.remove("hidden");
          document.getElementById("bottom-nav").classList.add("hidden");

          appState.currentPage = "acceptance";
          appState.previousPage = "main";
          return;
        } else if (appState.currentPage === "acceptance") {
          // 从养护验收页面返回到首页
          document.querySelectorAll(".page").forEach((page) => {
            page.classList.add("hidden");
          });

          document.getElementById("home-page").classList.remove("hidden");
          document.getElementById("page-title").textContent = "首页";
          document.getElementById("back-btn").classList.add("hidden");
          document.getElementById("bottom-nav").classList.remove("hidden");

          appState.currentPage = "main";
          appState.currentMainTab = "home";
          return;
        } else if (
          appState.currentPage === "inspection-detail" ||
          appState.currentPage === "maintenance-detail"
        ) {
          // 从详情页面返回到对应的列表页面，并设置previousPage为'main'以便再次返回
          if (appState.previousPage === "inspection") {
            appState.previousPage = "main"; // 设置下一次返回时回到主页
            // 切换到巡检记录tab
            appState.currentInspectionTab = "records";
            navigateToInspectionRecords();
          } else if (
            appState.previousPage === "maintenance" ||
            appState.previousPage === "maintenance-records"
          ) {
            appState.previousPage = "main"; // 设置下一次返回时回到主页
            // 切换到养护记录tab
            appState.currentMaintenanceTab = "records";
            navigateToMaintenanceRecords();
          }
        } else {
          // 隐藏所有普通页面
          document.querySelectorAll(".page").forEach((page) => {
            page.classList.add("hidden");
          });

          if (appState.previousPage === "main") {
            // 返回到主页面
            document
              .getElementById(`${appState.currentMainTab}-page`)
              .classList.remove("hidden");
            document.getElementById("page-title").textContent = getPageTitle(
              appState.currentMainTab
            );
            document.getElementById("back-btn").classList.add("hidden");
            document.getElementById("bottom-nav").classList.remove("hidden");
            appState.currentPage = "main";
          } else if (appState.previousPage === "todo") {
            // 从养护上报页面返回到待办页面
            document.querySelectorAll(".page").forEach((page) => {
              page.classList.add("hidden");
            });

            document.getElementById("todo-page").classList.remove("hidden");
            document.getElementById("page-title").textContent = "待办";
            document.getElementById("back-btn").classList.add("hidden");
            document.getElementById("bottom-nav").classList.remove("hidden");

            appState.currentPage = "todo";
            appState.previousPage = "main";
          } else if (appState.previousPage === "maintenance-pending") {
            // 从养护上报页面返回到我的养护-待养护页面
            document.querySelectorAll(".page").forEach((page) => {
              page.classList.add("hidden");
            });

            document
              .getElementById("maintenance-page")
              .classList.remove("hidden");
            document.getElementById("page-title").textContent = "我的养护";
            document.getElementById("back-btn").classList.remove("hidden");
            document.getElementById("bottom-nav").classList.add("hidden");

            // 确保显示的是待养护tab
            appState.currentMaintenanceTab = "pending";
            switchMaintenanceTab("pending");

            appState.currentPage = "maintenance";
            appState.previousPage = "main";
          } else if (
            appState.previousPage === "allMaintenanceTasks" ||
            appState.currentPage === "allMaintenanceTasks"
          ) {
            // 从养护上报页面返回到养护任务页面
            document.querySelectorAll(".page").forEach((page) => {
              page.classList.add("hidden");
            });

            document
              .getElementById("all-maintenance-tasks-page")
              .classList.remove("hidden");
            document.getElementById("page-title").textContent = "养护任务";
            document.getElementById("back-btn").classList.remove("hidden");
            document.getElementById("bottom-nav").classList.add("hidden");

            appState.currentPage = "allMaintenanceTasks";
            appState.previousPage = "main";
          } else {
            // 返回到对应的列表页面，并设置previousPage为'main'以便再次返回
            if (appState.previousPage === "inspection") {
              appState.previousPage = "main"; // 设置下一次返回时回到主页
              navigateToInspection();
            } else {
              const tempPreviousPage = appState.previousPage; // 保存原始值
              appState.previousPage = "main"; // 设置下一次返回时回到主页

              // 根据原始的previousPage决定返回到哪个页面
              if (tempPreviousPage === "maintenance-records") {
                navigateToMaintenanceRecords();
              } else if (tempPreviousPage === "inspection") {
                // 从巡检上报页面返回时，清理临时数据
                clearTempInspectionData();
                navigateToInspection();
              } else {
                navigateToMaintenance();
              }
            }
          }
        }
      }

      // 清理临时巡检数据（未保存的数据）
      function clearTempInspectionData() {
        // 只有当前任务没有保存的数据时才清理
        if (appState.selectedTask) {
          const taskKey = `${appState.selectedTask.id}-${appState.selectedTask.title}`;
          if (!appState.savedReports[taskKey]) {
            // 清理内存中的临时数据
            appState.diseases = [];
            appState.nextDiseaseId = 1;
            console.log("已清理临时巡检数据");
          }
        }
      }

      // 获取页面标题
      function getPageTitle(tab) {
        const titles = {
          home: "首页",
          todo: "待办",
          profile: "个人中心",
        };
        return titles[tab] || "";
      }

      // 获取结构物类型标签颜色
      function getStructureTypeBadgeColor(type) {
        switch (type) {
          case "桥梁":
            return "badge-green";
          case "道路":
            return "badge-orange";
          case "隧道":
            return "badge-blue";
          default:
            return "badge-gray";
        }
      }

      // 获取状态颜色
      function getStatusColor(status) {
        switch (status) {
          case "验收通过":
            return "bg-green-500 hover:bg-green-600 text-white";
          case "待验收":
            return "bg-amber-700 hover:bg-amber-800 text-white border-2 border-black";
          case "验收未通过":
            return "bg-red-500 hover:bg-red-600 text-white";
          default:
            return "bg-gray-500 hover:bg-gray-600 text-white";
        }
      }

      // 格式化日期
      function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const day = String(date.getDate()).padStart(2, "0");
        return `${year}-${month}-${day}`;
      }

      // 从养护记录开始养护
      function startMaintenanceFromRecords(recordId) {
        const record = maintenanceRecordsData.find((r) => r.id === recordId);
        if (!record) return;

        appState.selectedMaintenanceTask = record;
        appState.previousPage = "maintenance-records"; // 记录上一页是养护记录页面
        appState.currentPage = "maintenance-report";

        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示养护上报页面
        document
          .getElementById("maintenance-report-page")
          .classList.remove("hidden");

        // 更新UI
        document.getElementById("page-title").textContent = "养护上报";
        document.getElementById("back-btn").classList.remove("hidden");
        document.getElementById("bottom-nav").classList.add("hidden");

        // 填充基本信息
        fillMaintenanceBasicInfo(record);

        // 显示历史内容
        showMaintenanceHistoryContent(record);

        // 生成默认养护内容
        generateDefaultMaintenanceContent(record);

        // 显示历史内容（如果有的话）
        if (record.status) {
          document.getElementById("history-section").classList.remove("hidden");
          // 这里可以填充历史内容
        }

        // 重置表单
        resetMaintenanceForm();

        // 重置Tab状态到默认的养护信息页面
        document
          .querySelectorAll("#maintenance-report-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        document
          .querySelector("#maintenance-report-page .tab-button:first-child")
          .classList.add("active");
        document
          .getElementById("maintenance-info-tab")
          .classList.remove("hidden");
        document
          .getElementById("maintenance-basic-tab")
          .classList.add("hidden");

        // 重置Tab状态到默认的养护信息页面
        document
          .querySelectorAll("#maintenance-report-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        document
          .querySelector("#maintenance-report-page .tab-button:first-child")
          .classList.add("active");
        document
          .getElementById("maintenance-info-tab")
          .classList.remove("hidden");
        document
          .getElementById("maintenance-basic-tab")
          .classList.add("hidden");
      }

      // 从待办页面开始养护
      function startMaintenanceFromTodo(taskId) {
        const task = pendingMaintenanceTasks.find((t) => t.id === taskId);
        if (!task) return;

        appState.selectedMaintenanceTask = task;
        appState.previousPage = "todo"; // 记录上一页是待办页面
        appState.currentPage = "maintenance-report";

        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示养护上报页面
        document
          .getElementById("maintenance-report-page")
          .classList.remove("hidden");

        // 更新UI
        document.getElementById("page-title").textContent = "养护上报";
        document.getElementById("back-btn").classList.remove("hidden");
        document.getElementById("bottom-nav").classList.add("hidden");

        // 填充基本信息
        fillMaintenanceBasicInfo(task);

        // 显示历史内容（仅针对测试数据）
        showMaintenanceHistoryContent(task);

        // 生成默认养护内容
        generateDefaultMaintenanceContent(task);

        // 重置表单
        resetMaintenanceForm();

        // 重置Tab状态到默认的养护信息页面
        document
          .querySelectorAll("#maintenance-report-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        document
          .querySelector("#maintenance-report-page .tab-button:first-child")
          .classList.add("active");
        document
          .getElementById("maintenance-info-tab")
          .classList.remove("hidden");
        document
          .getElementById("maintenance-basic-tab")
          .classList.add("hidden");
      }

      // 查看巡检详情
      function viewInspectionDetail(recordId) {
        const record = inspectionRecordsData.find((r) => r.id === recordId);
        if (!record) return;

        appState.selectedInspectionRecord = record;
        appState.previousPage = "inspection";
        appState.currentPage = "inspection-detail";

        // 隐藏主导航栏和主内容区域
        document.querySelector(".page-nav-header").style.display = "none";
        document.querySelector("#main-content").style.display = "none";
        document.getElementById("bottom-nav").classList.add("hidden");

        // 显示巡检详情页面
        document
          .getElementById("inspection-detail-page")
          .classList.remove("hidden");

        // 填充详情数据
        fillInspectionDetail(record);
      }

      // 查看养护详情
      function viewMaintenanceDetail(recordId) {
        // 检查是待养护任务还是养护记录
        let record = pendingMaintenanceTasks.find((r) => r.id === recordId);
        if (!record) {
          record = maintenanceRecordsData.find((r) => r.id === recordId);
        }
        if (!record) return;

        appState.selectedMaintenanceRecord = record;
        appState.previousPage = "maintenance";
        appState.currentPage = "maintenance-detail";

        // 隐藏主导航栏和主内容区域
        document.querySelector(".page-nav-header").style.display = "none";
        document.querySelector("#main-content").style.display = "none";
        document.getElementById("bottom-nav").classList.add("hidden");

        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示养护详情页面
        document
          .getElementById("maintenance-detail-page")
          .classList.remove("hidden");

        // 填充详情数据
        fillMaintenanceDetail(record);
      }

      // 填充巡检详情数据
      function fillInspectionDetail(record) {
        // 检查是否是青岛路任务
        const isQingdaoRoadTask = false; // 不再使用青岛路专用格式

        // 青岛路任务的检查项数据（模拟）
        const qingdaoRoadCategoryData = {
          桥面铺装: { result: "完好", diseases: [] },
          伸缩缝: {
            result: "发现病害",
            diseases: [
              {
                level: "中等",
                location: "青岛路伸缩缝",
                item: "伸缩缝",
                type: "螺帽松动",
                description: "青岛路段伸缩缝出现螺帽松动现象，需要及时维护",
                photos: [
                  "https://images.unsplash.com/photo-1601026909629-bad5e1122bc6?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxwYXZlbWVudCUyMHBvdGhvbGV8ZW58MXx8fHwxNzYzMDg4OTY5fDA&ixlib=rb-4.1.0&q=80&w=1080",
                  "https://images.unsplash.com/photo-1740486604216-5230af12485d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxyb2FkJTIwY3JhY2slMjBkYW1hZ2V8ZW58MXx8fHwxNzYzMDg4OTY4fDA&ixlib=rb-4.1.0&q=80&w=1080",
                ],
              },
            ],
          },
          隔音屏: { result: "完好", diseases: [] },
          防撞体: { result: "完好", diseases: [] },
          检查井: { result: "完好", diseases: [] },
        };

        // 从记录中提取信息
        const getStructureName = () => {
          const match = record.title.match(
            /日常定期巡检(.+)\\s+\\d{4}-\\d{2}-\\d{2}/
          );
          return match ? match[1] : "";
        };

        const getCycleDates = () => {
          const dates = record.cycle.split(" ~ ");
          return {
            start: dates[0] || "",
            end: dates[1] || "",
          };
        };

        const getPlanDates = () => {
          const planDate = new Date(record.planDate);
          const prevDate = new Date(planDate);
          prevDate.setDate(prevDate.getDate() - 1);

          const formatDate = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, "0");
            const day = String(date.getDate()).padStart(2, "0");
            return `${year}-${month}-${day}`;
          };

          return {
            start: `${formatDate(prevDate)} 9:00`,
            end: `${formatDate(planDate)} 9:00`,
          };
        };

        const structureName = getStructureName();
        const cycleDates = getCycleDates();
        const planDates = getPlanDates();

        // 生成巡检信息Tab内容
        let inspectionTabContent = "";

        if (isQingdaoRoadTask) {
          // 青岛路任务特殊UI：检查项列表

          // 判断总体巡检结果
          const hasDisease = Object.values(qingdaoRoadCategoryData).some(
            (data) => data.result === "发现病害"
          );

          // 添加总体巡检结果
          inspectionTabContent = `
                    <div class="bg-white border border-gray-200 rounded-lg p-4 mb-4">
                        <div class="flex items-center mb-3">
                            <span class="text-red-500 mr-1">*</span>
                            <span>巡检结果</span>
                        </div>
                        <div class="flex gap-6">
                            <label class="flex items-center">
                                <input type="radio" ${
                                  !hasDisease ? "checked" : ""
                                } disabled class="w-4 h-4">
                                <span class="ml-2 text-sm">完好</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" ${
                                  hasDisease ? "checked" : ""
                                } disabled class="w-4 h-4">
                                <span class="ml-2 text-sm">发现病害</span>
                            </label>
                        </div>
                    </div>
                `;

          const diseaseCategories = [
            "桥面铺装",
            "伸缩缝",
            "隔音屏",
            "防撞体",
            "检查井",
          ];

          inspectionTabContent += diseaseCategories
            .map((category) => {
              const categoryData = qingdaoRoadCategoryData[category];
              let diseasesContent = "";

              if (
                categoryData.result === "发现病害" &&
                categoryData.diseases.length > 0
              ) {
                diseasesContent = categoryData.diseases
                  .map(
                    (disease, index) => `
                            <div class="bg-gray-50 p-4 rounded-lg space-y-4">
                                <div class="text-sm text-gray-700">病害 ${
                                  index + 1
                                }</div>
                                
                                <!-- 病害等级 -->
                                <div class="flex items-center mb-3">
                                    <span class="text-red-500 mr-1">*</span>
                                    <span class="text-sm">病害等级：</span>
                                </div>
                                <div class="flex gap-6 mb-4">
                                    <label class="flex items-center">
                                        <input type="radio" ${
                                          disease.level === "轻微"
                                            ? "checked"
                                            : ""
                                        } disabled class="w-4 h-4">
                                        <span class="ml-2 text-sm">轻微</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" ${
                                          disease.level === "中等"
                                            ? "checked"
                                            : ""
                                        } disabled class="w-4 h-4">
                                        <span class="ml-2 text-sm">中等</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" ${
                                          disease.level === "严重"
                                            ? "checked"
                                            : ""
                                        } disabled class="w-4 h-4">
                                        <span class="ml-2 text-sm">严重</span>
                                    </label>
                                </div>
                                
                                <!-- 病害位置 -->
                                <div class="flex items-center mb-3">
                                    <span class="text-red-500 mr-1">*</span>
                                    <span class="text-sm">病害位置：</span>
                                </div>
                                <div class="bg-gray-100 px-4 py-2 rounded-md text-sm mb-4">
                                    ${disease.location}
                                </div>
                                
                                <!-- 检查项 -->
                                <div class="flex items-center mb-3">
                                    <span class="text-red-500 mr-1">*</span>
                                    <span class="text-sm">检查项：</span>
                                </div>
                                <div class="bg-gray-100 px-4 py-2 rounded-md text-sm mb-4">
                                    ${disease.item}
                                </div>
                                
                                <!-- 损坏类型 -->
                                <div class="flex items-center mb-3">
                                    <span class="text-red-500 mr-1">*</span>
                                    <span class="text-sm">损坏类型：</span>
                                </div>
                                <div class="bg-gray-100 px-4 py-2 rounded-md text-sm mb-4">
                                    ${disease.type}
                                </div>
                                
                                <!-- 病害描述 -->
                                <div class="flex items-center mb-3">
                                    <span class="text-red-500 mr-1">*</span>
                                    <span class="text-sm">病害描述：</span>
                                </div>
                                <div class="bg-gray-100 px-4 py-2 rounded-md text-sm min-h-[60px] mb-4">
                                    ${disease.description}
                                </div>
                                
                                <!-- 现场照片 -->
                                <div class="flex items-center mb-2">
                                    <span class="text-red-500 mr-1">*</span>
                                    <span class="text-sm">现场照片：</span>
                                </div>
                                <div class="grid grid-cols-3 gap-2">
                                    ${disease.photos
                                      .map(
                                        (photo) => `
                                        <div class="aspect-square rounded-lg overflow-hidden bg-gray-100">
                                            <img src="${photo}" alt="病害照片" class="w-full h-full object-cover">
                                        </div>
                                    `
                                      )
                                      .join("")}
                                </div>
                            </div>
                        `
                  )
                  .join("");
              }

              return `
                        <div class="bg-white border border-gray-200 rounded-lg p-4 mb-1">
                            <div class="flex items-center justify-between mb-3">
                                <span>${category}</span>
                                <span class="${
                                  categoryData.result === "发现病害"
                                    ? "text-red-500"
                                    : "text-green-500"
                                }">
                                    ${
                                      categoryData.result === "完好"
                                        ? "正常"
                                        : "异常"
                                    }
                                </span>
                            </div>
                            ${
                              diseasesContent
                                ? `<div class="mt-4 pt-4 border-t border-gray-200">${diseasesContent}</div>`
                                : ""
                            }
                        </div>
                    `;
            })
            .join("");

          // 添加巡检人和巡检时间
          inspectionTabContent += `
                    <div class="bg-white border border-gray-200 rounded-lg mb-1 p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center">
                                <span class="text-red-500 mr-1">*</span>
                                <span>巡检人：</span>
                            </div>
                            <div class="text-right">李明</div>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="text-red-500 mr-1">*</span>
                                <span>巡检时间：</span>
                            </div>
                            <div class="text-right">2025-11-10 14:30</div>
                        </div>
                    </div>
                `;
        } else {
          // 普通任务：参考巡检上报页面布局（只读版本）

          // 模拟巡检点数据
          const inspectionPointsData = {
            辽阳快速路: {
              result: "完好",
              location: "山东省青岛市辽阳快速路",
              diseases: [],
            },
            辽阳快速路桥面系: {
              result: "完好",
              location: "山东省青岛市辽阳快速路桥面系",
              diseases: [],
            },
            巡检点3: {
              result: "发现病害",
              location: "山东省青岛市海尔路立交桥巡检点3",
              diseases: [
                {
                  level: "中等",
                  location: "山东省青岛市海尔路立交桥巡检点3",
                  component: "桥面系",
                  item: "桥面铺装",
                  type: "网裂或龟裂",
                  description:
                    "海尔路立交桥巡检点3桥面铺装出现网裂现象，需要及时修复",
                  photos: [
                    "https://images.unsplash.com/photo-1740486604216-5230af12485d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxyb2FkJTIwY3JhY2slMjBkYW1hZ2V8ZW58MXx8fHwxNzYzMDg4OTY4fDA&ixlib=rb-4.1.0&q=80&w=1080",
                    "https://images.unsplash.com/photo-1603488166140-3d0a607b6af6?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxicmlkZ2UlMjBjb25jcmV0ZSUyMGRhbWFnZXxlbnwxfHx8fDE3NjMwODg5Njl8MA&ixlib=rb-4.1.0&q=80&w=1080",
                  ],
                },
              ],
            },
            巡检点4: {
              result: "完好",
              location: "山东省青岛市海尔路立交桥巡检点4",
              diseases: [],
            },
          };

          // 生成巡检信息Tab内容（参考巡检上报页面布局）
          inspectionTabContent = `
                    <div class="p-4 pb-12">
                `;

          // 添加任务名称和天气情况卡片
          inspectionTabContent += `
                    <div class="bg-white border border-gray-200 rounded-lg mb-1 p-4">
                        <div class="flex items-center justify-between mb-2">
                            <div class="text-sm font-bold text-gray-700">任务名称</div>
                        </div>
                        <div class="text-sm text-gray-900 break-all">${record.title.replace(
                          /-/g,
                          "."
                        )}</div>
                        
                        <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-200">
                            <div class="text-sm font-bold text-gray-700">天气情况</div>
                            <div class="text-sm text-gray-700">晴天</div>
                        </div>
                    </div>
                `;

          // 生成巡检点列表
          const points = Object.keys(inspectionPointsData);
          inspectionTabContent += points
            .map((point) => {
              const pointData = inspectionPointsData[point];
              const statusColor =
                pointData.result === "发现病害"
                  ? "text-red-500"
                  : "text-green-500";
              const statusText = pointData.result === "完好" ? "正常" : "异常";

              let diseaseContent = "";
              if (
                pointData.result === "发现病害" &&
                pointData.diseases.length > 0
              ) {
                diseaseContent = `
                            <div class="bg-gray-50 border border-gray-200 rounded-lg flex flex-col">
                                <div class="p-3 border-b border-gray-200 bg-white rounded-t-lg">
                                    <div class="flex items-center gap-4">
                                        <label class="block text-sm font-bold text-gray-700 mr-2">
                                            巡检结果 <span class="text-red-500">*</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="result-${point}" value="完好" disabled class="mr-1 w-4 h-4 text-blue-600"/>
                                            <span class="text-sm">正常</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="result-${point}" value="发现病害" checked disabled class="mr-1 w-4 h-4 text-red-600"/>
                                            <span class="text-sm">异常</span>
                                        </label>
                                    </div>
                                </div>

                                <div class="flex-1 overflow-y-auto p-3 space-y-2 bg-gray-100">
                                    ${pointData.diseases
                                      .map(
                                        (disease, index) => `
                                        <div class="bg-white p-4 rounded-lg space-y-2">
                                            <div class="flex items-center justify-between">
                                                <h4 class="font-bold text-gray-700">病害 ${
                                                  index + 1
                                                }</h4>
                                            </div>
                                            
                                            <div class="space-y-2">
                                                <!-- 等级 -->
                                                <div>
                                                    <div class="block text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>病害等级</div>
                                                    <div class="flex gap-4">
                                                        ${[
                                                          "轻微",
                                                          "中等",
                                                          "严重",
                                                        ]
                                                          .map(
                                                            (level) => `
                                                            <label class="flex items-center text-sm">
                                                                <input type="radio" name="level-${
                                                                  disease.id
                                                                }" value="${level}"
                                                                    ${
                                                                      disease.level ===
                                                                      level
                                                                        ? "checked"
                                                                        : ""
                                                                    } disabled class="mr-1"/>
                                                                ${level}
                                                            </label>
                                                        `
                                                          )
                                                          .join("")}
                                                    </div>
                                                </div>

                                                <!-- 位置 -->
                                                <div>
                                                    <div class="block text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>病害位置</div>
                                                    <div class="text-sm w-full bg-gray-100 border rounded px-2 py-1">${
                                                      disease.location
                                                    }</div>
                                                </div>

                                                <!-- 构件/设备类型 -->
                                                <div>
                                                    <div class="block text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>构件/设备类型</div>
                                                    <div class="text-sm w-full bg-gray-100 border rounded px-2 py-1">${
                                                      disease.component
                                                    }</div>
                                                </div>

                                                <!-- 检查项 -->
                                                <div>
                                                    <div class="block text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>检查项</div>
                                                    <div class="text-sm w-full bg-gray-100 border rounded px-2 py-1">${
                                                      disease.item
                                                    }</div>
                                                </div>

                                                <!-- 损坏类型 -->
                                                <div>
                                                    <div class="block text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>损坏类型</div>
                                                    <div class="text-sm w-full bg-gray-100 border rounded px-2 py-1">${
                                                      disease.type
                                                    }</div>
                                                </div>

                                                <!-- 病害描述 -->
                                                <div>
                                                    <div class="block text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>病害描述</div>
                                                    <div class="text-sm w-full bg-gray-100 border rounded px-2 py-1 min-h-[60px]">${
                                                      disease.description
                                                    }</div>
                                                </div>

                                                <!-- 照片 -->
                                                <div>
                                                    <div class="block text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>照片</div>
                                                    <div class="grid grid-cols-4 gap-2">
                                                        ${disease.photos
                                                          .map(
                                                            (photo, i) => `
                                                            <div class="relative aspect-square">
                                                                <img src="${photo}" class="w-full h-full object-cover rounded"/>
                                                            </div>
                                                        `
                                                          )
                                                          .join("")}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `
                                      )
                                      .join("")}
                                </div>

                                
                            </div>
                        `;
              } else {
                diseaseContent = `
                            <div class="bg-gray-50 border border-gray-200 rounded-lg flex flex-col">
                                <div class="p-3 border-b border-gray-200 bg-white rounded-t-lg">
                                    <div class="flex items-center gap-4">
                                        <label class="block text-sm font-bold text-gray-700 mr-2">
                                            巡检结果 <span class="text-red-500">*</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="result-${point}" value="完好" checked disabled class="mr-1 w-4 h-4 text-blue-600"/>
                                            <span class="text-sm">正常</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="result-${point}" value="发现病害" disabled class="mr-1 w-4 h-4 text-red-600"/>
                                            <span class="text-sm">异常</span>
                                        </label>
                                    </div>
                                </div>

                                
                            </div>
                        `;
              }

              if (
                pointData.result === "发现病害" &&
                pointData.diseases.length > 0
              ) {
                return `
                            <div class="bg-white border border-gray-200 rounded-lg mb-1">
                                <!-- 巡检点标题栏 -->
                                <div class="p-4 border-b border-gray-200">
                                    <div class="flex items-center justify-between">
                                        <span class="font-bold text-base text-gray-800">${point}</span>
                                        <span class="${statusColor} text-sm font-medium">${statusText}</span>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">
                                        <span class="font-medium">巡检位置：</span>${
                                          pointData.location
                                        }
                                    </div>
                                </div>

                                

                                <!-- 病害详情 -->
                                ${pointData.diseases
                                  .map(
                                    (disease, index) => `
                                    <div class="p-4 border-b border-gray-200 last:border-b-0">
                                        <div class="flex items-center justify-between mb-3">
                                            <h4 class="font-bold text-gray-700">病害 ${
                                              index + 1
                                            }</h4>
                                        </div>
                                        
                                        <div class="grid grid-cols-1 gap-2">
                                            <!-- 等级 -->
                                            <div>
                                                <div class="text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>病害等级</div>
                                                <div class="flex gap-4">
                                                    ${["轻微", "中等", "严重"]
                                                      .map(
                                                        (level) => `
                                                        <label class="flex items-center text-sm">
                                                            <input type="radio" name="level-${
                                                              disease.id
                                                            }" value="${level}"
                                                                ${
                                                                  disease.level ===
                                                                  level
                                                                    ? "checked"
                                                                    : ""
                                                                } disabled class="mr-1"/>
                                                            ${level}
                                                        </label>
                                                    `
                                                      )
                                                      .join("")}
                                                </div>
                                            </div>

                                            <!-- 位置 -->
                                            <div>
                                                <div class="text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>病害位置</div>
                                                <div class="text-sm bg-gray-100 border rounded px-2 py-1">${
                                                  disease.location
                                                }</div>
                                            </div>

                                            <!-- 构件/设备类型 -->
                                            <div>
                                                <div class="text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>构件/设备类型</div>
                                                <div class="text-sm bg-gray-100 border rounded px-2 py-1">${
                                                  disease.component
                                                }</div>
                                            </div>

                                            <!-- 检查项 -->
                                            <div>
                                                <div class="text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>检查项</div>
                                                <div class="text-sm bg-gray-100 border rounded px-2 py-1">${
                                                  disease.item
                                                }</div>
                                            </div>

                                            <!-- 损坏类型 -->
                                            <div>
                                                <div class="text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>损坏类型</div>
                                                <div class="text-sm bg-gray-100 border rounded px-2 py-1">${
                                                  disease.type
                                                }</div>
                                            </div>

                                            <!-- 病害描述 -->
                                            <div>
                                                <div class="text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>病害描述</div>
                                                <div class="text-sm bg-gray-100 border rounded px-2 py-1 min-h-[60px]">${
                                                  disease.description
                                                }</div>
                                            </div>

                                            <!-- 照片 -->
                                            <div>
                                                <div class="text-sm text-gray-500 mb-1"><span class="text-red-500">*</span>照片</div>
                                                <div class="grid grid-cols-4 gap-2">
                                                    ${disease.photos
                                                      .map(
                                                        (photo, i) => `
                                                        <div class="relative aspect-square">
                                                            <img src="${photo}" class="w-full h-full object-cover rounded"/>
                                                        </div>
                                                    `
                                                      )
                                                      .join("")}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `
                                  )
                                  .join("")}
                            </div>
                        `;
              } else {
                return `
                            <div class="bg-white border border-gray-200 rounded-lg mb-1 p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-bold text-base text-gray-800">${point}</div>
                                        <div class="text-xs text-gray-500 mt-1">
                                            <span class="font-medium">巡检位置：</span>${pointData.location}
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <span class="${statusColor} text-sm font-medium">${statusText}</span>
                                    </div>
                                </div>
                            </div>
                        `;
              }
            })
            .join("");

          inspectionTabContent += `
                    
                    <!-- 巡检人和巡检时间 -->
                    <div class="bg-white border border-gray-200 rounded-lg mb-1 p-4 mt-3">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center">
                                <span class="text-red-500 mr-1">*</span>
                                <span class="text-sm">巡检人：</span>
                            </div>
                            <div class="text-right text-sm">李明</div>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="text-red-500 mr-1">*</span>
                                <span class="text-sm">巡检时间：</span>
                            </div>
                            <div class="text-right text-sm">2025-11-10 14:30</div>
                        </div>
                    </div>
                    
                    </div> <!-- 这里的 div 闭合的是最外层的 p-4 pb-12 容器 -->
                `;
        }

        // 重置Tab按钮状态
        const detailTabButtons = document.querySelectorAll(
          "#detail-tab-buttons button"
        );
        detailTabButtons.forEach((button) => {
          button.classList.remove(
            "text-blue-600",
            "border-b-2",
            "border-blue-600"
          );
          button.classList.add("text-gray-500");
        });
        // 设置巡检信息Tab为激活状态
        detailTabButtons[0].classList.remove("text-gray-500");
        detailTabButtons[0].classList.add(
          "text-blue-600",
          "border-b-2",
          "border-blue-600"
        );

        document.getElementById("inspection-detail-tab").innerHTML =
          inspectionTabContent;

        // 生成基本信息Tab内容
        document.getElementById("basic-detail-tab").innerHTML = `
                <div class="p-4">
                    <div class="bg-white rounded-lg p-4 space-y-4">
                        <div class="flex items-start py-2 border-b border-gray-200">
                            <div class="w-40 text-gray-600 flex-shrink-0">巡检单位：</div>
                            <div class="flex-1 text-right">高新区城管局</div>
                        </div>
                        <div class="flex items-start py-2 border-b border-gray-200">
                            <div class="w-40 text-gray-600 flex-shrink-0">所属结构物：</div>
                            <div class="flex-1 text-right">${structureName}</div>
                        </div>
                        <div class="flex items-start py-2 border-b border-gray-200">
                            <div class="w-40 text-gray-600 flex-shrink-0">关联巡检计划：</div>
                            <div class="flex-1 text-right">日常保洁巡检</div>
                        </div>
                        <div class="flex items-start py-2 border-b border-gray-200">
                            <div class="w-40 text-gray-600 flex-shrink-0">本次巡检计划开始时间：</div>
                            <div class="flex-1 text-right">${planDates.start}</div>
                        </div>
                        <div class="flex items-start py-2 border-b border-gray-200">
                            <div class="w-40 text-gray-600 flex-shrink-0">本次巡检计划结束时间：</div>
                            <div class="flex-1 text-right">${planDates.end}</div>
                        </div>
                        <div class="flex items-start py-2 border-b border-gray-200">
                            <div class="w-40 text-gray-600 flex-shrink-0">巡检周期开始时间：</div>
                            <div class="flex-1 text-right">${cycleDates.start}</div>
                        </div>
                        <div class="flex items-start py-2">
                            <div class="w-40 text-gray-600 flex-shrink-0">巡检周期结束时间：</div>
                            <div class="flex-1 text-right">${cycleDates.end}</div>
                        </div>
                    </div>

                </div>
            `;

        // 默认显示巡检信息Tab
        document
          .getElementById("inspection-detail-tab")
          .classList.remove("hidden");
        document.getElementById("basic-detail-tab").classList.add("hidden");
      }

      // 填充养护详情数据
      function fillMaintenanceDetail(record) {
        // 模拟的详情数据
        const mockDetailData = {
          maintenanceContent:
            "对桥梁主体结构进行全面检查和维护，包括桥面铺装修补、伸缩缝清理、隔音屏检查等工作。",
          fundUsage:
            "本次养护共使用资金50万元，主要用于材料采购30万元，人工费用15万元，设备租赁5万元。",
          completionPhotos: [
            "养护完工照片1.jpg",
            "养护完工照片2.jpg",
            "养护完工照片3.jpg",
          ],

          // 根据状态添加验收相关信息
          ...(record.status === "验收通过" && {
            acceptanceStatus: "验收通过",
            acceptanceOpinion:
              "养护工程质量符合设计要求，施工规范，质量合格，通过验收。养护后的桥梁结构安全可靠，满足使用要求。",
          }),
          ...(record.status === "验收未通过" && {
            acceptanceStatus: "验收未通过",
            acceptanceOpinion:
              "养护工程存在质量问题，桥面铺装出现裂缝，伸缩缝清理不彻底，需要重新整改。请施工单位按照要求进行修复后重新申请验收。",
          }),
        };

        const detailData = { ...record, ...mockDetailData };

        // 检查是否是"2025年桥梁中修计划"（id=111）
        const isSpecialBridgeRecord = record.id === 111;

        // 重置养护详情Tab按钮状态
        const maintenanceDetailTabButtons = document.querySelectorAll(
          "#maintenance-detail-tab-buttons button"
        );
        maintenanceDetailTabButtons.forEach((button) => {
          button.classList.remove(
            "text-blue-600",
            "border-b-2",
            "border-blue-600"
          );
          button.classList.add("text-gray-500");
        });
        // 设置养护信息Tab为激活状态
        maintenanceDetailTabButtons[0].classList.remove("text-gray-500");
        maintenanceDetailTabButtons[0].classList.add(
          "text-blue-600",
          "border-b-2",
          "border-blue-600"
        );

        // 生成养护信息Tab内容
        let maintenanceInfoContent = `
                <div class="p-4 space-y-4">
            `;

        // 如果是"2025年桥梁中修计划"，添加可展开收起的养护内容
        if (isSpecialBridgeRecord) {
          // 添加养护计划名称在最上面
          maintenanceInfoContent += `
                    <!-- 养护计划名称 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">养护计划名称</label>
                        <div class="p-3 bg-gray-50 rounded-lg text-sm text-gray-900">
                            ${detailData.title}
                        </div>
                    </div>
                `;

          maintenanceInfoContent += `
                    <!-- 养护历史记录 -->
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <!-- 可点击的头部 - 收起状态默认展示第三次养护信息 -->
                        <div onclick="toggleSpecialBridgeRecord('maintenance-history')" class="bg-blue-50 p-3 cursor-pointer flex items-center justify-between">
                            <h3 class="text-blue-700 font-medium">养护历史记录</h3>
                            <svg id="maintenance-history-icon" class="w-4 h-4 text-blue-600 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                        
                        <!-- 收起状态默认显示的第三次养护信息 -->
                        <div id="maintenance-history-collapsed" class="p-4 space-y-3">
                            <div class="border-l-4 border-blue-500 pl-3">
                                <h4 class="font-medium text-gray-800 mb-2">第三次养护</h4>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">验收状态</label>
                                    <div class="p-2 bg-green-100 rounded-lg text-sm font-medium text-green-700">验收通过</div>
                                </div>
                                <div class="mt-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">验收意见</label>
                                    <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">第三次养护工程质量优秀，符合所有设计要求，桥梁结构安全稳固。</div>
                                </div>
                                <div class="mt-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">养护内容</label>
                                    <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">桥梁全面加固和美化，包括护栏更换、路灯升级等。</div>
                                </div>
                                <div class="mt-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">资金使用情况</label>
                                    <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">第三次养护使用资金80万元，用于高级材料和设备。</div>
                                </div>
                                <div class="mt-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">养护完工照片</label>
                                    <div class="grid grid-cols-3 gap-2">
                                        <div class="w-full h-16 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                            <svg viewBox="0 0 200 150" class="w-full h-full object-cover">
                                                <rect width="200" height="150" fill="#10b981"/>
                                                <text x="100" y="75" text-anchor="middle" fill="white" font-size="12" font-family="Arial">第三次养护完工1</text>
                                            </svg>
                                        </div>
                                        <div class="w-full h-16 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                            <svg viewBox="0 0 200 150" class="w-full h-full object-cover">
                                                <rect width="200" height="150" fill="#059669"/>
                                                <text x="100" y="75" text-anchor="middle" fill="white" font-size="12" font-family="Arial">第三次养护完工2</text>
                                            </svg>
                                        </div>
                                        <div class="w-full h-16 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                            <svg viewBox="0 0 200 150" class="w-full h-full object-cover">
                                                <rect width="200" height="150" fill="#047857"/>
                                                <text x="100" y="75" text-anchor="middle" fill="white" font-size="12" font-family="Arial">第三次养护完工3</text>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">养护人</label>
                                    <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">赵六</div>
                                </div>
                                <div class="mt-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">养护上报时间</label>
                                    <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">2025-11-20 10:00</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 展开状态显示的完整信息 -->
                        <div id="maintenance-history-expanded" class="hidden">
                            <!-- 第三次养护完整信息 -->
                            <div class="p-4 border-b border-gray-200">
                                <div class="border-l-4 border-blue-500 pl-3">
                                    <h4 class="font-medium text-gray-800 mb-3">第三次养护</h4>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">验收状态</label>
                                            <div class="p-2 bg-green-100 rounded-lg text-sm font-medium text-green-700">验收通过</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">验收意见</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">第三次养护工程质量优秀，符合所有设计要求，桥梁结构安全稳固。</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">养护内容</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">桥梁全面加固和美化，包括护栏更换、路灯升级等。</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">资金使用情况</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">第三次养护使用资金80万元，用于高级材料和设备。</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">养护完工照片</label>
                                            <div class="grid grid-cols-3 gap-2">
                                                <div class="w-full h-16 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                                    <svg viewBox="0 0 200 150" class="w-full h-full object-cover">
                                                <rect width="200" height="150" fill="#10b981"/>
                                                <text x="100" y="75" text-anchor="middle" fill="white" font-size="12" font-family="Arial">第三次养护完工1</text>
                                            </svg>
                                                </div>
                                                <div class="w-full h-16 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                                    <svg viewBox="0 0 200 150" class="w-full h-full object-cover">
                                                <rect width="200" height="150" fill="#059669"/>
                                                <text x="100" y="75" text-anchor="middle" fill="white" font-size="12" font-family="Arial">第三次养护完工2</text>
                                            </svg>
                                                </div>
                                                <div class="w-full h-16 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                                    <svg viewBox="0 0 200 150" class="w-full h-full object-cover">
                                                <rect width="200" height="150" fill="#047857"/>
                                                <text x="100" y="75" text-anchor="middle" fill="white" font-size="12" font-family="Arial">第三次养护完工3</text>
                                            </svg>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">养护人</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">赵六</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">养护上报时间</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">2025-11-20 10:00</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 第二次养护完整信息 -->
                            <div class="p-4 border-b border-gray-200">
                                <div class="border-l-4 border-green-500 pl-3">
                                    <h4 class="font-medium text-gray-800 mb-3">第二次养护</h4>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">验收状态</label>
                                            <div class="p-2 bg-red-100 rounded-lg text-sm font-medium text-red-700">验收未通过</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">验收意见</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">第二次养护存在部分质量问题，需要返工处理。</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">养护内容</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">桥面重新铺装和标线更新。</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">资金使用情况</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">第二次养护使用资金60万元，主要用于材料升级。</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">养护完工照片</label>
                                            <div class="grid grid-cols-3 gap-2">
                                                <div class="w-full h-16 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                                    <svg viewBox="0 0 200 150" class="w-full h-full object-cover">
                                                        <rect width="200" height="150" fill="#f59e0b"/>
                                                        <text x="100" y="75" text-anchor="middle" fill="white" font-size="12" font-family="Arial">第二次养护完工1</text>
                                                    </svg>
                                                </div>
                                                <div class="w-full h-16 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                                    <svg viewBox="0 0 200 150" class="w-full h-full object-cover">
                                                        <rect width="200" height="150" fill="#d97706"/>
                                                        <text x="100" y="75" text-anchor="middle" fill="white" font-size="12" font-family="Arial">第二次养护完工2</text>
                                                    </svg>
                                                </div>
                                                <div class="w-full h-16 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                                    <svg viewBox="0 0 200 150" class="w-full h-full object-cover">
                                                        <rect width="200" height="150" fill="#b45309"/>
                                                        <text x="100" y="75" text-anchor="middle" fill="white" font-size="12" font-family="Arial">第二次养护完工3</text>
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">养护人</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">李四</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">养护上报时间</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">2025-11-05 15:30</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 第一次养护完整信息 -->
                            <div class="p-4">
                                <div class="border-l-4 border-gray-500 pl-3">
                                    <h4 class="font-medium text-gray-800 mb-3">第一次养护</h4>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">验收状态</label>
                                            <div class="p-2 bg-red-100 rounded-lg text-sm font-medium text-red-700">验收未通过</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">验收意见</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">第一次养护工作不够完善，需要加强施工质量。</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">养护内容</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">基本维护和清洁工作。</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">资金使用情况</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">第一次养护使用资金40万元，用于基础维护。</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">养护完工照片</label>
                                            <div class="grid grid-cols-3 gap-2">
                                                <div class="w-full h-16 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                                    <svg width="100%" height="100%" viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg">
                                                        <rect width="200" height="150" fill="#e5e7eb"/>
                                                        <rect x="20" y="25" width="80" height="35" fill="#9ca3af" rx="2"/>
                                                        <rect x="25" y="30" width="70" height="25" fill="#6b7280" rx="1"/>
                                                        <circle cx="40" cy="42" r="4" fill="#ef4444"/>
                                                        <circle cx="80" cy="42" r="4" fill="#ef4444"/>
                                                        <text x="50" y="47" font-size="8" fill="#6b7280" font-family="Arial">第一次</text>
                                                    </svg>
                                                </div>
                                                <div class="w-full h-16 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                                    <svg width="100%" height="100%" viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg">
                                                        <rect width="200" height="150" fill="#e5e7eb"/>
                                                        <polygon points="100,20 140,35 140,80 100,95 60,80 60,35" fill="#9ca3af"/>
                                                        <rect x="85" y="45" width="30" height="20" fill="#6b7280"/>
                                                        <circle cx="100" cy="40" r="5" fill="#ef4444"/>
                                                        <text x="90" y="85" font-size="7" fill="#6b7280" font-family="Arial">不合格</text>
                                                    </svg>
                                                </div>
                                                <div class="w-full h-16 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                                    <svg width="100%" height="100%" viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg">
                                                        <rect width="200" height="150" fill="#e5e7eb"/>
                                                        <rect x="30" y="40" width="140" height="35" fill="#9ca3af" rx="2"/>
                                                        <rect x="40" y="50" width="120" height="15" fill="#6b7280" rx="1"/>
                                                        <circle cx="70" cy="57" r="4" fill="#ef4444"/>
                                                        <circle cx="130" cy="57" r="4" fill="#ef4444"/>
                                                        <text x="85" y="62" font-size="8" fill="#6b7280" font-family="Arial">需返工</text>
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">养护人</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">张三</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">养护上报时间</label>
                                            <div class="p-2 bg-gray-50 rounded-lg text-sm text-gray-900">2025-10-20 09:00</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
        } else {
          // 常规养护内容显示

          // 养护计划名称 - 在最上面显示
          maintenanceInfoContent += `
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">养护计划名称</label>
                        <div class="p-3 bg-gray-50 rounded-lg text-sm text-gray-900">
                            ${detailData.title}
                        </div>
                    </div>
                `;

          // 验收状态 - 仅在验收通过或不通过时显示
          if (detailData.acceptanceStatus) {
            maintenanceInfoContent += `
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">验收状态</label>
                            <div class="p-3 rounded-lg text-sm font-medium ${
                              detailData.acceptanceStatus === "验收通过"
                                ? "bg-green-100 text-green-700"
                                : "bg-red-100 text-red-700"
                            }">
                                ${detailData.acceptanceStatus}
                            </div>
                        </div>
                    `;
          }

          // 验收意见 - 仅在验收通过或不通过时显示
          if (detailData.acceptanceOpinion) {
            maintenanceInfoContent += `
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">验收意见</label>
                            <div class="p-3 bg-gray-50 rounded-lg text-sm text-gray-900">
                                ${detailData.acceptanceOpinion}
                            </div>
                        </div>
                    `;
          }

          // 养护内容
          maintenanceInfoContent += `
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">养护内容</label>
                        <div class="p-3 bg-gray-50 rounded-lg text-sm text-gray-900">
                            ${detailData.maintenanceContent}
                        </div>
                    </div>
                    
                    <!-- 资金使用情况 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">资金使用情况</label>
                        <div class="p-3 bg-gray-50 rounded-lg text-sm text-gray-900">
                            ${detailData.fundUsage}
                        </div>
                    </div>
                    
                    <!-- 养护完工照片 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">养护完工照片</label>
                        <div class="grid grid-cols-3 gap-2">
                            ${detailData.completionPhotos
                              .map(
                                (photo, index) => `
                                <div class="relative group">
                                    <div class="w-full h-24 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                        <svg viewBox="0 0 200 150" class="w-full h-full object-cover">
                                            <rect width="200" height="150" fill="#6366f1"/>
                                            <text x="100" y="75" text-anchor="middle" fill="white" font-size="12" font-family="Arial">${photo}</text>
                                        </svg>
                                    </div>
                                    <div class="text-xs text-gray-600 mt-1 truncate">${photo}</div>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                    </div>
                    
                    <!-- 养护上报时间 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">养护上报时间</label>
                        <div class="p-3 bg-gray-50 rounded-lg text-sm text-gray-900">
                            2025-10-15 14:30
                        </div>
                    </div>
                    
                    <!-- 养护人 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">养护人</label>
                        <div class="p-3 bg-gray-50 rounded-lg text-sm text-gray-900">
                            ${detailData.acceptanceStaff || "王强"}
                        </div>
                    </div>
                `;
        }

        maintenanceInfoContent += `
                </div>
            `;

        document.getElementById("maintenance-info-detail-tab").innerHTML =
          maintenanceInfoContent;

        // 生成基本信息Tab内容
        document.getElementById("maintenance-basic-detail-tab").innerHTML = `
                <div class="p-4 flex-1 overflow-y-auto">
                    <div class="space-y-4">
                        <div class="grid grid-cols-3 gap-2 text-sm">
                            <div class="text-gray-600">养护使用类型：</div>
                            <div class="col-span-2">${
                              detailData.maintenanceType
                            }</div>
                        </div>
                        <div class="grid grid-cols-3 gap-2 text-sm">
                            <div class="text-gray-600">养护单位：</div>
                            <div class="col-span-2">${
                              detailData.maintenanceUnit || "A单位"
                            }</div>
                        </div>
                        <div class="grid grid-cols-3 gap-2 text-sm">
                            <div class="text-gray-600">结构物类型：</div>
                            <div class="col-span-2">${
                              detailData.structureType
                            }</div>
                        </div>
                        <div class="grid grid-cols-3 gap-2 text-sm">
                            <div class="text-gray-600">结构物名称：</div>
                            <div class="col-span-2">${
                              detailData.structureName || "海尔立交桥"
                            }</div>
                        </div>
                        <div class="grid grid-cols-3 gap-2 text-sm">
                            <div class="text-gray-600">养护开始时间：</div>
                            <div class="col-span-2">${
                              detailData.startDate
                            }</div>
                        </div>
                        <div class="grid grid-cols-3 gap-2 text-sm">
                            <div class="text-gray-600">养护结束时间：</div>
                            <div class="col-span-2">${detailData.endDate}</div>
                        </div>
                        <div class="grid grid-cols-3 gap-2 text-sm">
                            <div class="text-gray-600">养护内容描述：</div>
                            <div class="col-span-2">环氧树脂注浆5kg</div>
                        </div>
                    </div>

                </div>
            `;

        // 默认显示养护信息Tab
        document
          .getElementById("maintenance-info-detail-tab")
          .classList.remove("hidden");
        document
          .getElementById("maintenance-basic-detail-tab")
          .classList.add("hidden");
      }

      // 切换巡检详情Tab
      function switchDetailTab(tab) {
        // 更新Tab按钮状态
        const detailTabButtons = document.querySelectorAll(
          "#detail-tab-buttons button"
        );
        detailTabButtons.forEach((button) => {
          button.classList.remove(
            "text-blue-600",
            "border-b-2",
            "border-blue-600"
          );
          button.classList.add("text-gray-500");
        });

        if (tab === "inspection") {
          detailTabButtons[0].classList.remove("text-gray-500");
          detailTabButtons[0].classList.add(
            "text-blue-600",
            "border-b-2",
            "border-blue-600"
          );
          document
            .getElementById("inspection-detail-tab")
            .classList.remove("hidden");
          document.getElementById("basic-detail-tab").classList.add("hidden");
        } else {
          detailTabButtons[1].classList.remove("text-gray-500");
          detailTabButtons[1].classList.add(
            "text-blue-600",
            "border-b-2",
            "border-blue-600"
          );
          document
            .getElementById("inspection-detail-tab")
            .classList.add("hidden");
          document
            .getElementById("basic-detail-tab")
            .classList.remove("hidden");
        }
      }

      // 切换养护详情Tab
      function switchMaintenanceDetailTab(tab) {
        // 更新Tab按钮状态
        const maintenanceDetailTabButtons = document.querySelectorAll(
          "#maintenance-detail-tab-buttons button"
        );
        maintenanceDetailTabButtons.forEach((button) => {
          button.classList.remove(
            "text-blue-600",
            "border-b-2",
            "border-blue-600"
          );
          button.classList.add("text-gray-500");
        });

        if (tab === "maintenance") {
          maintenanceDetailTabButtons[0].classList.remove("text-gray-500");
          maintenanceDetailTabButtons[0].classList.add(
            "text-blue-600",
            "border-b-2",
            "border-blue-600"
          );
          document
            .getElementById("maintenance-info-detail-tab")
            .classList.remove("hidden");
          document
            .getElementById("maintenance-basic-detail-tab")
            .classList.add("hidden");
        } else {
          maintenanceDetailTabButtons[1].classList.remove("text-gray-500");
          maintenanceDetailTabButtons[1].classList.add(
            "text-blue-600",
            "border-b-2",
            "border-blue-600"
          );
          document
            .getElementById("maintenance-info-detail-tab")
            .classList.add("hidden");
          document
            .getElementById("maintenance-basic-detail-tab")
            .classList.remove("hidden");
        }
      }

      // 查看所有巡检任务
      function viewAllTasks() {
        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 隐藏底部导航栏
        document.getElementById("bottom-nav").classList.add("hidden");

        // 显示所有巡检任务页面
        document.getElementById("all-tasks-page").classList.remove("hidden");

        // 更新页面标题和返回按钮
        document.getElementById("page-title").textContent = "巡检任务";
        document.getElementById("back-btn").classList.remove("hidden");

        // 设置当前页面状态
        appState.currentPage = "allTasks";
        appState.previousPage = "main";

        // 加载所有巡检任务数据
        loadAllInspectionTasks();
      }

      // 查看所有养护任务
      function viewAllMaintenanceTasks() {
        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示所有养护任务页面
        document
          .getElementById("all-maintenance-tasks-page")
          .classList.remove("hidden");

        // 更新页面标题和返回按钮
        document.getElementById("page-title").textContent = "养护任务";
        document.getElementById("back-btn").classList.remove("hidden");

        // 隐藏底部导航栏
        document.getElementById("bottom-nav").classList.add("hidden");

        // 设置当前页面状态
        appState.currentPage = "allMaintenanceTasks";
        appState.previousPage = "main";

        // 延迟加载所有养护任务数据，确保DOM已经准备好
        setTimeout(() => {
          console.log("Starting to load maintenance tasks...");
          loadAllMaintenanceTasks();
        }, 100);
      }

      // 动态控制select文本颜色，与React版本保持一致
      function updateSelectColor(selectElement) {
        if (
          selectElement.value &&
          selectElement.value !== "全部" &&
          selectElement.value !== ""
        ) {
          selectElement.style.color = "#000";
        } else {
          selectElement.style.color = "#9ca3af"; /* text-gray-400 */
        }
      }

      // 为所有select元素添加change事件监听
      document.addEventListener("DOMContentLoaded", function () {
        // 确保底部导航栏在初始状态下正确显示
        const bottomNav = document.getElementById("bottom-nav");
        if (bottomNav && bottomNav.classList.contains("hidden")) {
          bottomNav.classList.remove("hidden");
        }

        const selects = document.querySelectorAll("select");
        selects.forEach((select) => {
          // 初始化颜色
          updateSelectColor(select);

          // 添加change事件监听
          select.addEventListener("change", function () {
            updateSelectColor(this);
          });
        });

        // 预加载养护任务数据以确保数据可用
        setTimeout(() => {
          const allMaintenanceSelects = document.querySelectorAll(
            "#all-maintenance-tasks-structure-filter, #all-maintenance-tasks-type-filter"
          );
          allMaintenanceSelects.forEach((select) => {
            updateSelectColor(select);
            select.addEventListener("change", function () {
              updateSelectColor(this);
            });
          });

          if (document.getElementById("all-maintenance-tasks-list")) {
            loadAllMaintenanceTasks();
          }
        }, 500);
      });

      // 筛选巡检任务
      function filterInspectionTasks() {
        const searchText = document
          .getElementById("inspection-search")
          .value.toLowerCase();
        const structureTypes = getMultiSelectValues(
          "inspection-structure-filter"
        );
        const expireStatus = document.getElementById(
          "inspection-expire-filter"
        ).value;

        const filteredTasks = inspectionTasksData.filter((task) => {
          if (appState.completedTasks.includes(task.id)) return false;

          // 搜索文本筛选：如果输入了搜索文本，但任务标题不包含搜索文本，则过滤掉
          if (searchText && !task.title.toLowerCase().includes(searchText))
            return false;

          // 结构物类型筛选：多选逻辑
          if (
            !structureTypes.includes("全部") &&
            !structureTypes.includes(task.structureType)
          )
            return false;

          // 超期状态筛选
          if (expireStatus === "超期" && !task.expired) return false;
          if (expireStatus === "正常" && task.expired) return false;

          return true;
        });

        console.log("筛选结果:", {
          filteredCount: filteredTasks.length,
          tasks: filteredTasks.map((t) => ({ id: t.id, title: t.title })),
        });

        const container = document.getElementById("pending-tasks-list");
        container.innerHTML = filteredTasks
          .map(
            (task) => `
                <!-- 修改：去掉了onclick事件和cursor-pointer样式，现在点击卡片空白处不会跳转了 -->
                <div class="card">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="flex-1 text-sm">${task.title}</h3>
                        <span class="text-xs ml-2 ${
                          task.expired ? "text-red-500" : "text-green-500"
                        }">
                            ${task.expired ? "超期" : "正常"}
                        </span>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">计划巡检日期：${
                      task.planDate
                    }</div>
                    <div class="mb-2">
                        <span class="badge ${getStructureTypeBadgeColor(
                          task.structureType
                        )}">
                            ${task.structureType}
                        </span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-600">计划巡检周期：${
                          task.cycle
                        }</span>
                        <button class="btn-primary text-xs px-2 py-1 rounded" onclick="startInspection(${
                          task.id
                        })">
                            开始巡检
                        </button>
                    </div>
                </div>
            `
          )
          .join("");

        document.getElementById("pending-count").textContent =
          filteredTasks.length;
      }

      // 筛选巡检记录
      function filterInspectionRecords() {
        const searchText = document
          .getElementById("records-search")
          .value.toLowerCase();
        const structureTypes = getMultiSelectValues("records-structure-filter");
        const expireStatus = document.getElementById(
          "records-expire-filter"
        ).value;
        const result = document.getElementById("records-result-filter").value;
        const startDate = document.getElementById("records-start-date").value;
        const endDate = document.getElementById("records-end-date").value;

        const filteredRecords = inspectionRecordsData.filter((record) => {
          if (searchText && !record.title.toLowerCase().includes(searchText))
            return false;
          if (
            !structureTypes.includes("全部") &&
            !structureTypes.includes(record.structureType)
          )
            return false;
          if (expireStatus === "超期" && !record.expired) return false;
          if (expireStatus === "正常" && record.expired) return false;
          if (result && result !== "全部" && record.result !== result)
            return false;

          if (startDate || endDate) {
            const inspectionDate = record.inspectionTime.split(" ")[0];
            if (startDate && inspectionDate < startDate) return false;
            if (endDate && inspectionDate > endDate) return false;
          }

          return true;
        });

        const container = document.getElementById("records-list");
        container.innerHTML = filteredRecords
          .map(
            (record) => `
                <div class="card cursor-pointer hover:shadow-lg transition-shadow relative overflow-hidden" onclick="viewInspectionDetail(${
                  record.id
                })">
                    <!-- 右上角斜角标签 -->
                    <div class="absolute top-0 right-0 w-24 h-24 overflow-hidden">
                        <div class="absolute transform rotate-45 translate-x-9 -translate-y-1 ${
                          record.result === "完好"
                            ? "bg-green-500"
                            : "bg-red-500"
                        } text-white text-xs font-medium px-8 py-1">
                            ${record.result}
                        </div>
                    </div>
                    <div class="mb-2">
                        <h3 class="text-sm pr-16">${record.title}</h3>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">巡检时间：${
                      record.inspectionTime
                    }</div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="badge ${getStructureTypeBadgeColor(
                          record.structureType
                        )}">
                            ${record.structureType}
                        </span>
                        <span class="text-xs ${
                          record.expired ? "text-red-500" : "text-green-500"
                        }">
                            ${record.expired ? "超期" : "正常"}
                        </span>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">计划巡检周期：${
                      record.cycle
                    }</div>
                </div>
            `
          )
          .join("");

        document.getElementById("records-count").textContent =
          filteredRecords.length;
      }

      // 筛选养护任务
      function filterMaintenanceTasks() {
        const searchText = document
          .getElementById("pending-maintenance-search")
          .value.toLowerCase();
        const structureTypes = getMultiSelectValues(
          "pending-maintenance-structure-filter"
        );
        const maintenanceType = document.getElementById(
          "pending-maintenance-type-filter"
        ).value;

        const filteredTasks = pendingMaintenanceTasks.filter((task) => {
          if (searchText && !task.title.toLowerCase().includes(searchText))
            return false;
          if (
            !structureTypes.includes("全部") &&
            !structureTypes.includes(task.structureType)
          )
            return false;
          if (
            maintenanceType &&
            maintenanceType !== "全部" &&
            task.maintenanceType !== maintenanceType
          )
            return false;
          return true;
        });

        const container = document.getElementById("pending-maintenance-list");
        if (filteredTasks.length === 0) {
          container.innerHTML =
            '<div class="text-center text-gray-500 py-8">暂无养护任务</div>';
          document.getElementById("pending-maintenance-count").textContent =
            "0";
          return;
        }

        container.innerHTML = filteredTasks
          .map(
            (task) => `
                <!-- 修改：去掉了onclick事件和cursor-pointer样式，现在点击卡片空白处不会跳转了 -->
                <div class="card">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="flex-1 text-sm">${task.title}</h3>
                        ${
                          task.status
                            ? `
                            <div class="px-2 py-1 rounded text-xs font-medium ${getStatusColor(
                              task.status
                            )}">
                                ${task.status}
                            </div>
                        `
                            : ""
                        }
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护使用类型：${
                      task.maintenanceType
                    }</div>
                    <div class="flex items-center justify-between mb-2 gap-2">
                        <div>
                            <span class="badge ${getStructureTypeBadgeColor(
                              task.structureType
                            )}">
                                ${task.structureType}
                            </span>
                        </div>
                        <button class="btn-primary text-xs px-2 py-1 rounded" onclick="event.stopPropagation(); startMaintenanceFromPending(${
                          task.id
                        })">
                            开始养护
                        </button>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护时间：${
                      task.startDate
                    } ~ ${task.endDate}</div>
                    <div class="flex justify-end gap-2 mb-2">
                        ${
                          task.id === 10 || task.id === 11 || task.id === 12
                            ? `
    
                        `
                            : ""
                        }
                    </div>
                </div>
            `
          )
          .join("");

        document.getElementById("pending-maintenance-count").textContent =
          filteredTasks.length;
      }

      // 筛选养护记录
      function filterMaintenanceRecords() {
        const searchText = document
          .getElementById("records-maintenance-search")
          .value.toLowerCase();
        const structureTypes = getMultiSelectValues(
          "records-maintenance-structure-filter"
        );
        const maintenanceType = document.getElementById(
          "records-maintenance-type-filter"
        ).value;
        const status = document.getElementById(
          "records-maintenance-status-filter"
        ).value;
        const startDate = document.getElementById(
          "maintenance-start-date"
        ).value;
        const endDate = document.getElementById("maintenance-end-date").value;

        const filteredRecords = maintenanceRecordsData.filter((record) => {
          if (searchText && !record.title.toLowerCase().includes(searchText))
            return false;
          if (
            !structureTypes.includes("全部") &&
            !structureTypes.includes(record.structureType)
          )
            return false;
          if (
            maintenanceType &&
            maintenanceType !== "全部" &&
            record.maintenanceType !== maintenanceType
          )
            return false;
          if (status && status !== "全部" && record.status !== status)
            return false;

          if (startDate || endDate) {
            const recordStart = new Date(record.startDate);
            const recordEnd = new Date(record.endDate);
            const filterStart = startDate
              ? new Date(startDate)
              : new Date("1900-01-01");
            const filterEnd = endDate
              ? new Date(endDate)
              : new Date("2100-12-31");

            if (recordStart > filterEnd || recordEnd < filterStart)
              return false;
          }

          return true;
        });

        const container = document.getElementById("maintenance-records-list");
        if (filteredRecords.length === 0) {
          container.innerHTML =
            '<div class="text-center text-gray-500 py-8">暂无养护记录</div>';
          document.getElementById("maintenance-records-count").textContent =
            "0";
          return;
        }

        container.innerHTML = filteredRecords
          .map(
            (record) => `
                <div class="card cursor-pointer hover:shadow-lg transition-shadow" onclick="viewMaintenanceDetail(${
                  record.id
                })">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="flex-1 text-sm">${record.title}</h3>
                        ${
                          record.status
                            ? `
                            <div class="px-2 py-1 rounded text-xs font-medium ${getStatusColor(
                              record.status
                            )}">
                                ${record.status}
                            </div>
                        `
                            : ""
                        }
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护使用类型：${
                      record.maintenanceType
                    }</div>
                    <div class="flex items-center justify-between mb-2 ${
                      record.id === 103 ||
                      record.id === 108 ||
                      record.id === 110
                        ? "gap-2"
                        : ""
                    }">
                        <div>
                            <span class="badge ${getStructureTypeBadgeColor(
                              record.structureType
                            )}">
                                ${record.structureType}
                            </span>
                        </div>
                        ${
                          record.id === 103 ||
                          record.id === 108 ||
                          record.id === 110
                            ? `
                            <button class="btn-primary text-xs px-2 py-1 rounded" onclick="event.stopPropagation(); startMaintenanceFromRecords(${record.id})">
                                开始养护
                            </button>
                        `
                            : ""
                        }
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护时间：${
                      record.startDate
                    } ~ ${record.endDate}</div>
                    <div class="flex justify-end gap-2 mb-2">

                    </div>
                </div>
            `
          )
          .join("");

        document.getElementById("maintenance-records-count").textContent =
          filteredRecords.length;
      }

      // 监听文本框字符数变化
      document.addEventListener("DOMContentLoaded", function () {
        // 监听养护内容字符数
        const maintenanceContent = document.getElementById(
          "maintenance-content"
        );
        if (maintenanceContent) {
          maintenanceContent.addEventListener("input", function () {
            updateCharacterCount("maintenance-content");
          });
        }

        // 监听资金使用情况字符数
        const fundUsage = document.getElementById("fund-usage");
        if (fundUsage) {
          fundUsage.addEventListener("input", function () {
            updateCharacterCount("fund-usage");
          });
        }

        // 更新时间
        updateTime();
        setInterval(updateTime, 60000);

        // 初始化页面
        loadTodoData();
      });

      // 跳转到历史填报页面
      function openHistory() {
        window.location.href = "history.html";
      }

      // 显示页面
      function showPage(pageId) {
        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示指定页面
        const targetPage = document.getElementById(pageId);
        if (targetPage) {
          targetPage.classList.remove("hidden");
        }
      }

      // 更新页面标题
      function updatePageTitle(title) {
        document.getElementById("page-title").textContent = title;
      }

      // 显示/隐藏返回按钮
      function showBackButton(show) {
        const backBtn = document.getElementById("back-btn");
        if (show) {
          backBtn.classList.remove("hidden");
        } else {
          backBtn.classList.add("hidden");
        }
      }

      // 打开历史填报页面

      // 切换历史填报页面Tab

      // 渲染历史记录

      // 打开历史图片模态框
    </script>

    <!-- 巡检详情页面 -->
    <div
      id="inspection-detail-page"
      class="page hidden fixed inset-0 bg-gray-50 max-w-md mx-auto flex flex-col z-50"
    >
      <!-- 状态栏 -->
      <div class="status-bar">
        <span id="current-time">09:00</span>
        <div class="flex items-center gap-1">
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"
            />
          </svg>
          <svg class="w-4 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"
            />
          </svg>
          <span>100%</span>
        </div>
      </div>

      <!-- 顶部导航栏 - 蓝色填充 -->
      <div class="nav-header">
        <button class="mr-3" onclick="goBack()">
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </button>
        <h1>查看详情</h1>
        <div class="w-6 mr-3"></div>
      </div>

      <!-- Tab页 -->
      <div
        id="detail-tab-buttons"
        class="bg-white flex border-b border-gray-200 w-full"
      >
        <button
          onclick="switchDetailTab('inspection')"
          class="flex-1 py-3 text-center text-blue-600 border-b-2 border-blue-600"
        >
          巡检信息
        </button>
        <button
          onclick="switchDetailTab('basic')"
          class="flex-1 py-3 text-center text-gray-500"
        >
          基本信息
        </button>
      </div>

      <!-- 巡检信息Tab内容 -->
      <div id="inspection-detail-tab" class="flex-1 overflow-y-auto"></div>

      <!-- 基本信息Tab内容 -->
      <div id="basic-detail-tab" class="hidden flex-1 overflow-y-auto"></div>
    </div>

    <!-- 养护详情页面 -->
    <div
      id="maintenance-detail-page"
      class="page hidden fixed inset-0 bg-white max-w-md mx-auto flex flex-col z-50"
    >
      <!-- 状态栏 -->
      <div class="status-bar">
        <span id="current-time">09:00</span>
        <div class="flex items-center gap-1">
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"
            />
          </svg>
          <svg class="w-4 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"
            />
          </svg>
          <span>100%</span>
        </div>
      </div>

      <!-- 顶部导航栏 - 蓝色填充 -->
      <div class="nav-header">
        <button class="mr-3" onclick="goBack()">
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </button>
        <h1>养护详情</h1>
        <div class="w-6 mr-3"></div>
      </div>

      <!-- Tab页 -->
      <div
        id="maintenance-detail-tab-buttons"
        class="flex border-b border-gray-200 w-full"
      >
        <button
          onclick="switchMaintenanceDetailTab('maintenance')"
          class="flex-1 py-3 text-center text-blue-600 border-b-2 border-blue-600"
        >
          养护信息
        </button>
        <button
          onclick="switchMaintenanceDetailTab('basic')"
          class="flex-1 py-3 text-center text-gray-500"
        >
          基本信息
        </button>
      </div>

      <!-- 养护信息内容 -->
      <div
        id="maintenance-info-detail-tab"
        class="flex-1 overflow-y-auto"
      ></div>

      <!-- 基本信息内容 -->
      <div
        id="maintenance-basic-detail-tab"
        class="hidden flex-1 overflow-y-auto"
      ></div>
    </div>

    <!-- 所有巡检任务页面 -->
    <div
      id="all-tasks-page"
      class="page hidden fixed inset-0 bg-gray-50 max-w-md mx-auto flex flex-col z-50"
    >
      <!-- 状态栏 -->
      <div class="status-bar">
        <span id="current-time">09:00</span>
        <div class="flex items-center gap-1">
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"
            />
          </svg>
          <svg class="w-4 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"
            />
          </svg>
          <span>100%</span>
        </div>
      </div>

      <!-- 顶部导航栏 -->
      <div class="page-nav-header">
        <button class="mr-3" onclick="goBack()">
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </button>
        <h1>巡检任务</h1>
        <div class="w-6 mr-3"></div>
      </div>

      <!-- 页面内容 - 紧贴导航栏 -->
      <div class="flex-1 overflow-y-auto">
        <div class="p-4 pt-4">
          <!-- 搜索栏 -->
          <div class="mb-4">
            <div class="relative">
              <svg
                class="w-4 h-4 absolute left-3 top-3 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
              <input
                type="text"
                id="all-tasks-search"
                placeholder="搜索任务名称"
                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 search-center"
                onkeyup="if(event.key === 'Enter') loadAllInspectionTasks()"
              />
              <button
                onclick="loadAllInspectionTasks()"
                class="absolute right-2 top-2 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs"
              >
                搜索
              </button>
            </div>
          </div>

          <!-- 筛选栏 -->
          <div class="flex gap-2 mb-4 overflow-x-auto">
            <div class="flex-1 multi-select-container">
              <!-- 触发器 -->
              <div
                class="multi-select-trigger"
                onclick="toggleMultiSelect('all-tasks-structure-filter')"
              >
                <span
                  id="all-tasks-structure-filter-text"
                  class="truncate text-gray-400"
                  >全部结构物</span
                >
                <svg
                  class="w-4 h-4 ml-1 text-gray-400 flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"
                  />
                </svg>
              </div>
              <!-- 下拉菜单 -->
              <div
                id="all-tasks-structure-filter-dropdown"
                class="multi-select-dropdown"
              >
                <label class="multi-select-option">
                  <input
                    type="checkbox"
                    value="全部"
                    checked
                    onchange="handleMultiSelectChange('all-tasks-structure-filter', '全部', 'loadAllInspectionTasks')"
                  />
                  全部结构物
                </label>
                <label class="multi-select-option">
                  <input
                    type="checkbox"
                    value="桥梁"
                    onchange="handleMultiSelectChange('all-tasks-structure-filter', '桥梁', 'loadAllInspectionTasks')"
                  />
                  桥梁
                </label>
                <label class="multi-select-option">
                  <input
                    type="checkbox"
                    value="道路"
                    onchange="handleMultiSelectChange('all-tasks-structure-filter', '道路', 'loadAllInspectionTasks')"
                  />
                  道路
                </label>
                <label class="multi-select-option">
                  <input
                    type="checkbox"
                    value="隧道"
                    onchange="handleMultiSelectChange('all-tasks-structure-filter', '隧道', 'loadAllInspectionTasks')"
                  />
                  隧道
                </label>
              </div>
            </div>
            <div class="flex-1 relative">
              <select
                id="all-tasks-expire-filter"
                class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none bg-white pr-8 text-sm text-gray-400 select-center"
                style="
                  appearance: none;
                  -webkit-appearance: none;
                  -moz-appearance: none;
                "
                onchange="loadAllInspectionTasks()"
              >
                <option value="" disabled selected>是否超期</option>
                <option value="全部">全部</option>
                <option value="超期">超期</option>
                <option value="正常">正常</option>
              </select>
              <svg
                class="absolute right-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                />
              </svg>
            </div>
          </div>

          <!-- 任务列表 -->
          <div class="space-y-3" id="all-tasks-list">
            <!-- 动态生成巡检任务 -->
          </div>
        </div>
      </div>
    </div>

    <!-- 所有养护任务页面 -->
    <div
      id="all-maintenance-tasks-page"
      class="page hidden fixed inset-0 bg-gray-50 max-w-md mx-auto flex flex-col z-50"
    >
      <!-- 顶部导航栏 -->
      <div class="page-nav-header">
        <button class="mr-3" onclick="goBack()">
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </button>
        <h1>养护任务</h1>
        <div class="w-6 mr-3"></div>
      </div>

      <!-- 页面内容 -->
      <div class="flex-1 overflow-y-auto bg-white">
        <div class="p-4">
          <!-- 搜索栏 -->
          <div class="flex gap-2 mb-4">
            <div class="flex-1 search-box">
              <svg
                class="search-icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
              <input
                type="text"
                placeholder="请输入搜索内容"
                class="search-input search-center"
                id="all-maintenance-tasks-search"
                onkeyup="loadAllMaintenanceTasks()"
              />
            </div>
            <button class="btn-primary" onclick="loadAllMaintenanceTasks()">
              搜索
            </button>
          </div>

          <!-- 筛选栏 -->
          <div class="flex gap-2 mb-4">
            <div class="flex-1 multi-select-container">
              <!-- 触发器 -->
              <div
                class="multi-select-trigger"
                onclick="toggleMultiSelect('all-maintenance-tasks-structure-filter')"
              >
                <span
                  id="all-maintenance-tasks-structure-filter-text"
                  class="truncate text-gray-400"
                  >全部结构物</span
                >
                <svg
                  class="w-4 h-4 ml-1 text-gray-400 flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"
                  />
                </svg>
              </div>
              <!-- 下拉菜单 -->
              <div
                id="all-maintenance-tasks-structure-filter-dropdown"
                class="multi-select-dropdown"
              >
                <label class="multi-select-option">
                  <input
                    type="checkbox"
                    value="全部"
                    checked
                    onchange="handleMultiSelectChange('all-maintenance-tasks-structure-filter', '全部', 'loadAllMaintenanceTasks')"
                  />
                  全部结构物
                </label>
                <label class="multi-select-option">
                  <input
                    type="checkbox"
                    value="桥梁"
                    onchange="handleMultiSelectChange('all-maintenance-tasks-structure-filter', '桥梁', 'loadAllMaintenanceTasks')"
                  />
                  桥梁
                </label>
                <label class="multi-select-option">
                  <input
                    type="checkbox"
                    value="道路"
                    onchange="handleMultiSelectChange('all-maintenance-tasks-structure-filter', '道路', 'loadAllMaintenanceTasks')"
                  />
                  道路
                </label>
                <label class="multi-select-option">
                  <input
                    type="checkbox"
                    value="隧道"
                    onchange="handleMultiSelectChange('all-maintenance-tasks-structure-filter', '隧道', 'loadAllMaintenanceTasks')"
                  />
                  隧道
                </label>
              </div>
            </div>
            <div class="flex-1 select-wrapper">
              <select
                id="all-maintenance-tasks-type-filter"
                onchange="loadAllMaintenanceTasks()"
                class="text-gray-600 select-center"
              >
                <option value="全部">养护使用类型</option>
                <option value="保养小修">保养小修</option>
                <option value="中修工程">中修工程</option>
                <option value="大修工程">大修工程</option>
                <option value="加固工程">加固工程</option>
                <option value="改扩建工程">改扩建工程</option>
              </select>
              <svg
                class="select-icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                />
              </svg>
            </div>
          </div>

          <!-- 数据统计 -->
          <div class="text-gray-600 text-sm mb-3">
            共 <span id="all-maintenance-tasks-count">11</span> 条数据
          </div>

          <!-- 任务列表 -->
          <div
            class="space-y-3"
            id="all-maintenance-tasks-list"
            style="min-height: 200px"
          >
            <!-- 动态生成养护任务 -->
          </div>
        </div>
      </div>
    </div>

    <script>
      // 加载所有巡检任务
      function loadAllInspectionTasks() {
        const searchText = document
          .getElementById("all-tasks-search")
          .value.toLowerCase();
        const structureTypes = getMultiSelectValues(
          "all-tasks-structure-filter"
        );
        const expireStatusSelect = document.getElementById(
          "all-tasks-expire-filter"
        );
        const expireStatus = expireStatusSelect.value;

        console.log("搜索调试信息:", {
          searchText,
          structureTypes,
          expireStatus,
          totalData: inspectionTasksData.length,
        });

        if (expireStatus) {
          expireStatusSelect.style.color = "#000";
        } else {
          expireStatusSelect.style.color = "#9ca3af";
        }

        const filteredTasks = inspectionTasksData.filter((task) => {
          if (appState.completedTasks.includes(task.id)) return false;

          // 搜索文本筛选：如果输入了搜索文本，但任务标题不包含搜索文本，则过滤掉
          if (searchText && !task.title.toLowerCase().includes(searchText))
            return false;

          // 结构物类型筛选：多选逻辑
          if (
            !structureTypes.includes("全部") &&
            !structureTypes.includes(task.structureType)
          )
            return false;

          // 超期状态筛选
          if (expireStatus === "超期" && !task.expired) return false;
          if (expireStatus === "正常" && task.expired) return false;

          return true;
        });

        console.log("筛选结果:", {
          filteredCount: filteredTasks.length,
          tasks: filteredTasks.map((t) => ({ id: t.id, title: t.title })),
        });

        const tasksList = document.getElementById("all-tasks-list");
        tasksList.innerHTML = "";

        // 如果没有搜索结果，显示提示信息
        if (filteredTasks.length === 0) {
          tasksList.innerHTML =
            '<div class="text-center text-gray-500 py-8">没有找到匹配的任务</div>';
          return;
        }

        filteredTasks.forEach((task) => {
          const taskElement = document.createElement("div");
          taskElement.className =
            "bg-white border border-gray-200 rounded-lg p-4";
          taskElement.innerHTML = `
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="flex-1 text-sm">${task.title}</h3>
                        <span class="text-xs ml-2 ${
                          task.expired ? "text-red-500" : "text-green-500"
                        }">
                            ${task.expired ? "超期" : "正常"}
                        </span>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">计划巡检日期：${
                      task.planDate
                    }</div>
                    <div class="mb-2">
                        <span class="inline-block px-2 py-1 text-xs rounded-full ${getStructureTypeBadgeColor(
                          task.structureType
                        )}">
                            ${task.structureType}
                        </span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-600">计划巡检周期：${
                          task.cycle
                        }</span>
                        <button onclick="startInspectionFromAllTasks(${
                          task.id
                        })" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs">
                            开始巡检
                        </button>
                    </div>
                `;
          tasksList.appendChild(taskElement);
        });
      }

      // 加载所有养护任务（使用与"我的养护"页面相同的数据）
      function loadAllMaintenanceTasks() {
        // 检查元素是否存在
        const searchElement = document.getElementById(
          "all-maintenance-tasks-search"
        );
        const structureElement = document.getElementById(
          "all-maintenance-tasks-structure-filter"
        );
        const typeElement = document.getElementById(
          "all-maintenance-tasks-type-filter"
        );
        const tasksListElement = document.getElementById(
          "all-maintenance-tasks-list"
        );

        if (
          !searchElement ||
          !structureElement ||
          !typeElement ||
          !tasksListElement
        ) {
          console.error("Some elements are missing!");
          return;
        }

        const searchText = searchElement.value.toLowerCase();
        const structureTypes = getMultiSelectValues(
          "all-maintenance-tasks-structure-filter"
        );
        const maintenanceType = typeElement.value;

        // 使用与"我的养护"页面相同的过滤逻辑
        const filteredTasks = pendingMaintenanceTasks.filter((task) => {
          if (searchText && !task.title.toLowerCase().includes(searchText))
            return false;
          if (
            !structureTypes.includes("全部") &&
            !structureTypes.includes(task.structureType)
          )
            return false;
          if (
            maintenanceType &&
            maintenanceType !== "全部" &&
            task.maintenanceType !== maintenanceType
          )
            return false;

          return true;
        });

        const tasksList = tasksListElement;
        tasksList.innerHTML = "";

        // 更新数据统计
        const countElement = document.getElementById(
          "all-maintenance-tasks-count"
        );
        if (countElement) {
          countElement.textContent = filteredTasks.length;
        }

        if (filteredTasks.length === 0) {
          tasksList.innerHTML =
            '<div class="text-center text-gray-500 py-8">暂无养护任务</div>';
          return;
        }

        filteredTasks.forEach((task, index) => {
          const taskElement = document.createElement("div");
          taskElement.className =
            "bg-white border border-gray-200 rounded-lg p-4";
          taskElement.innerHTML = `
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="flex-1 text-sm">${task.title}</h3>
                        ${
                          task.status
                            ? `
                            <div class="px-2 py-1 rounded text-xs font-medium ${getStatusColor(
                              task.status
                            )}">
                                ${task.status}
                            </div>
                        `
                            : ""
                        }
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护使用类型：${
                      task.maintenanceType
                    }</div>
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex flex-wrap gap-2">
                            <span class="inline-block px-2 py-1 text-xs rounded-full ${getStructureTypeBadgeColor(
                              task.structureType
                            )}">
                                ${task.structureType}
                            </span>
                        </div>
                        <button onclick="startMaintenanceFromAllTasks(${
                          task.id
                        })" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs">
                            开始养护
                        </button>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">
                        养护时间：${task.startDate} ~ ${task.endDate}
                    </div>
                `;
          tasksList.appendChild(taskElement);
        });
      }

      // 从所有任务页面开始巡检
      function startInspectionFromAllTasks(taskId) {
        const task = inspectionTasksData.find((t) => t.id === taskId);
        if (!task) return;

        appState.selectedTask = task;
        appState.previousPage = "allTasks";
        appState.currentPage = "report";

        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示巡检上报页面
        document
          .getElementById("inspection-report-page")
          .classList.remove("hidden");

        // 更新UI
        document.getElementById("page-title").textContent = "巡检上报";
        document.getElementById("back-btn").classList.remove("hidden");

        // 检查是否有已保存的数据
        const taskKey = `${task.id}-${task.title}`;
        if (appState.savedReports[taskKey]) {
          // 加载已保存的数据
          appState.reportFormState = appState.savedReports[taskKey];
        } else {
          // 重置表单状态
          appState.reportFormState = {
            activeTab: "inspection",
            inspectionResult: "",
            diseases: [],
            nextDiseaseId: 1,
            categoryStates: {
              桥面铺装: { expanded: false, result: "", diseases: [] },
              伸缩缝: { expanded: false, result: "", diseases: [] },
              隔音屏: { expanded: false, result: "", diseases: [] },
              防撞体: { expanded: false, result: "", diseases: [] },
              检查井: { expanded: false, result: "", diseases: [] },
            },
          };
        }

        renderInspectionReport();
      }

      // 从所有养护任务页面开始养护
      function startMaintenanceFromAllTasks(taskId) {
        const task = pendingMaintenanceTasks.find((t) => t.id === taskId);
        if (!task) return;

        appState.selectedMaintenanceTask = task;
        appState.previousPage = "allMaintenanceTasks";
        appState.currentPage = "maintenanceReport";

        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示养护上报页面
        document
          .getElementById("maintenance-report-page")
          .classList.remove("hidden");

        // 更新UI
        document.getElementById("page-title").textContent = "养护上报";
        document.getElementById("back-btn").classList.remove("hidden");

        // 重置表单
        resetMaintenanceForm();

        // 重置Tab状态到默认的养护信息页面
        document
          .querySelectorAll("#maintenance-report-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        document
          .querySelector("#maintenance-report-page .tab-button:first-child")
          .classList.add("active");
        document
          .getElementById("maintenance-info-tab")
          .classList.remove("hidden");
        document
          .getElementById("maintenance-basic-tab")
          .classList.add("hidden");

        // 填充基本信息
        fillMaintenanceBasicInfo(task);

        // 显示历史内容（仅针对测试数据）
        showMaintenanceHistoryContent(task);

        // 生成默认养护内容
        generateDefaultMaintenanceContent(task);
      }

      // 更新goBack函数，处理新页面的返回
      const originalGoBack = goBack;
      goBack = function () {
        if (
          appState.currentPage === "allTasks" ||
          appState.currentPage === "allMaintenanceTasks"
        ) {
          // 从所有任务页面返回到主页面
          document.querySelectorAll(".page").forEach((page) => {
            page.classList.add("hidden");
          });

          document.getElementById("todo-page").classList.remove("hidden");
          document.getElementById("page-title").textContent = "待办";
          document.getElementById("back-btn").classList.add("hidden");

          // 恢复底部导航栏
          document.getElementById("bottom-nav").classList.remove("hidden");

          appState.currentPage = "main";
        } else if (
          appState.currentPage === "report" &&
          appState.previousPage === "todo"
        ) {
          // 从巡检上报页面返回到待办页面
          document.querySelectorAll(".page").forEach((page) => {
            page.classList.add("hidden");
          });

          document.getElementById("todo-page").classList.remove("hidden");
          document.getElementById("page-title").textContent = "待办";
          document.getElementById("back-btn").classList.add("hidden");

          // 恢复底部导航栏
          document.getElementById("bottom-nav").classList.remove("hidden");

          appState.currentPage = "main";
        } else if (
          appState.currentPage === "report" &&
          appState.previousPage === "allTasks"
        ) {
          // 从巡检上报页面返回到所有巡检任务页面
          document.querySelectorAll(".page").forEach((page) => {
            page.classList.add("hidden");
          });

          document.getElementById("all-tasks-page").classList.remove("hidden");
          document.getElementById("page-title").textContent = "巡检任务";
          document.getElementById("back-btn").classList.remove("hidden");
          document.getElementById("bottom-nav").classList.add("hidden");

          appState.currentPage = "allTasks";
        } else {
          // 调用原始的goBack函数处理其他情况
          return originalGoBack.apply(this, arguments);
        }
      };

      // 初始化养护验收页面
      function initAcceptancePage() {
        // 重置tab状态到待验收
        appState.currentAcceptanceTab = "pending";

        // 重置tab按钮状态
        document
          .querySelectorAll("#acceptance-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        document
          .querySelector("#acceptance-page .tab-button:first-child")
          .classList.add("active");

        // 显示待验收tab内容，隐藏验收记录tab内容
        document
          .getElementById("pending-acceptance")
          .classList.remove("hidden");
        document.getElementById("records-acceptance").classList.add("hidden");

        // 加载数据
        loadAcceptanceTasks();
        loadAcceptanceRecords();
      }

      // 切换养护验收Tab
      function switchAcceptanceTab(tab) {
        appState.currentAcceptanceTab = tab;

        // 隐藏所有Tab内容
        document.getElementById("pending-acceptance").classList.add("hidden");
        document.getElementById("records-acceptance").classList.add("hidden");

        // 显示选中的Tab
        document.getElementById(`${tab}-acceptance`).classList.remove("hidden");

        // 更新Tab按钮状态
        document
          .querySelectorAll("#acceptance-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        event.target.classList.add("active");

        // 重新加载数据
        if (tab === "pending") {
          loadAcceptanceTasks();
        } else {
          loadAcceptanceRecords();
        }
      }

      // 加载待验收任务
      function loadAcceptanceTasks() {
        const container = document.getElementById("pending-acceptance-list");
        container.innerHTML = pendingAcceptanceData
          .map(
            (task) => `
                <div class="card">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="flex-1 text-sm">${task.title}</h3>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护使用类型：${
                      task.maintenanceType
                    }</div>
                    <div class="flex items-center justify-between mb-2 gap-2">
                        <div>
                            <span class="badge ${getStructureTypeBadgeColor(
                              task.structureType
                            )}">
                                ${task.structureType}
                            </span>
                        </div>
                        <button class="btn-primary text-xs px-4 py-1 rounded" onclick="startAcceptance(${
                          task.id
                        })">
                            验收
                        </button>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护时间：${
                      task.startDate
                    } ~ ${task.endDate}</div>
                </div>
            `
          )
          .join("");

        document.getElementById("pending-acceptance-count").textContent =
          pendingAcceptanceData.length;
      }

      // 加载验收记录
      function loadAcceptanceRecords() {
        const container = document.getElementById("acceptance-records-list");
        container.innerHTML = acceptanceRecordsData
          .map(
            (record) => `
                <div class="card cursor-pointer hover:shadow-lg transition-shadow" onclick="viewAcceptanceDetail(${
                  record.id
                })">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="flex-1 text-sm">${record.title}</h3>
                        <div class="px-2 py-1 rounded text-xs font-medium ${getAcceptanceStatusColor(
                          record.status
                        )}">
                            ${record.status}
                        </div>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护使用类型：${
                      record.maintenanceType
                    }</div>
                    <div class="flex flex-wrap gap-2 mb-2">
                        <span class="inline-block px-2 py-1 text-xs rounded-full ${getStructureTypeBadgeColor(
                          record.structureType
                        )}">
                            ${record.structureType}
                        </span>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护时间：${
                      record.startDate
                    } ~ ${record.endDate}</div>
                    <div class="flex justify-end">

                    </div>
                </div>
            `
          )
          .join("");

        document.getElementById("acceptance-records-count").textContent =
          acceptanceRecordsData.length;
      }

      // 筛选待验收任务
      function filterAcceptanceTasks() {
        const searchText = document
          .getElementById("pending-acceptance-search")
          .value.toLowerCase();
        const structureTypes = getMultiSelectValues(
          "pending-acceptance-structure-filter"
        );
        const maintenanceType = document.getElementById(
          "pending-acceptance-type-filter"
        ).value;

        const filteredTasks = pendingAcceptanceData.filter((task) => {
          if (searchText && !task.title.toLowerCase().includes(searchText))
            return false;
          if (
            !structureTypes.includes("全部") &&
            !structureTypes.includes(task.structureType)
          )
            return false;
          if (
            maintenanceType &&
            maintenanceType !== "全部" &&
            task.maintenanceType !== maintenanceType
          )
            return false;
          return true;
        });

        const container = document.getElementById("pending-acceptance-list");
        if (filteredTasks.length === 0) {
          container.innerHTML =
            '<div class="text-center text-gray-500 py-8">暂无待验收任务</div>';
          document.getElementById("pending-acceptance-count").textContent = "0";
          return;
        }

        container.innerHTML = filteredTasks
          .map(
            (task) => `
                <!-- 修改：去掉了onclick事件和cursor-pointer样式，现在点击卡片空白处不会跳转了 -->
                <div class="card">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="flex-1 text-sm">${task.title}</h3>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护使用类型：${
                      task.maintenanceType
                    }</div>
                    <div class="flex items-center justify-between mb-2 gap-2">
                        <div>
                            <span class="badge ${getStructureTypeBadgeColor(
                              task.structureType
                            )}">
                                ${task.structureType}
                            </span>
                        </div>
                        <button class="btn-primary text-xs px-4 py-1 rounded" onclick="startAcceptance(${
                          task.id
                        })">
                            验收
                        </button>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护时间：${
                      task.startDate
                    } ~ ${task.endDate}</div>
                </div>
            `
          )
          .join("");

        document.getElementById("pending-acceptance-count").textContent =
          filteredTasks.length;
      }

      // 筛选验收记录
      function filterAcceptanceRecords() {
        const searchText = document
          .getElementById("records-acceptance-search")
          .value.toLowerCase();
        const structureTypes = getMultiSelectValues(
          "records-acceptance-structure-filter"
        );
        const maintenanceType = document.getElementById(
          "records-acceptance-type-filter"
        ).value;
        const status = document.getElementById(
          "records-acceptance-status-filter"
        ).value;

        const filteredRecords = acceptanceRecordsData.filter((record) => {
          if (searchText && !record.title.toLowerCase().includes(searchText))
            return false;
          if (
            !structureTypes.includes("全部") &&
            !structureTypes.includes(record.structureType)
          )
            return false;
          if (
            maintenanceType &&
            maintenanceType !== "全部" &&
            record.maintenanceType !== maintenanceType
          )
            return false;
          if (status && status !== "全部" && record.status !== status)
            return false;
          return true;
        });

        const container = document.getElementById("acceptance-records-list");
        if (filteredRecords.length === 0) {
          container.innerHTML =
            '<div class="text-center text-gray-500 py-8">暂无验收记录</div>';
          document.getElementById("acceptance-records-count").textContent = "0";
          return;
        }

        container.innerHTML = filteredRecords
          .map(
            (record) => `
                <div class="card cursor-pointer hover:shadow-lg transition-shadow" onclick="viewAcceptanceDetail(${
                  record.id
                })">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="flex-1 text-sm">${record.title}</h3>
                        <div class="px-2 py-1 rounded text-xs font-medium ${getAcceptanceStatusColor(
                          record.status
                        )}">
                            ${record.status}
                        </div>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护使用类型：${
                      record.maintenanceType
                    }</div>
                    <div class="flex flex-wrap gap-2 mb-2">
                        <span class="inline-block px-2 py-1 text-xs rounded-full ${getStructureTypeBadgeColor(
                          record.structureType
                        )}">
                            ${record.structureType}
                        </span>
                    </div>
                    <div class="text-xs text-gray-600 mb-2">养护时间：${
                      record.startDate
                    } ~ ${record.endDate}</div>
                    <div class="flex justify-end">

                    </div>
                </div>
            `
          )
          .join("");

        document.getElementById("acceptance-records-count").textContent =
          filteredRecords.length;
      }

      // 获取验收状态颜色
      function getAcceptanceStatusColor(status) {
        switch (status) {
          case "验收通过":
            return "bg-green-100 text-green-800";
          case "验收未通过":
            return "bg-red-100 text-red-800";
          case "待验收":
            return "bg-yellow-100 text-yellow-800";
          default:
            return "bg-gray-100 text-gray-800";
        }
      }

      // 查看验收详情
      function viewAcceptanceDetail(recordId) {
        // 找到对应的验收记录
        const record = acceptanceRecordsData.find((r) => r.id === recordId);
        if (!record) return;

        // 保存选中的记录
        appState.selectedAcceptanceRecord = record;
        appState.previousPage = "acceptance";
        appState.currentPage = "acceptance-record-detail";

        // 隐藏所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 显示验收记录详情页面
        document
          .getElementById("acceptance-record-detail-page")
          .classList.remove("hidden");

        // 更新UI
        document.getElementById("page-title").textContent = "验收详情";
        document.getElementById("back-btn").classList.remove("hidden");
        document.getElementById("bottom-nav").classList.add("hidden");

        // 填充验收记录详情数据
        fillAcceptanceRecordDetail(record);

        // 重置Tab状态到默认的验收信息页面
        document
          .querySelectorAll("#acceptance-record-detail-page .tab-button")
          .forEach((button) => {
            button.classList.remove("active");
          });
        document
          .querySelector(
            "#acceptance-record-detail-page .tab-button:first-child"
          )
          .classList.add("active");
        document
          .getElementById("acceptance-record-info-tab")
          .classList.remove("hidden");
        document
          .getElementById("acceptance-record-basic-tab")
          .classList.add("hidden");
      }

      // 进入养护验收页面
      function viewAcceptancePage() {
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        document.getElementById("acceptance-page").classList.remove("hidden");
        document.getElementById("page-title").textContent = "养护验收";
        document.getElementById("back-btn").classList.remove("hidden");
        document.getElementById("bottom-nav").classList.add("hidden");

        appState.previousPage = "main"; // 设置previousPage，确保返回时正确判断
        appState.currentPage = "acceptance";
        initAcceptancePage();
      }

      // 页面加载完成后初始化
      document.addEventListener("DOMContentLoaded", function () {
        // 从localStorage加载保存的报告数据
        loadSavedReportsFromStorage();

        // 初始化验收页面
        setTimeout(() => {
          if (appState.currentMainTab === "acceptance") {
            initAcceptancePage();
          }
        }, 100);
      });

      // 从localStorage加载保存的报告数据
      function loadSavedReportsFromStorage() {
        try {
          const savedReportsData = localStorage.getItem(
            "appState_savedReports"
          );
          if (savedReportsData) {
            appState.savedReports = JSON.parse(savedReportsData);
            console.log(
              "从localStorage加载保存的报告数据:",
              appState.savedReports
            );
          }
        } catch (error) {
          console.error("加载保存的报告数据失败:", error);
          appState.savedReports = {};
        }
      }

      // 保存报告数据到localStorage
      function saveReportsToStorage() {
        try {
          localStorage.setItem(
            "appState_savedReports",
            JSON.stringify(appState.savedReports)
          );
          console.log("保存报告数据到localStorage:", appState.savedReports);
        } catch (error) {
          console.error("保存报告数据到localStorage失败:", error);
        }
      }

      // 显示验收页面的养护历史
      function showAcceptanceMaintenanceHistory() {
        // 查找验收信息Tab中的养护计划名称字段
        const planNameInput = document.getElementById("maintenance-plan-name");
        if (!planNameInput) {
          console.error("未找到养护计划名称字段");
          return;
        }

        // 检查是否已经添加过养护历史容器
        let historyContainer = document.getElementById(
          "acceptance-maintenance-history"
        );
        if (historyContainer) {
          historyContainer.remove();
        }

        // 创建养护历史容器
        historyContainer = document.createElement("div");
        historyContainer.id = "acceptance-maintenance-history";
        historyContainer.className = "mb-4";
        // 获取当前选中的待验收任务
        const currentTask = appState.selectedAcceptanceTask;
        historyContainer.innerHTML =
          getAcceptanceMaintenanceHistoryHTML(currentTask);

        // 将容器插入到最后面（所有字段后面）
        const container = planNameInput.closest(".space-y-4");
        if (container) {
          container.appendChild(historyContainer);
        }
      }

      // 获取验收页面养护历史的HTML内容
      function getAcceptanceMaintenanceHistoryHTML(record) {
        // 根据不同的记录获取相应的养护历史数据
        const maintenanceHistory = getMaintenanceHistoryByRecord(record);
        return `
                <div class="border border-gray-200 rounded-lg overflow-hidden">
                    <!-- 第二次养护 -->
                    <div class="p-3 bg-green-50 border-b border-green-200 flex justify-between items-center">
                        <div class="text-sm font-medium text-green-700">第二次养护</div>
                        <button id="acceptance-toggle-btn" onclick="toggleAcceptanceHistory()" class="flex items-center gap-2 text-blue-600 hover:text-blue-700 text-sm font-medium">
                            <span id="acceptance-toggle-text">展开</span>
                            <svg id="acceptance-toggle-icon" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- 收起状态的内容（默认显示） -->
                    <div id="acceptance-collapsed-view" class="p-4 space-y-3">
                        <div>
                            <div class="text-sm text-gray-600 mb-1">养护内容</div>
                            <div class="text-sm text-gray-800">${
                              maintenanceHistory.secondMaintenance.content
                            }</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-1">资金使用情况</div>
                            <div class="text-sm text-gray-800">${
                              maintenanceHistory.secondMaintenance.funding
                            }</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-2">养护完工照片</div>
                            <div class="grid grid-cols-3 gap-2">
                                <div class="relative group">
                                    <div class="w-full h-20 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                        <svg viewBox="0 0 200 200" class="w-full h-full object-cover">
                                            <rect width="200" height="200" fill="#ec4899"/>
                                            <text x="100" y="100" text-anchor="middle" fill="white" font-size="14" font-family="Arial">第二次养护照片1</text>
                                        </svg>
                                    </div>
                                </div>
                                <div class="relative group">
                                    <div class="w-full h-20 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                        <svg viewBox="0 0 200 200" class="w-full h-full object-cover">
                                            <rect width="200" height="200" fill="#db2777"/>
                                            <text x="100" y="100" text-anchor="middle" fill="white" font-size="14" font-family="Arial">第二次养护照片2</text>
                                        </svg>
                                    </div>
                                </div>
                                <div class="relative group">
                                    <div class="w-full h-20 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                        <svg viewBox="0 0 200 200" class="w-full h-full object-cover">
                                            <rect width="200" height="200" fill="#be185d"/>
                                            <text x="100" y="100" text-anchor="middle" fill="white" font-size="14" font-family="Arial">第二次养护照片3</text>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-1">养护人</div>
                            <div class="text-sm text-gray-800">张无忌</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-1">养护上报时间</div>
                            <div class="text-sm text-gray-800">2025-11-16 09:15</div>
                        </div>
                    </div>
                    
                    <!-- 展开状态的内容（默认隐藏） -->
                    <div id="acceptance-expanded-view" class="hidden border-t border-gray-200">
                        <div class="p-4 space-y-4">
                            <div>
                                <div class="text-sm text-gray-600 mb-1">养护内容</div>
                                <div class="text-sm text-gray-800">对第一次改扩建中发现的问题进行重点整改，包括道路接缝重新处理、排水系统重新设计施工、交通标识重新施划等。</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-1">资金使用情况</div>
                                <div class="text-sm text-gray-800">第二次整改共使用资金80万元，主要用于道路接缝处理35万元、排水系统改造30万元、人工费用15万元。</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-2">养护完工照片</div>
                                <div class="grid grid-cols-3 gap-2">
                                    ${maintenanceHistory.secondMaintenance.photos
                                      .map(
                                        (photo, index) => `
                                        <div class="relative group">
                                            <div class="w-full h-20 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                                <svg viewBox="0 0 200 200" class="w-full h-full object-cover">
                                                    <rect width="200" height="200" fill="#8b5cf6"/>
                                                    <text x="100" y="100" text-anchor="middle" fill="white" font-size="12" font-family="Arial">第二次养护照片${
                                                      index + 1
                                                    }</text>
                                                </svg>
                                            </div>
                                        </div>
                                    `
                                      )
                                      .join("")}
                                </div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-1">养护人</div>
                                <div class="text-sm text-gray-800">${
                                  maintenanceHistory.secondMaintenance.person
                                }</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-1">养护上报时间</div>
                                <div class="text-sm text-gray-800">${
                                  maintenanceHistory.secondMaintenance.time
                                }</div>
                            </div>
                        </div>
                    </div>

                    <!-- 第一次养护（收起时完全隐藏） -->
                    <div id="acceptance-first-maintenance-container" class="hidden">
                        <div class="border-t border-gray-200">
                            <div class="p-3 bg-blue-50 border-b border-blue-200">
                                <div class="text-sm font-medium text-blue-700">第一次养护</div>
                            </div>
                            <!-- 展开状态的内容（默认隐藏，在展开第二次养护时显示） -->
                            <div id="acceptance-first-maintenance-expanded-view" class="hidden">
                                <div class="p-4 space-y-3">
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收状态</div>
                                        <div class="font-medium text-red-600 bg-red-100 px-2 py-1 rounded">${
                                          maintenanceHistory.firstMaintenance
                                            .acceptanceResult
                                        }</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收意见</div>
                                        <div class="text-sm text-gray-800">${
                                          maintenanceHistory.firstMaintenance
                                            .acceptanceOpinion
                                        }</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收人</div>
                                        <div class="text-sm text-gray-800">${
                                          maintenanceHistory.firstMaintenance
                                            .acceptancePerson
                                        }</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收时间</div>
                                        <div class="text-sm text-gray-800">${
                                          maintenanceHistory.firstMaintenance
                                            .acceptanceTime
                                        }</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">养护内容</div>
                                        <div class="text-sm text-gray-800">${
                                          maintenanceHistory.firstMaintenance
                                            .content
                                        }</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">资金使用情况</div>
                                        <div class="text-sm text-gray-800">本次改扩建工程共使用资金120万元，主要用于新增车道建设80万元、桥梁加固改造25万元、交通设施更新15万元。</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-2">养护完工照片</div>
                                        <div class="grid grid-cols-3 gap-2">
                                            ${maintenanceHistory.firstMaintenance.photos
                                              .map(
                                                (photo, index) => `
                                                <div class="relative group">
                                                    <div class="w-full h-20 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                                        <svg viewBox="0 0 200 200" class="w-full h-full object-cover">
                                                            <rect width="200" height="200" fill="#3b82f6"/>
                                                            <text x="100" y="100" text-anchor="middle" fill="white" font-size="12" font-family="Arial">第一次养护照片${
                                                              index + 1
                                                            }</text>
                                                        </svg>
                                                    </div>
                                                </div>
                                            `
                                              )
                                              .join("")}
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">养护人</div>
                                        <div class="text-sm text-gray-800">张无忌</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">养护上报时间</div>
                                        <div class="text-sm text-gray-800">2025-11-10 12:30</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
      }

      // 切换验收页面的历史内容展开/收起状态
      function toggleAcceptanceHistory() {
        const collapsedView = document.getElementById(
          "acceptance-collapsed-view"
        );
        const expandedView = document.getElementById(
          "acceptance-expanded-view"
        );
        const firstMaintenanceContainer = document.getElementById(
          "acceptance-first-maintenance-container"
        );
        const firstMaintenanceExpandedView = document.getElementById(
          "acceptance-first-maintenance-expanded-view"
        );
        const toggleText = document.getElementById("acceptance-toggle-text");
        const toggleIcon = document.getElementById("acceptance-toggle-icon");

        if (expandedView.classList.contains("hidden")) {
          // 展开内容
          collapsedView.classList.add("hidden");
          expandedView.classList.remove("hidden");
          firstMaintenanceContainer.classList.remove("hidden");
          firstMaintenanceExpandedView.classList.remove("hidden");
          toggleText.textContent = "收起";
          toggleIcon.style.transform = "rotate(180deg)";
        } else {
          // 收起内容
          collapsedView.classList.remove("hidden");
          expandedView.classList.add("hidden");
          firstMaintenanceContainer.classList.add("hidden");
          firstMaintenanceExpandedView.classList.add("hidden");
          toggleText.textContent = "展开";
          toggleIcon.style.transform = "rotate(0deg)";
        }
      }

      // 显示已验收记录的养护历史
      function showAcceptanceRecordMaintenanceHistory() {
        // 查找验收意见字段
        const opinionTextarea = document.querySelector(
          '#acceptance-record-info-tab textarea:not([name="acceptanceRecordResult"])'
        );
        if (!opinionTextarea) {
          console.error("未找到验收意见字段");
          return;
        }

        // --- 修改代码：移除了之前的检查并return的逻辑，直接查找并移除（双重保险），但不return ---
        let historyContainer = document.getElementById(
          "acceptance-record-maintenance-history"
        );
        if (historyContainer) {
          historyContainer.remove();
        }
        // --------------------------------------------------------------------------

        // 查找养护字段容器
        const fieldsContainer = document.getElementById(
          "acceptance-record-maintenance-fields"
        );

        // 获取当前记录
        const currentRecord = appState.selectedAcceptanceRecord;

        // 创建养护历史容器
        historyContainer = document.createElement("div");
        historyContainer.id = "acceptance-record-maintenance-history";
        historyContainer.className = "mb-4";
        historyContainer.innerHTML =
          getAcceptanceRecordMaintenanceHistoryHTML(currentRecord);

        // 将容器插入到验收时间后面（最后位置）
        const acceptanceTimeInput = document.getElementById(
          "acceptance-record-time"
        );
        const acceptanceTimeDiv = acceptanceTimeInput
          ? acceptanceTimeInput.closest(".space-y-4 > div")
          : null;
        const container = opinionTextarea.closest(".space-y-4");

        if (acceptanceTimeDiv) {
          // 在验收时间后面插入养护历史
          acceptanceTimeDiv.parentElement.insertBefore(
            historyContainer,
            acceptanceTimeDiv.nextSibling
          );
        } else if (container) {
          // 如果找不到验收时间字段，直接添加到容器末尾
          container.appendChild(historyContainer);
        }

        // 同时移除养护字段容器，避免重复显示
        if (fieldsContainer) {
          fieldsContainer.remove();
        }
      }

      // 根据记录获取养护历史数据
      function getMaintenanceHistoryByRecord(record) {
        // 定义不同记录的养护历史数据
        const maintenanceHistories = {
          "2025年道路改扩建计划": {
            secondMaintenance: {
              content:
                "对第一次改扩建中发现的问题进行重点整改，包括道路接缝重新处理、排水系统重新设计施工、交通标识重新施划等。",
              funding:
                "第二次整改共使用资金80万元，主要用于道路接缝处理35万元、排水系统改造30万元、人工费用15万元。",
              photos: ["record3-4", "record3-5", "record3-6"],
              person: "张无忌",
              time: "2025-11-16 09:15",
            },
            firstMaintenance: {
              acceptanceResult: "验收未通过",
              acceptanceOpinion:
                "改扩建工程存在质量问题，新增车道与原有道路接缝处理不当，排水系统设计不合理，需要重新设计施工。",
              acceptancePerson: "王强",
              acceptanceTime: "2025-11-10 11:20",
              content:
                "对道路进行改扩建施工，包括新增车道建设、桥梁加固改造、交通设施更新等工程内容。",
              funding:
                "第一次改扩建共使用资金120万元，主要用于道路基础建设50万元、桥梁改造40万元、交通设施20万元、人工费用10万元。",
              photos: ["record3-1", "record3-2", "record3-3"],
              person: "赵六",
              time: "2025-11-08 10:30",
            },
          },
          "2025年桥梁中修工程": {
            secondMaintenance: {
              content:
                "对第一次中修中发现的问题进行重点整改，包括桥面重新铺装、伸缩缝更换、护栏加固等。",
              funding:
                "第二次整改共使用资金60万元，主要用于桥面铺装25万元、伸缩缝更换20万元、人工费用15万元。",
              photos: ["bridge2-1", "bridge2-2", "bridge2-3"],
              person: "李明",
              time: "2025-11-12 14:20",
            },
            firstMaintenance: {
              acceptanceResult: "验收未通过",
              acceptanceOpinion:
                "桥梁中修工程质量不达标，桥面铺装存在不平整现象，伸缩缝安装不规范，需要重新整改。",
              acceptancePerson: "陈强",
              acceptanceTime: "2025-11-05 16:30",
              content:
                "对桥梁进行中修维护，包括桥面清理、裂缝修补、伸缩维护等工作。",
              funding:
                "第一次中修共使用资金80万元，主要用于材料费40万元、人工费25万元、机械费15万元。",
              photos: ["bridge1-1", "bridge1-2", "bridge1-3"],
              person: "王华",
              time: "2025-11-03 09:45",
            },
          },
          default: {
            secondMaintenance: {
              content: "对养护中发现的问题进行整改，确保工程质量符合标准要求。",
              funding: "本次整改共使用资金50万元，主要用于材料费、人工费等。",
              photos: ["default2-1", "default2-2", "default2-3"],
              person: "养护工程师",
              time: "2025-11-15 10:00",
            },
            firstMaintenance: {
              acceptanceResult: "验收未通过",
              acceptanceOpinion:
                "养护工程存在质量问题，需要重新整改以达到验收标准。",
              acceptancePerson: "验收员",
              acceptanceTime: "2025-11-08 11:00",
              content: "对设施进行常规养护维护工作。",
              funding: "本次养护共使用资金60万元，主要用于人工费、材料费等。",
              photos: ["default1-1", "default1-2", "default1-3"],
              person: "养护人员",
              time: "2025-11-05 14:30",
            },
          },
        };

        // 返回对应的养护历史数据，如果没有匹配的则使用默认数据
        return (
          maintenanceHistories[record.title] || maintenanceHistories["default"]
        );
      }

      // 获取已验收记录养护历史的HTML内容
      function getAcceptanceRecordMaintenanceHistoryHTML(record) {
        // 根据不同的记录获取相应的养护历史数据
        const maintenanceHistory = getMaintenanceHistoryByRecord(record);

        return `
                <div class="border border-gray-200 rounded-lg overflow-hidden">
                    <!-- 第二次养护 -->
                    <div class="p-3 bg-green-50 border-b border-green-200 flex justify-between items-center">
                        <div class="text-sm font-medium text-green-700">第二次养护</div>
                        <button id="acceptance-record-toggle-btn" onclick="toggleAcceptanceRecordHistory()" class="flex items-center gap-2 text-blue-600 hover:text-blue-700 text-sm font-medium">
                            <span id="acceptance-record-toggle-text">展开</span>
                            <svg id="acceptance-record-toggle-icon" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- 收起状态的内容（默认显示） -->
                    <div id="acceptance-record-collapsed-view" class="p-4 space-y-3">
                        <div>
                            <div class="text-sm text-gray-600 mb-1">养护内容</div>
                            <div class="text-sm text-gray-800">${
                              maintenanceHistory.secondMaintenance.content
                            }</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-1">资金使用情况</div>
                            <div class="text-sm text-gray-800">${
                              maintenanceHistory.secondMaintenance.funding
                            }</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-2">养护完工照片</div>
                            <div class="grid grid-cols-3 gap-2">
                                ${maintenanceHistory.secondMaintenance.photos
                                  .map(
                                    (photo, index) => `
                                    <div class="relative group">
                                        <div class="w-full h-20 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                            <svg viewBox="0 0 200 200" class="w-full h-full object-cover">
                                                <rect width="200" height="200" fill="#a855f7"/>
                                                <text x="100" y="100" text-anchor="middle" fill="white" font-size="12" font-family="Arial">第二次养护照片${
                                                  index + 1
                                                }</text>
                                            </svg>
                                        </div>
                                    </div>
                                `
                                  )
                                  .join("")}
                            </div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-1">养护人</div>
                            <div class="text-sm text-gray-800">${
                              maintenanceHistory.secondMaintenance.person
                            }</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-1">养护上报时间</div>
                            <div class="text-sm text-gray-800">${
                              maintenanceHistory.secondMaintenance.time
                            }</div>
                        </div>
                    </div>
                    
                    <!-- 展开状态的内容（默认隐藏） -->
                    <div id="acceptance-record-expanded-view" class="hidden border-t border-gray-200">
                        <div class="p-4 space-y-4">
                            <div>
                                <div class="text-sm text-gray-600 mb-1">养护内容</div>
                                <div class="text-sm text-gray-800">${
                                  maintenanceHistory.secondMaintenance.content
                                }</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-1">资金使用情况</div>
                                <div class="text-sm text-gray-800">${
                                  maintenanceHistory.secondMaintenance.funding
                                }</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-2">养护完工照片</div>
                                <div class="grid grid-cols-3 gap-2">
                                    ${maintenanceHistory.secondMaintenance.photos
                                      .map(
                                        (photo, index) => `
                                        <div class="relative group">
                                            <div class="w-full h-20 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                                <svg viewBox="0 0 200 200" class="w-full h-full object-cover">
                                                    <rect width="200" height="200" fill="#8b5cf6"/>
                                                    <text x="100" y="100" text-anchor="middle" fill="white" font-size="12" font-family="Arial">第二次养护照片${
                                                      index + 1
                                                    }</text>
                                                </svg>
                                            </div>
                                        </div>
                                    `
                                      )
                                      .join("")}
                                </div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-1">养护人</div>
                                <div class="text-sm text-gray-800">${
                                  maintenanceHistory.secondMaintenance.person
                                }</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-1">养护上报时间</div>
                                <div class="text-sm text-gray-800">${
                                  maintenanceHistory.secondMaintenance.time
                                }</div>
                            </div>
                        </div>
                    </div>

                    <!-- 第一次养护（收起时完全隐藏） -->
                    <div id="acceptance-record-first-maintenance-container" class="hidden">
                        <div class="border-t border-gray-200">
                            <div class="p-3 bg-blue-50 border-b border-blue-200">
                                <div class="text-sm font-medium text-blue-700">第一次养护</div>
                            </div>
                            <!-- 展开状态的内容（默认隐藏，在展开第二次养护时显示） -->
                            <div id="acceptance-record-first-maintenance-expanded-view" class="hidden">
                                <div class="p-4 space-y-3">
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收状态</div>
                                        <div class="font-medium text-red-600 bg-red-100 px-2 py-1 rounded">${
                                          maintenanceHistory.firstMaintenance
                                            .acceptanceResult
                                        }</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收意见</div>
                                        <div class="text-sm text-gray-800">${
                                          maintenanceHistory.firstMaintenance
                                            .acceptanceOpinion
                                        }</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收人</div>
                                        <div class="text-sm text-gray-800">${
                                          maintenanceHistory.firstMaintenance
                                            .acceptancePerson
                                        }</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">验收时间</div>
                                        <div class="text-sm text-gray-800">${
                                          maintenanceHistory.firstMaintenance
                                            .acceptanceTime
                                        }</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">养护内容</div>
                                        <div class="text-sm text-gray-800">${
                                          maintenanceHistory.firstMaintenance
                                            .content
                                        }</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">资金使用情况</div>
                                        <div class="text-sm text-gray-800">本次改扩建工程共使用资金120万元，主要用于新增车道建设80万元、桥梁加固改造25万元、交通设施更新15万元。</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-2">养护完工照片</div>
                                        <div class="grid grid-cols-3 gap-2">
                                            ${maintenanceHistory.firstMaintenance.photos
                                              .map(
                                                (photo, index) => `
                                                <div class="w-full h-20 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center overflow-hidden">
                                                    <svg viewBox="0 0 200 200" class="w-full h-full object-cover">
                                                        <rect width="200" height="200" fill="#1d4ed8"/>
                                                        <text x="100" y="100" text-anchor="middle" fill="white" font-size="12" font-family="Arial">第一次养护照片${
                                                          index + 1
                                                        }</text>
                                                    </svg>
                                                </div>
                                            `
                                              )
                                              .join("")}
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">养护人</div>
                                        <div class="text-sm text-gray-800">${
                                          maintenanceHistory.firstMaintenance
                                            .person
                                        }</div>
                                    </div>
                                    <div>
                                        <div class="text-sm text-gray-600 mb-1">养护上报时间</div>
                                        <div class="text-sm text-gray-800">${
                                          maintenanceHistory.firstMaintenance
                                            .time
                                        }</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
      }

      // 切换已验收记录养护历史展开/收起状态
      function toggleAcceptanceRecordHistory() {
        const collapsedView = document.getElementById(
          "acceptance-record-collapsed-view"
        );
        const expandedView = document.getElementById(
          "acceptance-record-expanded-view"
        );
        const firstMaintenanceContainer = document.getElementById(
          "acceptance-record-first-maintenance-container"
        );
        const firstMaintenanceExpandedView = document.getElementById(
          "acceptance-record-first-maintenance-expanded-view"
        );
        const toggleText = document.getElementById(
          "acceptance-record-toggle-text"
        );
        const toggleIcon = document.getElementById(
          "acceptance-record-toggle-icon"
        );

        if (expandedView.classList.contains("hidden")) {
          // 展开内容
          collapsedView.classList.add("hidden");
          expandedView.classList.remove("hidden");
          firstMaintenanceContainer.classList.remove("hidden");
          firstMaintenanceExpandedView.classList.remove("hidden");
          toggleText.textContent = "收起";
          toggleIcon.style.transform = "rotate(180deg)";
        } else {
          // 收起内容
          collapsedView.classList.remove("hidden");
          expandedView.classList.add("hidden");
          firstMaintenanceContainer.classList.add("hidden");
          firstMaintenanceExpandedView.classList.add("hidden");
          toggleText.textContent = "展开";
          toggleIcon.style.transform = "rotate(0deg)";
        }
      }

      // --- 历史填报功能相关代码 ---

      // 模拟的历史数据 (针对不同巡检点)
      const mockHistoryData = {
        辽阳快速路: [
          // 卡片1
          {
            status: "异常",
            location: "辽阳快速路K13+200段",
            photos: ["photo1.jpg", "photo2.jpg"],
            level: "中等",
            weight: "左侧路缘石",
            component: "路缘石",
            item: "路缘石",
            type: "破损",
            paramDesc: "损坏程度：中",
            description: "边角破损，存在脱落风险",
            person: "赵云",
            time: "2025-11-10 10:15",
          },
          // 卡片2
          {
            status: "异常",
            location: "辽阳快速路K14+800段",
            photos: ["photo3.jpg", "photo4.jpg"],
            level: "轻微",
            weight: "中央隔离带",
            component: "隔离设施",
            item: "隔离护栏",
            type: "变形",
            paramDesc: "损坏程度：轻",
            description: "轻微变形，不影响通行",
            person: "关羽",
            time: "2025-11-10 14:30",
          },
          // 卡片3
          {
            status: "异常",
            location: "辽阳快速路K15+500段",
            photos: ["photo5.jpg", "photo6.jpg"],
            level: "严重",
            weight: "右侧慢行道",
            component: "路面层",
            item: "慢行道铺装",
            type: "坑槽",
            paramDesc: "损坏程度：重",
            description: "坑槽较深，需立即修补",
            person: "刘备",
            time: "2025-11-10 16:45",
          },
        ],
        巡检点1: [
          {
            status: "异常",
            location: "辽阳快速路K12+500段",
            photos: [
              "https://images.unsplash.com/photo-1596516109370-29001ec8ec36?w=200&h=200&fit=crop",
              "https://images.unsplash.com/photo-1596516109370-29001ec8ec36?w=200&h=200&fit=crop",
            ],
            level: "中等",
            weight: "在 一个小转角 处", // 模拟图中的字段
            component: "桥面系",
            item: "桥面铺装",
            type: "网裂或龟裂",
            paramDesc: "轻微",
            description: "裂缝较大，需赶紧修复",
            person: "张飞",
            time: "2025-11-10 12:20",
          },
        ],
        巡检点2: [
          {
            status: "异常",
            location: "辽阳快速路桥面系北侧",
            photos: [
              "https://images.unsplash.com/photo-1515162816999-a0c47dc192f7?w=200&h=200&fit=crop",
            ],
            level: "轻微",
            weight: "-",
            component: "桥面系",
            item: "伸缩缝",
            type: "螺帽松动",
            paramDesc: "无",
            description: "发现3处螺帽松动。",
            person: "关羽",
            time: "2025-10-25 09:30",
          },
        ],
        // 其他点如果没有数据，代码会处理显示空状态
      };

      // 打开历史填报页面
      function openHistory(pointName) {
        // 1. 设置状态，用于 goBack 判断
        // 注意：这里不要改变 appState.reportFormState，这样返回时数据还在
        appState.previousPage = appState.currentPage; // 应该是 'report'
        appState.currentPage = "history";

        // 2. 隐藏当前所有页面
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.add("hidden");
        });

        // 3. 显示历史页面
        const historyPage = document.getElementById("history-page");
        historyPage.classList.remove("hidden");

        // 4. 渲染数据
        renderHistoryContent(pointName);
      }

      // 渲染历史页面内容 (还原设计图样式)
      function renderHistoryContent(pointName) {
        const container = document.getElementById("history-content-list");
        const records = mockHistoryData[pointName] || [];

        if (records.length === 0) {
          container.innerHTML = `
                    <div class="flex flex-col items-center justify-center pt-20 text-gray-400">
                        <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <p>该巡检点暂无历史记录</p>
                    </div>
                `;
          return;
        }

        container.innerHTML = records
          .map(
            (record) => `
                <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden relative mb-4">
                    <!-- 右上角状态标签 (CSS三角形效果 + 绝对定位) -->
                    <div class="absolute top-0 right-0">
                        <div class="absolute top-0 right-0 w-0 h-0 border-t-[60px] border-l-[60px] border-t-red-500 border-l-transparent z-0"></div>
                        <span class="absolute top-2 right-2 text-white text-xs font-bold z-10 transform rotate-45 translate-x-1 -translate-y-1">
                            ${record.status}
                        </span>
                    </div>

                    <!-- 头部标题 -->
                    <div class="px-4 py-3 border-b border-gray-100 flex items-center gap-2">
                        <div class="bg-blue-100 p-1 rounded">
                            <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                        </div>
                        <h3 class="font-bold text-gray-800 text-base">${pointName}</h3>
                    </div>

                    <div class="p-4">
                        <!-- 照片区域 -->
                        <div class="mb-4">
                            <div class="text-gray-500 text-sm mb-2 flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                                照片
                            </div>
                            <div class="flex gap-2">
                                ${record.photos
                                  .map(
                                    (photo, idx) => `
                                    <div class="w-20 h-20 rounded-lg overflow-hidden ${
                                      record.level === "严重"
                                        ? "bg-red-400"
                                        : record.level === "中等"
                                        ? "bg-orange-400"
                                        : idx === 0
                                        ? "bg-yellow-400"
                                        : "bg-green-400"
                                    }"> 
                                        <!-- 使用背景色模拟图片，实际使用 img src="${photo}" -->
                                        <div class="w-full h-full flex items-center justify-center text-white text-xs">
                                            历史照片${idx + 1}
                                        </div>
                                    </div>
                                `
                                  )
                                  .join("")}
                            </div>
                        </div>

                        <!-- 巡检位置 -->
                        <div class="flex items-start gap-2 mb-4 text-sm">
                            <svg class="w-4 h-4 text-gray-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            <div>
                                <span class="text-gray-500">巡检位置：</span>
                                <span class="text-gray-800">${
                                  record.location
                                }</span>
                            </div>
                        </div>

                        <!-- 详细信息网格 -->
                        <div class="grid grid-cols-2 gap-x-4 gap-y-3 mb-4">
                            <!-- 左侧：病害等级 -->
                            <div class="flex gap-2 relative">
                                <div class="w-1 bg-blue-500 rounded-full h-full absolute left-0 top-0"></div>
                                <div class="pl-3">
                                    <div class="text-gray-500 text-xs mb-1 flex items-center gap-1">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                        病害等级:
                                    </div>
                                    <div class="inline-block ${
                                      record.level === "严重"
                                        ? "bg-red-100 text-red-700 border-red-200"
                                        : record.level === "中等"
                                        ? "bg-orange-100 text-orange-700 border-orange-200"
                                        : "bg-yellow-100 text-yellow-700 border-yellow-200"
                                    } text-xs px-2 py-1 rounded-full border">
                                        ${record.level}
                                    </div>
                                </div>
                            </div>

                            <!-- 右侧：病害位置/重量 (模拟图中的布局) -->
                            <div class="flex gap-2 relative">
                                 <div class="w-1 bg-blue-500 rounded-full h-full absolute left-0 top-0"></div>
                                 <div class="pl-3">
                                    <div class="text-gray-500 text-xs mb-1 flex items-center gap-1">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/></svg>
                                        病害位置:
                                    </div>
                                    <div class="text-sm font-medium break-words leading-tight">
                                        ${record.weight}
                                    </div>
                                </div>
                            </div>

                            <!-- 左侧：构件/设备类型 -->
                            <div class="flex gap-2 relative">
                                <div class="w-1 bg-blue-500 rounded-full h-full absolute left-0 top-0"></div>
                                <div class="pl-3">
                                     <div class="text-gray-500 text-xs mb-1 flex items-center gap-1">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
                                        构件/设备类型:
                                     </div>
                                     <div class="text-sm font-medium">${
                                       record.component
                                     }</div>
                                </div>
                            </div>

                            <!-- 右侧：检查项 -->
                            <div class="flex gap-2 relative">
                                 <div class="w-1 bg-blue-500 rounded-full h-full absolute left-0 top-0"></div>
                                 <div class="pl-3">
                                     <div class="text-gray-500 text-xs mb-1 flex items-center gap-1">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
                                        检查项:
                                     </div>
                                     <div class="text-sm font-medium">${
                                       record.item
                                     }</div>
                                 </div>
                            </div>

                             <!-- 左侧：损坏类型 -->
                            <div class="flex gap-2 relative">
                                <div class="w-1 bg-blue-500 rounded-full h-full absolute left-0 top-0"></div>
                                <div class="pl-3">
                                     <div class="text-gray-500 text-xs mb-1 flex items-center gap-1">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                                        损坏类型:
                                     </div>
                                     <div class="text-sm font-medium">${
                                       record.type
                                     }</div>
                                </div>
                            </div>

                            <!-- 右侧：参数描述 -->
                            <div class="flex gap-2 relative">
                                 <div class="w-1 bg-blue-500 rounded-full h-full absolute left-0 top-0"></div>
                                 <div class="pl-3">
                                     <div class="text-gray-500 text-xs mb-1 flex items-center gap-1">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                        参数描述:
                                     </div>
                                     <div class="text-sm font-medium">${
                                       record.paramDesc
                                     }</div>
                                 </div>
                            </div>
                        </div>

                        <!-- 黄色警告框: 病害描述 -->
                        <div class="bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4">
                            <div class="flex items-center gap-1 text-yellow-700 text-xs font-bold mb-1">
                                 <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                                 病害描述
                            </div>
                            <div class="text-sm text-yellow-900 leading-snug">
                                ${record.description}
                            </div>
                        </div>

                        <!-- 底部信息 -->
                        <div class="flex justify-between items-center text-xs text-gray-500 border-t border-gray-100 pt-3">
                            <div class="flex items-center gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                                巡检人: <span class="text-gray-700 ml-1">${
                                  record.person
                                }</span>
                            </div>
                             <div class="flex items-center gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                                巡检时间: <span class="text-gray-700 ml-1">${
                                  record.time
                                }</span>
                            </div>
                        </div>
                    </div>
                </div>
            `
          )
          .join("");
      }
    </script>

    <!-- 历史填报页面 -->
  </body>
</html>
